(()=>{"use strict";var e={1379:function(e,t,n){n.d(t,{Z:()=>r});var a=n(9415),i=n.n(a),o=n(3018),s=n.n(o)()(i());s.push([e.id,".snake .snake-head{text-align:center;margin:.8em 0 .5em;font-size:1.3em;text-decoration:underline}.snake .snake-body{flex-wrap:wrap;justify-content:center;gap:.2em;max-height:10.5em;display:flex;overflow-y:auto}.snake .snake-scale{border:1px solid;width:1em;height:1em}.snake .snake-scale[data-scale-state=ready],.snake .snake-scale[data-scale-state=ongoing]{background-color:#eaecf0;border-color:#a2a9b1}.snake .snake-scale[data-scale-state=success]{background-color:#d5fdf4;border-color:#16876e}.snake .snake-scale[data-scale-state=warn]{background-color:#fee7e6;border-color:#d33}.snake .snake-scale[data-scale-state=fail]{background-color:#fef6e7;border-color:#edab00}","",{version:3,sources:["webpack://./src/components/Snake/index.less"],names:[],mappings:"AADA,mBAAA,iBAAA,CAAA,kBAAA,CAAA,eAAA,CAAA,yBAAA,CAMA,mBAAA,cAAA,CAAA,sBAAA,CAAA,QAAA,CAAA,iBAAA,CAAA,YAAA,CAAA,eAAA,CAQA,oBAAA,gBAAA,CAAA,SAAA,CAAA,UAAA,CAKA,0FAAA,wBAAA,CAAA,oBAAA,CAKA,8CAAA,wBAAA,CAAA,oBAAA,CAIA,2CAAA,wBAAA,CAAA,iBAAA,CAIA,2CAAA,wBAAA,CAAA,oBAAA",sourcesContent:['.snake .snake-head {\n  margin: 0.8em 0 0.5em;\n  font-size: 1.3em;\n  text-align: center;\n  text-decoration: underline;\n}\n.snake .snake-body {\n  display: flex;\n  flex-wrap: wrap;\n  justify-content: center;\n  gap: 0.2em;\n  max-height: 10.5em;\n  overflow-y: auto;\n}\n.snake .snake-scale {\n  width: 1em;\n  height: 1em;\n  border: 1px solid;\n}\n.snake .snake-scale[data-scale-state="ready"],\n.snake .snake-scale[data-scale-state="ongoing"] {\n  background-color: #eaecf0;\n  border-color: #a2a9b1;\n}\n.snake .snake-scale[data-scale-state="success"] {\n  background-color: #d5fdf4;\n  border-color: #16876e;\n}\n.snake .snake-scale[data-scale-state="warn"] {\n  background-color: #fee7e6;\n  border-color: #d33;\n}\n.snake .snake-scale[data-scale-state="fail"] {\n  background-color: #fef6e7;\n  border-color: #edab00;\n}\n'],sourceRoot:""}]);let r=s},4873:function(e,t,n){n.d(t,{Z:()=>r});var a=n(9415),i=n.n(a),o=n(3018),s=n.n(o)()(i());s.push([e.id,"#one-key-purge .okp-button{flex:0;padding:6px}#one-key-purge .okp-header{border-bottom:1px solid #bbb;display:flex}#one-key-purge .okp-header .okp-header-text{flex:1 0;justify-content:center;align-items:center;font-weight:700;display:flex}#one-key-purge .okp-footer{border-top:1px solid #bbb}#one-key-purge .okp-note{margin-bottom:.8em;font-size:1.143em;line-height:1.3}#one-key-purge .oo-ui-fieldLayout-header{width:20%;min-width:6em;font-weight:700}#one-key-purge .oo-ui-multiselectWidget-group,#one-key-purge .oo-ui-radioSelectWidget{flex-wrap:wrap;display:flex}#one-key-purge .oo-ui-multiselectWidget-group>label,#one-key-purge .oo-ui-radioSelectWidget>label{flex:1 0 11em;padding:4px 0}#one-key-purge-help{padding-left:1.2em;list-style:circle}","",{version:3,sources:["webpack://./src/gadgets/OneKeyPurge/index.less"],names:[],mappings:"AADA,2BAAA,MAAA,CAAA,WAAA,CAIA,2BAAA,4BAAA,CAAA,YAAA,CAIA,4CAAA,QAAA,CAAA,sBAAA,CAAA,kBAAA,CAAA,eAAA,CAAA,YAAA,CAOA,2BAAA,yBAAA,CAGA,yBAAA,kBAAA,CAAA,iBAAA,CAAA,eAAA,CAKA,yCAAA,SAAA,CAAA,aAAA,CAAA,eAAA,CAKA,sFAAA,cAAA,CAAA,YAAA,CAKA,kGAAA,aAAA,CAAA,aAAA,CAKA,oBAAA,kBAAA,CAAA,iBAAA",sourcesContent:["#one-key-purge .okp-button {\n  flex: 0 1;\n  padding: 6px;\n}\n#one-key-purge .okp-header {\n  display: flex;\n  border-bottom: 1px solid #bbb;\n}\n#one-key-purge .okp-header .okp-header-text {\n  flex: 1 0;\n  font-weight: 700;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n#one-key-purge .okp-footer {\n  border-top: 1px solid #bbb;\n}\n#one-key-purge .okp-note {\n  margin-bottom: 0.8em;\n  font-size: 1.143em;\n  line-height: 1.3;\n}\n#one-key-purge .oo-ui-fieldLayout-header {\n  width: 20%;\n  min-width: 6em;\n  font-weight: bold;\n}\n#one-key-purge .oo-ui-multiselectWidget-group,\n#one-key-purge .oo-ui-radioSelectWidget {\n  display: flex;\n  flex-wrap: wrap;\n}\n#one-key-purge .oo-ui-multiselectWidget-group > label,\n#one-key-purge .oo-ui-radioSelectWidget > label {\n  flex: 1 0 11em;\n  padding: 4px 0;\n}\n#one-key-purge-help {\n  list-style: circle;\n  padding-left: 1.2em;\n}\n"],sourceRoot:""}]);let r=s},3018:function(e){e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n="",a=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),a&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),a&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n}).join("")},t.i=function(e,n,a,i,o){"string"==typeof e&&(e=[[null,e,void 0]]);var s={};if(a)for(var r=0;r<this.length;r++){var u=this[r][0];null!=u&&(s[u]=!0)}for(var l=0;l<e.length;l++){var c=[].concat(e[l]);a&&s[c[0]]||(void 0!==o&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=o),n&&(c[2]&&(c[1]="@media ".concat(c[2]," {").concat(c[1],"}")),c[2]=n),i&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=i):c[4]="".concat(i)),t.push(c))}},t}},9415:function(e){e.exports=function(e){var t=e[1],n=e[3];if(!n)return t;if("function"==typeof btoa){var a=btoa(unescape(encodeURIComponent(JSON.stringify(n))));return[t].concat(["/*# ".concat("sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(a)," */")]).join("\n")}return[t].join("\n")}},85:function(e){var t=[];function n(e){for(var n=-1,a=0;a<t.length;a++)if(t[a].identifier===e){n=a;break}return n}function a(e,a){for(var i={},o=[],s=0;s<e.length;s++){var r=e[s],u=a.base?r[0]+a.base:r[0],l=i[u]||0,c="".concat(u," ").concat(l);i[u]=l+1;var d=n(c),p={css:r[1],media:r[2],sourceMap:r[3],supports:r[4],layer:r[5]};if(-1!==d)t[d].references++,t[d].updater(p);else{var A=function(e,t){var n=t.domAPI(t);return n.update(e),function(t){t?(t.css!==e.css||t.media!==e.media||t.sourceMap!==e.sourceMap||t.supports!==e.supports||t.layer!==e.layer)&&n.update(e=t):n.remove()}}(p,a);a.byIndex=s,t.splice(s,0,{identifier:c,updater:A,references:1})}o.push(c)}return o}e.exports=function(e,i){var o=a(e=e||[],i=i||{});return function(e){e=e||[];for(var s=0;s<o.length;s++){var r=n(o[s]);t[r].references--}for(var u=a(e,i),l=0;l<o.length;l++){var c=n(o[l]);0===t[c].references&&(t[c].updater(),t.splice(c,1))}o=u}}},9931:function(e){var t={};e.exports=function(e,n){var a=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!a)throw Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(n)}},6300:function(e){e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},7342:function(e,t,n){e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},1417:function(e){e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){var a,i,o;a="",n.supports&&(a+="@supports (".concat(n.supports,") {")),n.media&&(a+="@media ".concat(n.media," {")),(i=void 0!==n.layer)&&(a+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),a+=n.css,i&&(a+="}"),n.media&&(a+="}"),n.supports&&(a+="}"),(o=n.sourceMap)&&"undefined"!=typeof btoa&&(a+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),e.styleTagTransform(a,t,e.options)},remove:function(){!function(e){if(null!==e.parentNode)e.parentNode.removeChild(e)}(t)}}}},1514:function(e){e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}},t={};function n(a){var i=t[a];if(void 0!==i)return i.exports;var o=t[a]={id:a,exports:{}};return e[a](o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.nc=void 0,n.rv=()=>"1.4.2",n.ruid="bundler=rspack@1.4.2",(()=>{let e=e=>{let t=document.createElement("template");return t.innerHTML=e.trim(),t.content.children[0]};var t=n(85),a=n.n(t),i=n(1417),o=n.n(i),s=n(9931),r=n.n(s),u=n(7342),l=n.n(u),c=n(6300),d=n.n(c),p=n(1514),A=n.n(p),h=n(1379),g={};g.styleTagTransform=A(),g.setAttributes=l(),g.insert=r().bind(null,"head"),g.domAPI=o(),g.insertStyleElement=d(),a()(h.Z,g),h.Z&&h.Z.locals&&h.Z.locals;class m{_length=0;_complete=0;hasHead;hasHref;element;head;body;headComplete;headLength;blocks={};constructor({hasHead:t=!0,hasHref:n=!0,...a}={}){for(let i in this.hasHead=t,this.hasHref=n,this.element=e('<div class="snake"></div>'),a)this.element.setAttribute(i,a[i]);this.hasHead&&(this.head=e('<div class="snake-head"></div>'),this.headComplete=e('<span class="snake-head-complete">0</div>'),this.headLength=e('<span class="snake-head-all">0</div>'),this.head.append("已完成：",this.headComplete,"/",this.headLength),this.element.append(this.head)),this.body=e('<div class="snake-body"></div>'),this.element.append(this.body)}set length(e){this._length=e,this.hasHead&&(this.headLength.innerHTML=e)}get length(){return this._length}set complete(e){this._complete=e,this.hasHead&&(this.headComplete.innerHTML=e)}get complete(){return this._complete}addScale(e,t,n){let a;if(this.blocks[e])throw Error(`Snake: \u{9879}\u{76EE}${e}\u{5DF2}\u{5B58}\u{5728}\u{3002}`);this.hasHref?((a=document.createElement("a")).title=t||e,a.href=n||`/${e}`,a.target="_blank"):(a=document.createElement("div"),t&&(a.title=t)),a.classList.add("snake-scale","scale-state-ready"),a.dataset.scaleState="ready",this.length++,this.blocks[e]=a,this.body.append(a)}removeScale(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];for(let e of t){if(!this.blocks[e])throw Error(`Snake: \u{4E0D}\u{5B58}\u{5728}\u{540D}\u{4E3A}${t}\u{7684}\u{9879}\u{76EE}\u{3002}`);this.blocks[e].remove(),this.length--,Reflect.deleteProperty(this.blocks,e)}}crawl(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success";if(!this.blocks[e])throw Error(`Snake: \u{4E0D}\u{5B58}\u{5728}\u{540D}\u{4E3A}${e}\u{7684}\u{9879}\u{76EE}\u{3002}`);"success"===this.blocks[e].dataset.scaleState&&this.complete--,"success"===t&&this.complete++,"ongoing"===this.blocks[e].dataset.scaleState&&this.blocks[e].classList.remove("oo-ui-pendingElement-pending"),"ongoing"===t&&this.blocks[e].classList.add("oo-ui-pendingElement-pending"),this.blocks[e].dataset.scaleState=t,this.blocks[e].scrollIntoView()}clear(){this.complete=0,this.length=0,this.blocks={},this.body.innerHTML=""}}let f=async(e,t)=>{let n,a=new mw.Api,i=[],o={action:"query",prop:"linkshere",titles:e,lhlimit:"max"};t&&(o.lhnamespace=t);do{let e=await a.post(o);i.push(...(Object.values(e.query.pages)[0].linkshere||[]).map(e=>{let{title:t}=e;return t})),(n=e.continue?.lhcontinue)&&(o.lhcontinue=n)}while(n);return i},b=async(e,t)=>{let n,a=new mw.Api,i=[],o={action:"query",prop:"transcludedin",titles:e,tilimit:"max"};t&&(o.tinamespace=t);do{let e=await a.post(o);i.push(...(Object.values(e.query.pages)[0].transcludedin||[]).map(e=>{let{title:t}=e;return t})),(n=e.continue?.ticontinue)&&(o.ticontinue=n)}while(n);return i},y=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["page","subcat","file"],n=new mw.Api,a=[];if(mw.config.get("wgUserGroups").some(e=>["bot","flood","patroller","sysop"].includes(e))){let i="";for(;void 0!==i;){let o=await n.post({action:"query",format:"json",utf8:!0,list:"categorymembers",cmlimit:"max",cmtitle:e,cmprop:"title",cmtype:t,cmcontinue:i});o.query.categorymembers[0]&&a.push(...o.query.categorymembers.map(e=>{let{title:t}=e;return t})),i=o.continue?.cmcontinue}}else{let n=async e=>{let i=$(await $.ajax(e)),o=t.map(e=>{switch(e){case"page":return"#mw-pages li a";case"subcat":return"#mw-subcategories li a";case"file":return"#mw-category-media li a.galleryfilename"}}).join(","),s=i.find(o).map((e,t)=>t.classList.contains("CategoryTreeLabel")?`Category:${$(t).text()}`:t.classList.contains("galleryfilename")?`File:${$(t).text()}`:$(t).text()).get();if(a.push(...s),t.includes("page")){let e=i.find('a[href*="&pagefrom="]');e.length&&await n(e.eq(0).attr("href"))}if(t.includes("subcat")){let e=i.find('a[href*="&subcatfrom="]');e.length&&await n(e.eq(0).attr("href"))}if(t.includes("file")){let e=i.find('a[href*="&filefrom="]');e.length&&await n(e.eq(0).attr("href"))}};await n(`/${e}?useskin=vector&safemode=1`)}return a},k=e=>new Promise(t=>setTimeout(t,e));var w=n(4873),v={};v.styleTagTransform=A(),v.setAttributes=l(),v.insert=r().bind(null,"head"),v.domAPI=o(),v.insertStyleElement=d(),a()(w.Z,v),w.Z&&w.Z.locals&&w.Z.locals,$(()=>(async()=>{if(0>mw.config.get("wgNamespaceNumber")&&mw.config.get("wgRelevantPageName")===mw.config.get("wgPageName"))return;await mw.loader.using(["mediawiki.api","mediawiki.user","mediawiki.notification","oojs-ui"]);let e=new mw.Api,t=-1===mw.config.get("wgNamespaceNumber")?mw.config.get("wgRelevantPageName"):mw.config.get("wgPageName");class n extends OO.ui.Dialog{failList=[];changeList=[];complete=0;progressBar=new m;running=!1;noratelimit=mw.config.get("wgUserGroups")?.some(e=>["sysop","bot","flood"].includes(e));$header=$('<header class="okp-header"></header>');$footer=$('<footer class="okp-footer"></footer>');$body;panelLayout;closeButton;stopButton;actionButton;typeSelectInput;optionRadioSelect;static static={...super.static,tagName:"div",name:"one-key-purge"};initialize(){super.initialize(),this.panelLayout=new OO.ui.PanelLayout({scrollable:!1,expanded:!1,padded:!0}),this.closeButton=new OO.ui.ButtonWidget({label:"取消",flags:["destructive"]}),this.stopButton=new OO.ui.ButtonWidget({label:"终止",flags:["primary","destructive"]}),this.stopButton.$element.hide(),this.actionButton=new OO.ui.ButtonWidget({label:"执行",flags:["primary","progressive"]}),this.typeSelectInput=new OO.ui.CheckboxMultiselectInputWidget({options:[{data:"link",label:"链接"},{data:"include",label:"嵌入"},...14===mw.config.get("wgNamespaceNumber")?[{data:"category",label:"分类成员"}]:[]]});let e=new OO.ui.FieldLayout(this.typeSelectInput,{label:"页面类型"}),n=new OO.ui.ButtonWidget({label:"帮助",icon:"help"}),a=new OO.ui.RadioOptionWidget({data:"purge",label:"清除缓存（Purge）"}),i=new OO.ui.RadioOptionWidget({data:"nulledit",label:"零编辑（Null Edit）"});this.optionRadioSelect=new OO.ui.RadioSelectWidget({items:[a,i]}),this.optionRadioSelect.selectItem(a);let o=new OO.ui.FieldLayout(this.optionRadioSelect,{label:"操作类型"}),s=this.noratelimit?"<b>提醒</b>：在被大量嵌入/链入的页面此工具将会向服务器发送<b>大量请求</b>，请慎重使用！":"<b>提醒</b>：您未持有<code>noratelimit</code>权限，清除缓存和零编辑的速率将被分别限制为<u>30次/min</u>和<u>10次/min</u>，请耐心等待。";return this.closeButton.on("click",this.close.bind(this)),this.stopButton.on("click",()=>{this.stopButton.setDisabled(!0),this.running=!1}),n.on("click",()=>{OO.ui.alert($('<ul id="one-key-purge-help"></ul>').append("<li><b>清除缓存</b>：通常在需要刷新页面内容时使用，例如模板编辑后刷新嵌入了此模板的页面。</li>",`<li><b>\u{96F6}\u{7F16}\u{8F91}</b>\u{FF1A}\u{901A}\u{5E38}\u{5728}\u{9700}\u{8981}\u{5237}\u{65B0}<a href="/Special:\u{94FE}\u{5165}\u{9875}\u{9762}/${t}">\u{94FE}\u{5165}/\u{5D4C}\u{5165}\u{9875}\u{9762}\u{5217}\u{8868}</a>\u{65F6}\u{4F7F}\u{7528}\u{FF0C}\u{4F8B}\u{5982}\u{9875}\u{9762}\u{79FB}\u{52A8}\u{540E}\u{6E05}\u{7406}\u{94FE}\u{5165}\u{3002}</li>`),{title:"帮助",size:"medium"})}),this.actionButton.on("click",this.action.bind(this)),this.$body.append(this.$header.append($('<div class="okp-button okp-cancel-button"/>').append(this.closeButton.$element,this.stopButton.$element),$('<div class="okp-header-text">批量清除页面缓存</div>'),$('<div class="okp-button okp-action-button"/>').append(this.actionButton.$element)),this.panelLayout.$element.append(`<div class="okp-note">${s}</div>`,e.$element,o.$element,this.progressBar.element),this.$footer.append($('<div class="okp-button okp-help-button"/>').append(n.$element))),this}async getList(){let e=[];try{if(this.typeSelectInput.getValue().includes("link")){let n=await f(t);n.length>0?mw.notify(`\u{83B7}\u{53D6}\u{94FE}\u{63A5}\u{5230}\u{3010}${t}\u{3011}\u{7684}\u{9875}\u{9762}\u{5217}\u{8868}\u{6210}\u{529F}\u{3002}`):mw.notify(`\u{6CA1}\u{6709}\u{9875}\u{9762}\u{94FE}\u{63A5}\u{5230}\u{3010}${t}\u{3011}\u{3002}`),e.push(...n)}if(this.typeSelectInput.getValue().includes("include")){let n=await b(t);n.length>0?mw.notify(`\u{83B7}\u{53D6}\u{94FE}\u{63A5}\u{5230}\u{3010}${t}\u{3011}\u{7684}\u{9875}\u{9762}\u{5217}\u{8868}\u{6210}\u{529F}\u{3002}`):mw.notify(`\u{6CA1}\u{6709}\u{9875}\u{9762}\u{94FE}\u{63A5}\u{5230}\u{3010}${t}\u{3011}\u{3002}`),e.push(...n)}if(this.typeSelectInput.getValue().includes("category")){let n=await y(t,["page"]);n.length>0?mw.notify(`\u{83B7}\u{53D6}\u{3010}${t}\u{3011}\u{7684}\u{5206}\u{7C7B}\u{6210}\u{5458}\u{6210}\u{529F}\u{3002}`):mw.notify(`\u{3010}${t}\u{3011}\u{5185}\u{6CA1}\u{6709}\u{6210}\u{5458}\u{3002}`),e.push(...n)}}catch(e){}return[...new Set(e)]}get optionType(){return this.optionRadioSelect.findSelectedItem()?.getData()}progressChange(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a="nulledit"===this.optionType?"零编辑":"清除缓存";switch(this.progressBar.crawl(e,t),t.toLowerCase()){case"success":this.complete++;break;case"warn":this.complete++,this.changeList.push(e);break;case"fail":this.failList.push(e),mw.notify(`\u{9875}\u{9762}\u{3010}${e}\u{3011}${a}\u{5931}\u{8D25}${n?`\u{FF1A}${n}`:""}\u{3002}`,{type:"warn"})}}async nullEdit(t){for(let n=0;n<t.length&&this.running;n++){let a=t[n];this.progressBar.crawl(a,"ongoing"),e.postWithToken("csrf",{format:"json",action:"edit",appendtext:"",watchlist:"nochange",nocreate:!0,title:a}).done(e=>{this.progressBar.crawl(a,"ongoing"),"Success"===e.edit.result?void 0!==e.edit.nochange?this.progressChange(a,"success"):this.progressChange(a,"warn"):this.progressChange(a,"fail")}).catch(e=>{this.progressChange(a,"fail",e)}),n+1<t.length&&(this.noratelimit?await k(1e3):await k(6e3))}}async purge(t){for(let n=0;n<t.length&&this.running;n+=5){let a=t.slice(n,n+5);for(let e of a)this.progressBar.crawl(e,"ongoing");e.post({format:"json",action:"purge",titles:a.join("|"),forcelinkupdate:!0}).done(e=>{let{purge:t}=e;for(let{title:e}of t)this.progressChange(e,"success")}).catch(e=>{for(let t of a)this.progressChange(t,"fail",e)}),n+5<t.length&&(this.noratelimit?await k(1e3):await k(2e3))}}async action(){this.progressBar.clear(),0===this.typeSelectInput.getValue().length&&mw.notify("请选择页面类型。"),this.failList=[],this.changeList=[],this.complete=0,this.running=!0,this.$header.addClass("oo-ui-pendingElement-pending"),this.actionButton.setDisabled(!0),this.stopButton.setDisabled(!1),this.closeButton.$element.hide(),this.stopButton.$element.show();let e=await this.getList();for(let t of(e.length>0&&mw.notify(`\u{5171}${e.length}\u{4E2A}\u{9875}\u{9762}\u{FF0C}\u{5F00}\u{59CB}\u{6267}\u{884C}${"nulledit"===this.optionType?"零编辑":"清除缓存"}\u{2026}\u{2026}`),e))this.progressBar.addScale(t);this.updateSize(),"nulledit"===this.optionType?await this.nullEdit(e):await this.purge(e),this.failList.length>0&&OO.ui.alert($(`<div>${this.failList.join("、")}<br>\u{53EF}\u{80FD}\u{9875}\u{9762}\u{53D7}\u{5230}\u{4FDD}\u{62A4}\u{FF0C}\u{6216}\u{7F16}\u{8F91}\u{88AB}\u{8FC7}\u{6EE4}\u{5668}\u{62E6}\u{622A}\u{FF0C}\u{8BF7}\u{624B}\u{52A8}\u{68C0}\u{67E5}\u{3002}</div>`),{title:"提示",size:"medium"}),this.changeList.length>0&&OO.ui.alert($(`<div>${this.changeList.join("、")}\u{3002}<br>\u{88AB}\u{610F}\u{5916}\u{66F4}\u{6539}\u{FF0C}\u{8BF7}\u{624B}\u{52A8}\u{64A4}\u{56DE}\u{6216}\u{56DE}\u{9000}`),{title:"警告",size:"medium"}),this.$header.removeClass("oo-ui-pendingElement-pending"),this.actionButton.setDisabled(!1),this.closeButton.$element.show(),this.stopButton.$element.hide()}}let a=$(document.body),i=new OO.ui.WindowManager({id:"one-key-purge"});a.append(i.$element);let o=new n({size:"large"});i.addWindows([o]),$(mw.util.addPortletLink("p-cactions","javascript:void(0)","批量清除缓存","ca-okp")).on("click",()=>{$("#mw-notification-area").appendTo("body"),i.openWindow(o),a.css("overflow","auto")})})())})()})();
//# sourceMappingURL=OneKeyPurge.min.js.map