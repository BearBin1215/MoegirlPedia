(()=>{"use strict";var e={7018:function(e,t,n){n.d(t,{Z:()=>l});var i=n(9415),o=n.n(i),r=n(3018),a=n.n(r)()(o());a.push([e.id,".bearbintools-loger .loger-clear{margin-left:.3em;font-size:.9em;font-weight:400}.bearbintools-loger .loger-body{background:#ffffffb3;border:1px solid #ccc;padding:.3em;display:flow-root}.bearbintools-loger .loger-filter{float:right;padding:.4em}.bearbintools-loger .loger-filter>div{cursor:pointer;border-radius:.3em;margin-bottom:.2em;padding-right:.2em}.bearbintools-loger .loger-filter>div.loger-filter-selected{background-color:#7f7f7f12}.bearbintools-loger .loger-filter .loger-filter-icon{text-align:center;width:1.2em;height:1em;line-height:1em;display:inline-block}.bearbintools-loger .loger-lines{max-height:20em;font-family:monospace;list-style:inside;overflow-y:auto}.bearbintools-loger .loger-lines>li a{color:inherit;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}","",{version:3,sources:["webpack://./src/components/Loger/index.less"],names:[],mappings:"AADA,iCAAA,gBAAA,CAAA,cAAA,CAAA,eAAA,CAKA,gCAAA,oBAAA,CAAA,qBAAA,CAAA,YAAA,CAAA,iBAAA,CAMA,kCAAA,WAAA,CAAA,YAAA,CAIA,sCAAA,cAAA,CAAA,kBAAA,CAAA,kBAAA,CAAA,kBAAA,CAMA,4DAAA,0BAAA,CAGA,qDAAA,iBAAA,CAAA,WAAA,CAAA,UAAA,CAAA,eAAA,CAAA,oBAAA,CAOA,iCAAA,eAAA,CAAA,qBAAA,CAAA,iBAAA,CAAA,eAAA,CAMA,sCAAA,aAAA,CAAA,wCAAA,CAAA,gCAAA",sourcesContent:[".bearbintools-loger .loger-clear {\n  margin-left: 0.3em;\n  font-size: 0.9em;\n  font-weight: normal;\n}\n.bearbintools-loger .loger-body {\n  display: flow-root;\n  padding: 0.3em;\n  border: 1px solid #ccc;\n  background: rgba(255, 255, 255, 0.7);\n}\n.bearbintools-loger .loger-filter {\n  float: right;\n  padding: 0.4em;\n}\n.bearbintools-loger .loger-filter > div {\n  border-radius: 0.3em;\n  margin-bottom: 0.2em;\n  padding-right: 0.2em;\n  cursor: pointer;\n}\n.bearbintools-loger .loger-filter > div.loger-filter-selected {\n  background-color: rgba(127, 127, 127, 0.07);\n}\n.bearbintools-loger .loger-filter .loger-filter-icon {\n  display: inline-block;\n  width: 1.2em;\n  height: 1em;\n  line-height: 1em;\n  text-align: center;\n}\n.bearbintools-loger .loger-lines {\n  max-height: 20em;\n  overflow-y: auto;\n  list-style: inside;\n  font-family: monospace;\n}\n.bearbintools-loger .loger-lines > li a {\n  color: inherit;\n  text-decoration: underline dotted;\n}\n"],sourceRoot:""}]);let l=a},6052:function(e,t,n){n.d(t,{Z:()=>l});var i=n(9415),o=n.n(i),r=n(3018),a=n.n(r)()(o());a.push([e.id,".rootpage-Special_BatchSend #firstHeading{flex-wrap:wrap;justify-content:space-between;align-items:flex-end;display:flex}.rootpage-Special_BatchSend #firstHeading>div{font-size:.6em}.rootpage-Special_BatchSend #bodyContent{padding-right:0!important}.rootpage-Special_BatchSend #bodyContent #mw-content-text h3{margin-bottom:0}.rootpage-Special_BatchSend #bodyContent #mw-content-text ul.bearbintools-notelist{margin:.4em 0 0 1.6em}.rootpage-Special_BatchSend #bodyContent #mw-content-text .oo-ui-textInputWidget{max-width:unset}#bs-submit-panel{gap:.1rem;margin-top:.8em;display:flex}#bs-submit-panel #bs-interval{flex:0 0 5.5em}#bs-submit-panel #bs-summary{max-width:unset}#bs-previewzone{background:#ffffffb3;border:1px solid #ccc}#bs-previewzone .mw-parser-output{padding:0 1em 1em}#bs-previewzone .oo-ui-pendingElement-pending{text-align:center;padding:1em 0;font-size:1.2em}#bs-previewzone .mw-editsection{display:none}#bs-previewsummary{margin-top:.4em}","",{version:3,sources:["webpack://./src/gadgets/BatchSend/index.less"],names:[],mappings:"AADA,0CAAA,cAAA,CAAA,6BAAA,CAAA,oBAAA,CAAA,YAAA,CAMA,8CAAA,cAAA,CAGA,yCAAA,yBAAA,CAGA,6DAAA,eAAA,CAGA,mFAAA,qBAAA,CAGA,iFAAA,eAAA,CAGA,iBAAA,SAAA,CAAA,eAAA,CAAA,YAAA,CAKA,8BAAA,cAAA,CAGA,6BAAA,eAAA,CAGA,gBAAA,oBAAA,CAAA,qBAAA,CAIA,kCAAA,iBAAA,CAGA,8CAAA,iBAAA,CAAA,aAAA,CAAA,eAAA,CAKA,gCAAA,YAAA,CAGA,mBAAA,eAAA",sourcesContent:[".rootpage-Special_BatchSend #firstHeading {\n  display: flex;\n  flex-wrap: wrap;\n  justify-content: space-between;\n  align-items: flex-end;\n}\n.rootpage-Special_BatchSend #firstHeading > div {\n  font-size: 0.6em;\n}\n.rootpage-Special_BatchSend #bodyContent {\n  padding-right: 0 !important;\n}\n.rootpage-Special_BatchSend #bodyContent #mw-content-text h3 {\n  margin-bottom: 0;\n}\n.rootpage-Special_BatchSend #bodyContent #mw-content-text ul.bearbintools-notelist {\n  margin: 0.4em 0 0 1.6em;\n}\n.rootpage-Special_BatchSend #bodyContent #mw-content-text .oo-ui-textInputWidget {\n  max-width: unset;\n}\n#bs-submit-panel {\n  display: flex;\n  gap: 0.1rem;\n  margin-top: 0.8em;\n}\n#bs-submit-panel #bs-interval {\n  flex: 0 0 5.5em;\n}\n#bs-submit-panel #bs-summary {\n  max-width: unset;\n}\n#bs-previewzone {\n  border: 1px solid #ccc;\n  background: rgba(255, 255, 255, 0.7);\n}\n#bs-previewzone .mw-parser-output {\n  padding: 0 1em 1em;\n}\n#bs-previewzone .oo-ui-pendingElement-pending {\n  padding: 1em 0;\n  text-align: center;\n  font-size: 1.2em;\n}\n#bs-previewzone .mw-editsection {\n  display: none;\n}\n#bs-previewsummary {\n  margin-top: 0.4em;\n}\n"],sourceRoot:""}]);let l=a},3018:function(e){e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n="",i=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),i&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),i&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n}).join("")},t.i=function(e,n,i,o,r){"string"==typeof e&&(e=[[null,e,void 0]]);var a={};if(i)for(var l=0;l<this.length;l++){var s=this[l][0];null!=s&&(a[s]=!0)}for(var c=0;c<e.length;c++){var A=[].concat(e[c]);i&&a[A[0]]||(void 0!==r&&(void 0===A[5]||(A[1]="@layer".concat(A[5].length>0?" ".concat(A[5]):""," {").concat(A[1],"}")),A[5]=r),n&&(A[2]&&(A[1]="@media ".concat(A[2]," {").concat(A[1],"}")),A[2]=n),o&&(A[4]?(A[1]="@supports (".concat(A[4],") {").concat(A[1],"}"),A[4]=o):A[4]="".concat(o)),t.push(A))}},t}},9415:function(e){e.exports=function(e){var t=e[1],n=e[3];if(!n)return t;if("function"==typeof btoa){var i=btoa(unescape(encodeURIComponent(JSON.stringify(n))));return[t].concat(["/*# ".concat("sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(i)," */")]).join("\n")}return[t].join("\n")}},85:function(e){var t=[];function n(e){for(var n=-1,i=0;i<t.length;i++)if(t[i].identifier===e){n=i;break}return n}function i(e,i){for(var o={},r=[],a=0;a<e.length;a++){var l=e[a],s=i.base?l[0]+i.base:l[0],c=o[s]||0,A="".concat(s," ").concat(c);o[s]=c+1;var d=n(A),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==d)t[d].references++,t[d].updater(p);else{var u=function(e,t){var n=t.domAPI(t);return n.update(e),function(t){t?(t.css!==e.css||t.media!==e.media||t.sourceMap!==e.sourceMap||t.supports!==e.supports||t.layer!==e.layer)&&n.update(e=t):n.remove()}}(p,i);i.byIndex=a,t.splice(a,0,{identifier:A,updater:u,references:1})}r.push(A)}return r}e.exports=function(e,o){var r=i(e=e||[],o=o||{});return function(e){e=e||[];for(var a=0;a<r.length;a++){var l=n(r[a]);t[l].references--}for(var s=i(e,o),c=0;c<r.length;c++){var A=n(r[c]);0===t[A].references&&(t[A].updater(),t.splice(A,1))}r=s}}},9931:function(e){var t={};e.exports=function(e,n){var i=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!i)throw Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},6300:function(e){e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},7342:function(e,t,n){e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},1417:function(e){e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){var i,o,r;i="",n.supports&&(i+="@supports (".concat(n.supports,") {")),n.media&&(i+="@media ".concat(n.media," {")),(o=void 0!==n.layer)&&(i+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),i+=n.css,o&&(i+="}"),n.media&&(i+="}"),n.supports&&(i+="}"),(r=n.sourceMap)&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),e.styleTagTransform(i,t,e.options)},remove:function(){!function(e){if(null!==e.parentNode)e.parentNode.removeChild(e)}(t)}}}},1514:function(e){e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}},t={};function n(i){var o=t[i];if(void 0!==o)return o.exports;var r=t[i]={id:i,exports:{}};return e[i](r,r.exports,n),r.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.nc=void 0,n.rv=()=>"1.4.2",n.ruid="bundler=rspack@1.4.2",(()=>{let e=e=>{let t=document.createElement("template");return t.innerHTML=e.trim(),t.content.children[0]};var t=n(85),i=n.n(t),o=n(1417),r=n.n(o),a=n(9931),l=n.n(a),s=n(7342),c=n.n(s),A=n(6300),d=n.n(A),p=n(1514),u=n.n(p),g=n(7018),m={};m.styleTagTransform=u(),m.setAttributes=c(),m.insert=l().bind(null,"head"),m.domAPI=r(),m.insertStyleElement=d(),i()(g.Z,m),g.Z&&g.Z.locals&&g.Z.locals;class f{_logTypes={success:{icon:"✓",color:"#333",text:"完成"},warn:{icon:"!",color:"#f28500",text:"警告"},error:{icon:"✕",color:"#eb3941",text:"出错"}};element;headline;body=e('<div class="loger-body"></div>');logerLines=e('<ul class="loger-lines"></ul>');logDetails=[];filterButtons={};constructor(t=[],n="",i="h3"){for(let e in t.length>0&&(this._logTypes=t.reduce((e,t)=>{let{name:n,icon:i,color:o,text:r}=t;return e[n]={icon:i,color:o,text:r},e},{})),this._logTypes)this._logTypes[e].show=!0;this.headline=e(`<${i} class="loger-headline"></${i}>`);let o=e('<a class="loger-clear">[清空]</a>');o.addEventListener("click",this.clear.bind(this));let r=e('<nav class="loger-filter"></nav>');for(let[t,{icon:n,color:i,text:o}]of Object.entries(this._logTypes)){let a=e(`<div class="loger-filter-selected loger-${t}" style="color:${i}"></div>`),l=e('<span class="loger-filter-icon"></span>');l.append(n);let s=e('<span class="loger-filter-count">0</span>');a.append(l,s,` ${o}`),a.addEventListener("click",()=>{this._logTypes[t].show?(a.classList.remove("loger-filter-selected"),this.logerLines.classList.add(`loger-${t}-hidden`),this.logDetails.filter(e=>e.type===t).forEach(e=>{e.element.style.display="none"}),this._logTypes[t].show=!1):(a.classList.add("loger-filter-selected"),this.logerLines.classList.remove(`loger-${t}-hidden`),this.logDetails.filter(e=>e.type===t).forEach(e=>{e.element.style.display=""}),this._logTypes[t].show=!0)}),this.filterButtons[t]={button:a,countElement:s},r.appendChild(a)}this.element=e(`<div class="bearbintools-loger" id="${n||""}"></div>`),this.headline.append("日志",o),this.body.append(r,this.logerLines),this.element.append(this.headline,this.body)}record(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"normal",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Date().toLocaleTimeString(),i=document.createElement("li");return i.classList.add("loger-record",`loger-${t}`),i.innerHTML=`${n} - ${e}`,i.style.color=this._logTypes[t]?.color||"#222",this._logTypes[t]?.show===!1&&(i.style.display="none"),this.logerLines.appendChild(i),this.logerLines.scrollTop=this.logerLines.scrollHeight,this.logDetails.push({element:i,type:t}),this.filterButtons[t]&&(this.filterButtons[t].countElement.innerText=String(+this.filterButtons[t].countElement.innerText+1)),i}clear(){for(let e in this.logDetails.length=0,this.logerLines.innerHTML="",this.filterButtons)this.filterButtons[e].countElement.innerText="0"}}let h=e=>new Promise(t=>setTimeout(t,e)),b=e=>e.replace(/^ *(?:User[_ ]talk:|用[户戶][讨討][论論]:|使用者[讨討][论論]:|U:|User:|用[户戶]:)?(.*)$/i,"User_talk:$1");var v=n(6052),w={};w.styleTagTransform=u(),w.setAttributes=c(),w.insert=l().bind(null,"head"),w.domAPI=r(),w.insertStyleElement=d(),i()(v.Z,w),v.Z&&v.Z.locals&&v.Z.locals,$(()=>(async()=>{if("Special:BatchSend"!==mw.config.get("wgPageName")){await mw.loader.using(["mediawiki.util"]),mw.util.addPortletLink("p-tb","/Special:BatchSend","群发提醒","t-batchsend");return}await mw.loader.using(["mediawiki.api","oojs-ui","mediawiki.user"]);let e=new mw.Api,t=new f,n=async function(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",{parse:o}=await e.post({action:"parse",uselang:mw.config.get("wgUserLanguage"),section:"new",contentmodel:"wikitext",pst:!0,sectiontitle:t,text:n,summary:i});return o},i=async function(t,n,i){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return await e.postWithToken("csrf",{format:"json",action:"edit",section:"new",watchlist:"nochange",tags:"Bot",bot:!0,title:t,sectiontitle:n,text:i,summary:o})};mw.config.set("wgCanonicalSpecialPageName","BulkMove"),document.title="群发提醒 - 萌娘百科_万物皆可萌的百科全书",$(".mw-invalidspecialpage").removeClass("mw-invalidspecialpage"),$("#firstHeading").html('群发讨论页消息<div>By <a href="/User:BearBin">BearBin</a></div>'),$("#contentSub").remove();let o=new OO.ui.MultilineTextInputWidget({validate:"non-empty",placeholder:"使用换行分隔，一行一个\nUser talk前缀加不加都可以，支持发送至子页面",rows:5,autosize:!0}),r=new OO.ui.TextInputWidget({validate:"non-empty"}),a=new OO.ui.MultilineTextInputWidget({validate:"non-empty",rows:10,autosize:!0}),l=new OO.ui.ButtonWidget({label:"提交",flags:["primary","progressive"],icon:"check"}),s=new OO.ui.ButtonWidget({label:"预览",flags:["primary"]}),c=new OO.ui.TextInputWidget({placeholder:"发送间隔",id:"bs-interval"}),A=new OO.ui.TextInputWidget({placeholder:"编辑摘要",id:"bs-summary"}),d=$("<h3>预览</h3>").hide(),p=$('<div id="bs-previewzone">').hide(),u=$('<span class="comment">'),g=$('<div id="bs-previewsummary">').hide();for(let e of($("#mw-content-text").empty().append("<h3>页面列表</h3>",o.$element,"<h3>标题</h3>",r.$element,"<h3>正文</h3>",a.$element,$('<div id="bs-submit-panel">').append(l.$element,s.$element,c.$element,A.$element),$('<ul class="bearbintools-notelist">').append("<li>发送间隔单位为秒（s），不包含本身编辑所用的服务器响应时间。</li>",'<li>非维护人员请注意<a target="_blank" href="/api.php?action=query&meta=userinfo&uiprop=ratelimits">ratelimit限制</a>和<a href="/萌娘百科:机器用户#其他规范">机器用户方针规定的速率</a>，自行设置间隔或申请机器用户以免撞墙或超速。</li>',"<li>摘要留空则会由系统自动生成。</li>"),d,p,g.append("编辑摘要：",u),t.element),[o,r,a]))e.on("change",()=>{window.onbeforeunload=()=>!0});s.on("click",async()=>{s.setDisabled(!0),d.show(),p.show(),g.show(),p.html('<div class="oo-ui-pendingElement-pending">正在加载预览……</div>');let{text:e,parsedsummary:t}=await n(r.getValue(),a.getValue(),A.getValue());p.html(e["*"]),u.html(`\u{FF08}${t["*"]}\u{FF09}`),s.setDisabled(!1)}),l.on("click",async()=>{if(await OO.ui.confirm($("<p>请确认您要发送的内容是否有误。若因输入不当而产生错误，请自行<ruby><rb>承担后果</rb><rp>(</rp><rt>料理后事</rt><rp>)</rp></ruby>。</p>"),{title:"提醒",size:"small"})){l.setDisabled(!0),s.setDisabled(!0),window.onbeforeunload=()=>!0,$("#mw-content-text input, #mw-content-text textarea").prop("disabled",!0);let e=[...new Set(o.getValue().split("\n").filter(e=>e&&e.trim()))],n=r.getValue().trim(),d=a.getValue().trim(),p=1e3*Number(c.getValue()),u=A.getValue();if(0===e.length)return void t.record("请输入要发送的目标页面。","warn");if(0===n.length)return void t.record("请输入章节标题。","warn");if(0===d.length)return void t.record("请输入内容。","warn");for(let o of e){let e=b(o);try{let o=await i(e,n,d,u),r=`<a href="/${e}" target="_blank">${e}</a>`;o.edit?.result==="Success"?(t.record(`\u{5411}\u{3010}${r}\u{3011}\u{53D1}\u{9001}\u{6210}\u{529F}\u{3002}`,"success"),await h(p)):o.edit?.result==="Failure"&&t.record(`\u{5411}\u{3010}${r}\u{3011}\u{53D1}\u{9001}\u{5931}\u{8D25}\u{FF1A}${Object.keys(o.edit)[0]}\u{FF1A}${Object.values(o.edit)[0]}\u{3002}`,"error")}catch(n){t.record(`\u{5411}\u{3010}<a href="/${e}">${e}</a>\u{3011}\u{53D1}\u{9001}\u{5931}\u{8D25}\u{FF1A}${n}\u{3002}`,"error")}}t.record("发送完毕。"),l.setDisabled(!1),s.setDisabled(!1),window.onbeforeunload=()=>null,$("#mw-content-text input, #mw-content-text textarea").prop("disabled",!1)}})})())})()})();
//# sourceMappingURL=BatchSend.min.js.map