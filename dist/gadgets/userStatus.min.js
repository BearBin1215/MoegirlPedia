(()=>{var e={},t={};function a(i){var o=t[i];if(void 0!==o)return o.exports;var s=t[i]={exports:{}};return e[i](s,s.exports,a),s.exports}a.rv=()=>"1.4.2",a.ruid="bundler=rspack@1.4.2",$(()=>(async()=>{await mw.loader.using(["ext.gadget.LocalObjectStorage"]);let e=new LocalObjectStorage("UserStatus");try{let t,a,i={online:'<img class="pt-userstatus-img" src="https://img.moegirl.org.cn/common/9/94/Symbol_support_vote.svg"> <b style="color:green;">在线</b>',busy:'<img class="pt-userstatus-img" src="https://img.moegirl.org.cn/common/c/c5/Symbol_support2_vote.svg"> <b style="color:blue;">忙碌</b>',offline:'<img class="pt-userstatus-img" src="https://img.moegirl.org.cn/common/7/7f/Symbol_oppose_vote.svg"> <b style="color:red;">离线</b>',away:'<img class="pt-userstatus-img" src="https://img.moegirl.org.cn/common/6/6c/Time2wait.svg"> <b style="color:grey;">已离开</b>',sleeping:'<img class="pt-userstatus-img" src="https://img.moegirl.org.cn/common/5/54/Symbol_wait.svg"> <b style="color:purple;">在睡觉</b>',wikibreak:'<img class="pt-userstatus-img" src="https://img.moegirl.org.cn/common/6/61/Symbol_abstain_vote.svg"> <b style="color:brown;">正在放萌百假期</b>',holiday:'<img class="pt-userstatus-img" src="https://img.moegirl.org.cn/common/3/30/Symbol_deferred.svg"> <b style="color:#7B68EE;">处于假期中</b>',_unknown:'<img class="pt-userstatus-img" src="https://img.moegirl.org.cn/common/8/89/Symbol_neutral_vote.svg"> <i style="color:gray;">状态不详</i>'},o=Object.keys(i);mw.loader.addStyleTag(".skin-vector #pt-userstatus { margin-top: 0.75em !important; margin-bottom: 0px !important; } .pt-userstatus-img { width: 25px; } .skin-vector .pt-userstatus-img {  margin-top: -0.25em; } .skin-moeskin #pt-userpage-link { display: flex; align-items: center; gap: .1em; @media (max-width: 768px) { #pt-userstatus { display: none; } }"),i.on=i.online,i.off=i.offline,i.break=i.wikibreak,i.sleep=i.sleeping;let s=mw.config.get("wgUserName");if(null===s)return;let r=`User:${s}/Status`,l=new Date().getTime();try{let a=await e.getItem("localStatus");if(mw.config.get("wgPageName")!==r&&"number"==typeof a.timestamp&&a.timestamp>l-6e5&&a.status in i)t=a.status;else throw Error()}catch{try{(t=(await $.ajax({url:`${mw.config.get("wgServer")}${mw.config.get("wgScriptPath")}/index.php`,type:"GET",data:{title:r,action:"raw"},cache:!1})).trim())in i&&await e.setItem("localStatus",{timestamp:l,status:t})}catch{t="_unknown",await e.removeItem("localStatus")}}let u=t in i?i[t]:(()=>{let e=$("<div/>").html(t);return e.find("script, style, link, iframe, frame, object, param, audio, video, base, head, meta, title, body, h1, h2, h3, h4, h5, h6, blockquote, dd, dl, dir, dt, hr, li, ul, ol, pre, a, abbr, br, cite, code, data, em, rb, rp, rt, rtc, ruby, samp, time, tt, var, wbr, area, map, track, applet, embed, noembed, picture, source, canvas, noscript, caption, col, colgroup, table, tbody, thead, tfoot, td, th, tr, button, datalist, fieldset, form, input, label, legend, meter, optgroup, option, output, progress, select, textarea, details, dialog, menu, menuitem, summary, shadow, element, content, slot, template, bgsound, blink, center, command, frameset").remove(),e.find("img").attr("class","pt-userstatus-img"),e.html()})();"moeskin"===mw.config.get("skin")?(a=$('<div id="pt-userstatus" class="search-button-area"><a id="pt-userpage-link" href="javascript:void(0);" dir="auto" title="您的状态"></a></div>'),$("#moe-global-header-inner .user-links").append(a)):(a=$('<li id="pt-userstatus"><a id="pt-userpage-link" href="javascript:void(0);" dir="auto" title="您的状态"></a></li>'),$("#pt-userpage").after(a)),a.find("#pt-userpage-link").html(u).on("click",async()=>{await mw.loader.using(["oojs-ui","mediawiki.api"]);let s=new OO.ui.MessageDialog,l=new OO.ui.WindowManager;$(document.body).append(l.$element),l.addWindows([s]),s.title.$label.html("修改自己的状态");let u=$("<div/>");u.append(`<p>\u{4FEE}\u{6539}<a href="${mw.config.get("wgServer")}${mw.config.get("wgScriptPath")}/${r}">\u{81EA}\u{5DF1}\u{7684}\u{72B6}\u{6001}</a>\u{4E3A}\u{FF1A}</p>`);let n=o.map((e,t)=>"_unknown"===e?void 0:{data:e,label:`${t}`,html:i[e]}).filter(e=>!!e),m=new OO.ui.RadioSelectInputWidget({value:t,options:n.map(e=>{let{data:t,label:a}=e;return{data:t,label:a}})});m.$element.find(".oo-ui-radioSelectWidget > .oo-ui-radioOptionWidget > .oo-ui-labelElement-label").each((e,t)=>{$(t).css("overflow","visible").html((n.filter(e=>{let{label:a}=e;return $(t).text()===a})[0]||{html:$(t).html()}).html)}),u.append(m.$element),u.append(`<p>\u{672C}\u{5DE5}\u{5177}\u{5728}\u{83B7}\u{53D6}\u{72B6}\u{6001}\u{4FE1}\u{606F}\u{540E}\u{6709}10\u{5206}\u{949F}\u{7684}\u{7F13}\u{5B58}\u{FF0C}\u{60A8}\u{53EF}\u{4EE5}\u{901A}\u{8FC7}\u{76F4}\u{63A5}\u{6253}\u{5F00}<a href="${mw.config.get("wgServer")}${mw.config.get("wgScriptPath")}/${r}">\u{81EA}\u{5DF1}\u{7684}\u{72B6}\u{6001}\u{9875}</a>\u{6765}\u{5F3A}\u{5236}\u{83B7}\u{53D6}\u{6700}\u{65B0}\u{72B6}\u{6001}\u{4FE1}\u{606F}\u{3002}`),s.message.$label.append(u);let c=new OO.ui.ActionWidget({action:"confirm",label:"提交",flags:"primary"}),g=new OO.ui.ActionWidget({action:"cancel",label:"取消",flags:"primary"});return g.$element[0].addEventListener("click",()=>{l.closeWindow(s)},{capture:!0}),c.$element[0].addEventListener("click",async()=>{l.closeWindow(s);let o=new OO.ui.MessageDialog;l.addWindows([o]);let u=new OO.ui.ActionWidget({action:"accept",label:"我知道了",flags:"primary"});u.$element[0].addEventListener("click",()=>{l.closeWindow(o)},{capture:!0});try{let s=m.getValue();await new mw.Api().postWithToken("csrf",{action:"edit",title:r,text:s,summary:`\u{4FEE}\u{6539}\u{72B6}\u{6001}\u{4E3A} - ${s}`,tags:"Automation tool",minor:!0}),await e.setItem("localStatus",{timestamp:new Date().getTime(),status:s}),a.find("#pt-userpage-link").html(i[s]),t=s,o.title.$label.html("状态修改完成！"),o.message.$label.html(`<p>\u{4F60}\u{7684}\u{72B6}\u{6001}\u{5DF2}\u{4FEE}\u{6539}\u{4E3A}\u{FF1A}${i[s]}</p>`);let u=new OO.ui.ActionWidget({action:"confirm",label:"确定",flags:"primary"});u.$element[0].addEventListener("click",()=>{l.closeWindow(o)},{capture:!0}),l.openWindow(o,{actions:[u]})}catch(e){o.title.$label.html("状态修改发生错误……"),o.message.$label.html(`\u{9519}\u{8BEF}\u{4FE1}\u{606F}\u{4E3A}\u{FF1A}${e}`),l.openWindow(o,{actions:[u]})}},{capture:!0}),l.openWindow(s,{actions:[c,g]}),!1}),mw.loader.using(["oojs-ui","mediawiki.api"])}catch(e){sessionStorage.getItem("AnnTools-userstatus-img-Error")!==e.toString()&&(alert(`\u{663E}\u{793A}\u{7528}\u{6237}\u{72B6}\u{6001}\u{5DE5}\u{5177}\u{53D1}\u{751F}\u{9519}\u{8BEF}\u{FF1A}
${e}`),sessionStorage.setItem("AnnTools-userstatus-img-Error",e))}})())})();
//# sourceMappingURL=userStatus.min.js.map