(()=>{"use strict";const e=async function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["page","subcat","file"];const t=new mw.Api,n=[];if(mw.config.get("wgUserGroups").some((e=>["bot","flood","patroller","sysop"].includes(e)))){let i="";for(;void 0!==i;){var s;const c=await t.get({action:"query",list:"categorymembers",cmlimit:"max",cmtitle:e,cmtype:a.join("|"),cmcontinue:i});if(c.query.categorymembers[0])for(const e of c.query.categorymembers)n.push(e.title);i=null===(s=c.continue)||void 0===s?void 0:s.cmcontinue}}else{const t=async e=>{const s=await $.ajax(e),i=a.map((e=>{switch(e){case"page":return"#mw-pages li a";case"subcat":return"#mw-subcategories li a";case"file":return"#mw-category-media li a.galleryfilename"}})).join(","),c=$(s).find(i).map(((e,a)=>a.classList.contains("CategoryTreeLabel")?"Category:".concat($(a).text()):a.classList.contains("galleryfilename")?"File:".concat($(a).text()):$(a).text())).get();if(n.push(...c),a.includes("page")){const e=$(s).find('a[href*="&pagefrom="]');e.length>0&&await t(e.eq(0).attr("href"))}if(a.includes("subcat")){const e=$(s).find('a[href*="&subcatfrom="]');e.length>0&&await t(e.eq(0).attr("href"))}if(a.includes("file")){const e=$(s).find('a[href*="&filefrom="]');e.length>0&&await t(e.eq(0).attr("href"))}};await t("/".concat(e,"?action=render"))}return n};mw.loader.using(["mediawiki.notification","mediawiki.api"]).done((()=>{const a=function(e,a){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"复制成功",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"复制失败";const s=a.text();navigator.clipboard.writeText(e).then((()=>{a.text(t),setTimeout((()=>a.text(s)),3e3)}),(e=>{a.text(n),mw.notify("复制失败: ".concat(e),{type:"error",autoHideSeconds:"long"}),setTimeout((()=>a.text(s)),3e3)}))};if(-1===mw.config.get("wgNamespaceNumber")){const e=()=>{$("#mw-content-text>p>strong").after($("<a>[复制列表]</a>").on("click",(e=>{let{target:t}=e;const n=[];$("#mw-whatlinkshere-list>li>a").each(((e,a)=>{n.push($(a).text())})),a(n.join("\n"),$(t),"[复制成功]","[复制失败]")})).css("padding-left",".6em"))},t=()=>{mw.loader.addStyleTag(".search-types{display:flex;float:none;align-items:center;}#bearbintools-searchplus{padding:.5em;user-select:none;}#bearbintools-searchplus a{display:inline;padding:0;}.searchplus-edit{margin-left:.5em;float:right;}");let e=!0;const t=[],n=$(".search-types li").eq(1),s=n.clone(!1);s.children("a").text("替换空间").attr("title","主、模板等替换常用名字空间").attr("href",((e,a)=>a.replace("profile=images","profile=advanced&limit=500&ns0=1&ns2=1&ns6=1&ns10=1&ns12=1&ns14=1&ns828=1"))),s.insertAfter(n),$("a[data-serp-pos]").each(((e,a)=>{t.push(decodeURIComponent($(a).attr("href")).replace("/","").replaceAll("_"," ")),$(a).before('<a class="searchplus-edit" href="'.concat(a.href,'?action=edit">[编辑]</a>'))}));const i=$("<a>隐藏详情</a>").on("click",(a=>{e?($(".searchresult, .mw-search-result-data").hide(),$(".mw-search-results li").css("padding-bottom","0.1em"),$(a.target).text("显示详情"),e=!1):($(".searchresult, .mw-search-result-data").show(),$(".mw-search-results li").css("padding-bottom",""),$(a.target).text("隐藏详情"),e=!0)})),c=$("<a>复制列表</a>").on("click",(e=>{a(t.join("\n"),$(e.target))}));$("#search .search-types, #powersearch .search-types").append($('<div id="bearbintools-searchplus"></div>').append('<span class="mw-editsection-bracket">[</span>',i,'<span class="mw-editsection-divider"> | </span>',c,'<span class="mw-editsection-bracket">]</span>')),$(".mw-search-pager-bottom").clone().prependTo($(".searchresults"))};switch(mw.config.get("wgCanonicalSpecialPageName")){case"Whatlinkshere":e();break;case"Search":t()}}else if(14===mw.config.get("wgNamespaceNumber")){const t=$("#mw-subcategories"),n=$("#mw-pages"),s=$("#mw-category-media");t.find("h2").append($('<span class="mw-editsection"></span>').append('<span class="mw-editsection-bracket">[</span>',$("<a>复制本页</a>").on("click",(e=>{let{target:n}=e;a(t.find("li a").map(((e,a)=>"Category:".concat($(a).text()))).get().join("\n"),$(n))})),t.children("a").length?'<span class="mw-editsection-divider"> | </span>':null,t.children("a").length?$("<a>复制全部</a>").on("click",(async t=>{let{target:n}=t;const s=await e(mw.config.get("wgPageName"),["subcat"]);a(s.join("\n"),$(n))})):null,'<span class="mw-editsection-bracket">]</span>')),n.find("h2").append($('<span class="mw-editsection"></span>').append('<span class="mw-editsection-bracket">[</span>',$("<a>复制本页</a>").on("click",(e=>{let{target:t}=e;a(n.find("li a").map(((e,a)=>$(a).text())).get().join("\n"),$(t))})),n.children("a").length?'<span class="mw-editsection-divider"> | </span>':null,n.children("a").length?$("<a>复制全部</a>").on("click",(async t=>{let{target:n}=t;const s=await e(mw.config.get("wgPageName"),["page"]);a(s.join("\n"),$(n))})):null,'<span class="mw-editsection-bracket">]</span>')),s.find("h2").append($('<span class="mw-editsection"></span>').append('<span class="mw-editsection-bracket">[</span>',$("<a>复制本页</a>").on("click",(e=>{let{target:t}=e;a(s.find("li a.galleryfilename").map(((e,a)=>"File:".concat($(a).text()))).get().join("\n"),$(t))})),s.children("a").length?'<span class="mw-editsection-divider"> | </span>':null,s.children("a").length?$("<a>复制全部</a>").on("click",(async t=>{let{target:n}=t;const s=await e(mw.config.get("wgPageName"),["file"]);a(s.join("\n"),$(n))})):null,'<span class="mw-editsection-bracket">]</span>'))}}))})();