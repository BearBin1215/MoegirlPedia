(()=>{"use strict";var e={},t={};function a(i){var n=t[i];if(void 0!==n)return n.exports;var s=t[i]={exports:{}};return e[i](s,s.exports,a),s.exports}a.rv=()=>"1.4.2",a.ruid="bundler=rspack@1.4.2";let i=async(e,t)=>{let a,i=new mw.Api,n=[],s={action:"query",prop:"transcludedin",titles:e,tilimit:"max"};t&&(s.tinamespace=t);do{let e=await i.post(s);n.push(...(Object.values(e.query.pages)[0].transcludedin||[]).map(e=>{let{title:t}=e;return t})),(a=e.continue?.ticontinue)&&(s.ticontinue=a)}while(a);return n},n=async(e,t)=>{let a,i=new mw.Api,n=[],s={action:"query",prop:"linkshere",titles:e,lhlimit:"max"};t&&(s.lhnamespace=t);do{let e=await i.post(s);n.push(...(Object.values(e.query.pages)[0].linkshere||[]).map(e=>{let{title:t}=e;return t})),(a=e.continue?.lhcontinue)&&(s.lhcontinue=a)}while(a);return n},s=async e=>{let t=new mw.Api,a="",i=[];for(;void 0!==a;){let n=await t.post({action:"query",prop:"redirects",titles:e,rdlimit:"max",rdcontinue:a});i.push(...(Object.values(n.query.pages)[0].redirects||[]).map(e=>{let{title:t}=e;return t})),a=n.continue?.rdcontinue}return i},r=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["page","subcat","file"],a=new mw.Api,i=[];if(mw.config.get("wgUserGroups").some(e=>["bot","flood","patroller","sysop"].includes(e))){let n="";for(;void 0!==n;){let s=await a.post({action:"query",format:"json",utf8:!0,list:"categorymembers",cmlimit:"max",cmtitle:e,cmprop:"title",cmtype:t,cmcontinue:n});s.query.categorymembers[0]&&i.push(...s.query.categorymembers.map(e=>{let{title:t}=e;return t})),n=s.continue?.cmcontinue}}else{let a=async e=>{let n=$(await $.ajax(e)),s=t.map(e=>{switch(e){case"page":return"#mw-pages li a";case"subcat":return"#mw-subcategories li a";case"file":return"#mw-category-media li a.galleryfilename"}}).join(","),r=n.find(s).map((e,t)=>t.classList.contains("CategoryTreeLabel")?`Category:${$(t).text()}`:t.classList.contains("galleryfilename")?`File:${$(t).text()}`:$(t).text()).get();if(i.push(...r),t.includes("page")){let e=n.find('a[href*="&pagefrom="]');e.length&&await a(e.eq(0).attr("href"))}if(t.includes("subcat")){let e=n.find('a[href*="&subcatfrom="]');e.length&&await a(e.eq(0).attr("href"))}if(t.includes("file")){let e=n.find('a[href*="&filefrom="]');e.length&&await a(e.eq(0).attr("href"))}};await a(`/${e}?useskin=vector&safemode=1`)}return i},l=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if("function"==typeof navigator.clipboard?.writeText)await navigator.clipboard.writeText(e);else{let t=document.createElement("input");t.style.position="fixed",t.style.top="-10000px",t.style.zIndex="-999",t.style.opacity="0",document.body.appendChild(t),t.value=e,t.focus(),t.select(),document.execCommand("copy");let a=document.createElement("div");a.tabIndex=-1,document.body.appendChild(a),a.focus(),a.remove(),t.remove()}},o='<span class="mw-editsection-bracket">[</span>',c='<span class="mw-editsection-bracket">]</span>',u='<span class="mw-editsection-divider"> | </span>';mw.loader.using(["mediawiki.notification","mediawiki.api"]).done(()=>{let e,t=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"复制成功",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"复制失败",n=t.text();l(e).then(()=>{t.text(a),setTimeout(()=>t.text(n),3e3)},e=>{t.text(i),mw.notify($(`<span>\u{590D}\u{5236}\u{5931}\u{8D25}: ${e}${e.includes("NotAllowedError")?"<br/>您可能正在使用firefox，或请求响应时间过久，请重新尝试复制。":""}</span>`),{type:"error",autoHideSeconds:"long"}),setTimeout(()=>t.text(n),3e3)})},a=mw.config.get("wgNamespaceNumber");if(-1===a)switch(mw.config.get("wgCanonicalSpecialPageName")){case"Whatlinkshere":$("#mw-whatlinkshere-list").before($('<span class="listenhancer-linkshere" />').append("（",$("<a>复制本页</a>").on("click",e=>{let{target:a}=e;t($("#mw-whatlinkshere-list>li>a").map((e,t)=>$(t).text()).get().join("\n"),$(a))}),$('#mw-content-text a[href*="&from="]').length?" | ":"",$('#mw-content-text a[href*="&from="]').length?$("<a>复制全部</a>").on("click",async a=>{let{target:r}=a;if(!e){let t=new URLSearchParams(location.search),a=mw.config.get("wgRelevantPageName"),r=[t.get("hidetrans")?Promise.resolve([]):i(a),t.get("hidelinks")?Promise.resolve([]):n(a),t.get("hideredirs")?Promise.resolve([]):s(a)];await Promise.all(r).then(t=>{e=[].concat(...t).join("\n")})}t(e,$(r))}):"","）"));break;case"Search":(()=>{$(document.head).append($("<style>.search-types{float:none;align-items:center;display:flex}#bearbintools-listenhancer-search{-webkit-user-select:none;user-select:none;padding:.5em}#bearbintools-listenhancer-search a{padding:0;display:inline}.listenhancer-search-edit{float:right;margin-left:.5em}</style>"));let e=!0,a=[],i=$(".search-types li").eq(1),n=i.clone(!1);n.children("a").text("替换空间").attr("title","主、模板等替换常用名字空间").attr("href",(e,t)=>t.replace("profile=images","profile=advanced&limit=500&ns0=1&ns2=1&ns6=1&ns10=1&ns12=1&ns14=1&ns828=1")),n.insertAfter(i),$("a[data-serp-pos]").each((e,t)=>{a.push(decodeURIComponent(t.href).replace(/(https:\/\/)?m?zh.moegirl.org.cn\//,"").replace(/_/g," ")),$(t).before(`<a class="listenhancer-search-edit" href="${t.href}?action=edit">[\u{7F16}\u{8F91}]</a>`)});let s=$("<a>隐藏详情</a>").on("click",t=>{let{target:a}=t;e?($(".searchresult, .mw-search-result-data").hide(),$(".mw-search-results li").css("padding-bottom","0.1em"),$(a).text("显示详情"),e=!1):($(".searchresult, .mw-search-result-data").show(),$(".mw-search-results li").css("padding-bottom",""),$(a).text("隐藏详情"),e=!0)}),r=$("<a>复制列表</a>").on("click",e=>{let{target:i}=e;t(a.join("\n"),$(i))});$("#search .search-types, #powersearch .search-types").append($('<div id="bearbintools-listenhancer-search" />').append(o,s,u,r,c)),$(".mw-search-pager-bottom").clone().prependTo($(".searchresults"))})()}else if(14===a){let a=function(a,i){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"li a";a.find("h2").append($('<span class="mw-editsection"></span>').append(o,$("<a>复制本页</a>").on("click",e=>{let{target:i}=e;t(a.find(s).map((e,t)=>`${n}${$(t).text()}`).get().join("\n"),$(i))}),a.children("a").length?u:"",a.children("a").length?$("<a>复制全部</a>").on("click",async a=>{let{target:n}=a;e||(e=(await r(mw.config.get("wgPageName"),[i])).join("\n")),t(e,$(n))}):"",c))};a($("#mw-subcategories"),"subcat","Category:"),a($("#mw-pages"),"page"),a($("#mw-category-media"),"file","File:","li a.galleryfilename")}"history"===mw.config.get("wgAction")&&document.getElementById("ca-edit")&&$("#pagehistory>li:not(:first-child)").each((e,t)=>{let a=$(t).attr("data-mw-revid"),i=mw.config.get("wgScript");$(t).children(".mw-history-undo").children("a:first-child").after(` | <a title="\u{7F16}\u{8F91}\u{81EA}\u{6B64}\u{7248}\u{672C}" href="${i}?action=edit&oldid=${a}&summary=\u{7F16}\u{8F91}\u{81EA}[[Special:Permanentlink/${a}|\u{7248}\u{672C}${a}]]">\u{7F16}\u{8F91}</a>`),e===$("#pagehistory>li:not(:first-child)").length-1&&$(t).append(`\u{FF08}<span class="mw-history-undo"><a title="\u{7F16}\u{8F91}\u{81EA}\u{6B64}\u{7248}\u{672C}" href="${i}?action=edit&oldid=${a}&summary=\u{7F16}\u{8F91}\u{81EA}[[Special:Permanentlink/${a}|\u{7248}\u{672C}${a}]]">\u{7F16}\u{8F91}</a></span>\u{FF09}`)})})})();
//# sourceMappingURL=ListEnhancer.min.js.map