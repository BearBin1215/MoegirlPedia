(()=>{var e={7018:function(e,t,n){"use strict";n.d(t,{Z:()=>l});var r=n(9415),o=n.n(r),i=n(3018),a=n.n(i)()(o());a.push([e.id,".bearbintools-loger .loger-clear{margin-left:.3em;font-size:.9em;font-weight:400}.bearbintools-loger .loger-body{background:#ffffffb3;border:1px solid #ccc;padding:.3em;display:flow-root}.bearbintools-loger .loger-filter{float:right;padding:.4em}.bearbintools-loger .loger-filter>div{cursor:pointer;border-radius:.3em;margin-bottom:.2em;padding-right:.2em}.bearbintools-loger .loger-filter>div.loger-filter-selected{background-color:#7f7f7f12}.bearbintools-loger .loger-filter .loger-filter-icon{text-align:center;width:1.2em;height:1em;line-height:1em;display:inline-block}.bearbintools-loger .loger-lines{max-height:20em;font-family:monospace;list-style:inside;overflow-y:auto}.bearbintools-loger .loger-lines>li a{color:inherit;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}","",{version:3,sources:["webpack://./src/components/Loger/index.less"],names:[],mappings:"AADA,iCAAA,gBAAA,CAAA,cAAA,CAAA,eAAA,CAKA,gCAAA,oBAAA,CAAA,qBAAA,CAAA,YAAA,CAAA,iBAAA,CAMA,kCAAA,WAAA,CAAA,YAAA,CAIA,sCAAA,cAAA,CAAA,kBAAA,CAAA,kBAAA,CAAA,kBAAA,CAMA,4DAAA,0BAAA,CAGA,qDAAA,iBAAA,CAAA,WAAA,CAAA,UAAA,CAAA,eAAA,CAAA,oBAAA,CAOA,iCAAA,eAAA,CAAA,qBAAA,CAAA,iBAAA,CAAA,eAAA,CAMA,sCAAA,aAAA,CAAA,wCAAA,CAAA,gCAAA",sourcesContent:[".bearbintools-loger .loger-clear {\n  margin-left: 0.3em;\n  font-size: 0.9em;\n  font-weight: normal;\n}\n.bearbintools-loger .loger-body {\n  display: flow-root;\n  padding: 0.3em;\n  border: 1px solid #ccc;\n  background: rgba(255, 255, 255, 0.7);\n}\n.bearbintools-loger .loger-filter {\n  float: right;\n  padding: 0.4em;\n}\n.bearbintools-loger .loger-filter > div {\n  border-radius: 0.3em;\n  margin-bottom: 0.2em;\n  padding-right: 0.2em;\n  cursor: pointer;\n}\n.bearbintools-loger .loger-filter > div.loger-filter-selected {\n  background-color: rgba(127, 127, 127, 0.07);\n}\n.bearbintools-loger .loger-filter .loger-filter-icon {\n  display: inline-block;\n  width: 1.2em;\n  height: 1em;\n  line-height: 1em;\n  text-align: center;\n}\n.bearbintools-loger .loger-lines {\n  max-height: 20em;\n  overflow-y: auto;\n  list-style: inside;\n  font-family: monospace;\n}\n.bearbintools-loger .loger-lines > li a {\n  color: inherit;\n  text-decoration: underline dotted;\n}\n"],sourceRoot:""}]);let l=a},363:function(e,t,n){"use strict";n.d(t,{Z:()=>l});var r=n(9415),o=n.n(r),i=n(3018),a=n.n(i)()(o());a.push([e.id,".bearbingadget-exportxml #firstHeading{flex-wrap:wrap;justify-content:space-between;align-items:flex-end;display:flex}.bearbingadget-exportxml #firstHeading>div{font-size:.6em}#exportxml-exportbutton{margin-top:.6em}#exportxml-log .loger-headline{display:none}#exportxml-log .loger-body{min-height:5em}#exportxml-log .loger-filter{display:none}","",{version:3,sources:["webpack://./src/gadgets/ExportXML/index.less"],names:[],mappings:"AADA,uCAAA,cAAA,CAAA,6BAAA,CAAA,oBAAA,CAAA,YAAA,CAMA,2CAAA,cAAA,CAGA,wBAAA,eAAA,CAGA,+BAAA,YAAA,CAGA,2BAAA,cAAA,CAGA,6BAAA,YAAA",sourcesContent:[".bearbingadget-exportxml #firstHeading {\n  display: flex;\n  flex-wrap: wrap;\n  justify-content: space-between;\n  align-items: flex-end;\n}\n.bearbingadget-exportxml #firstHeading > div {\n  font-size: 0.6em;\n}\n#exportxml-exportbutton {\n  margin-top: 0.6em;\n}\n#exportxml-log .loger-headline {\n  display: none;\n}\n#exportxml-log .loger-body {\n  min-height: 5em;\n}\n#exportxml-log .loger-filter {\n  display: none;\n}\n"],sourceRoot:""}]);let l=a},3018:function(e){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n="",r=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),r&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),r&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n}).join("")},t.i=function(e,n,r,o,i){"string"==typeof e&&(e=[[null,e,void 0]]);var a={};if(r)for(var l=0;l<this.length;l++){var s=this[l][0];null!=s&&(a[s]=!0)}for(var c=0;c<e.length;c++){var u=[].concat(e[c]);r&&a[u[0]]||(void 0!==i&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=i),n&&(u[2]&&(u[1]="@media ".concat(u[2]," {").concat(u[1],"}")),u[2]=n),o&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=o):u[4]="".concat(o)),t.push(u))}},t}},9415:function(e){"use strict";e.exports=function(e){var t=e[1],n=e[3];if(!n)return t;if("function"==typeof btoa){var r=btoa(unescape(encodeURIComponent(JSON.stringify(n))));return[t].concat(["/*# ".concat("sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(r)," */")]).join("\n")}return[t].join("\n")}},149:function(e,t){var n;"undefined"!=typeof globalThis||"undefined"!=typeof self&&self,n=function(e){"use strict";function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function n(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?t(Object(o),!0).forEach(function(t){r(e,t,o[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function r(e,t,n){var r;return(r=function(e,t){if("object"!=a(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=a(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"),(t="symbol"==a(r)?r:String(r))in e)?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){if(e){if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.toXML=e.default=void 0;var l={ARRAY:"array",BOOLEAN:"boolean",DATE:"date",FUNCTION:"function",JSTOXML_OBJECT:"jstoxml-object",NULL:"null",NUMBER:"number",OBJECT:"object",STRING:"string"},s=[l.STRING,l.NUMBER,l.BOOLEAN],c=["_selfCloseTag","_attrs"],u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.repeat(t)},d=function(e){return Array.isArray(e)&&l.ARRAY||a(e)===l.OBJECT&&null!==e&&e._name&&l.JSTOXML_OBJECT||e instanceof Date&&l.DATE||null===e&&l.NULL||a(e)},p=function(e){return e.startsWith("<![CDATA[")},f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=e;if(a(e)===l.STRING){if(p(e))return e;var o=RegExp("(".concat(Object.keys(t).join("|"),")(?!(\\w|#)*;)"),"g");r=String(e).replace(o,function(e,n){return t[n]||""})}return"function"==typeof n?n(r):r},m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;return(Array.isArray(e)?e:Object.entries(e).map(function(e){var t=function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],s=!0,c=!1;try{i=(n=n.call(e)).next,!1;for(;!(s=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);s=!0);}catch(e){c=!0,o=e}finally{try{if(!s&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,2)||o(e,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}();return r({},t[0],t[1])})).reduce(function(e,r){var o=Object.keys(r)[0],s=r[o];if(a(n)===l.FUNCTION&&n(o,s))return e;var c=t?f(s,t):s;return e.push("".concat(o).concat(i||!0!==c?'="'.concat(c,'"'):"")),e},[])},g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,o=m(e,t,n,r);if(0===o.length)return"";var i=o.join(" ");return" ".concat(i)},A=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.keys(e).map(function(t){return{_name:t,_content:e[t]}})},h=function(e){return s.includes(d(e))},b=function(e){var t=e.header,n=e.isOutputStart;return t&&n?a(t)===l.BOOLEAN?'<?xml version="1.0" encoding="UTF-8"?>':t:""},y={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"},v=e.toXML=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=r.depth,m=void 0===s?0:s,v=r.indent,w=r._isFirstItem,x=r._isOutputStart,C=void 0===x||x,O=r.header,_=r.attributeReplacements,T=void 0===_?{}:_,B=r.attributeFilter,L=r.attributeExplicitTrue,S=r.contentReplacements,j=void 0===S?{}:S,E=r.contentMap,k=r.selfCloseTags,M="boolean"!=typeof T||T?n(n({},y),T):{},D="boolean"!=typeof j||j?n(n({},y),j):{},F="string"==typeof v,I=u(v,m),N=d(t),R=b({header:O,indent:v,depth:m,isOutputStart:C}),P=C&&!R&&w&&0===m,U=F&&!P?"\n":"",q="";switch(N){case l.JSTOXML_OBJECT:var H=t._name,X=t._content;if(null===X&&"function"!=typeof E){q="".concat(U).concat(I).concat(H);break}if(Array.isArray(X)&&X.every(h))return X.map(function(t){return e({_name:H,_content:t},n(n({},r),{},{depth:m,_isOutputStart:!1}))}).join("");if(c.includes(H))break;var J=e(X,n(n({},r),{},{depth:m+1,_isOutputStart:P})),Y=d(J),Z=!J.match("<"),G=p(J),W="".concat(U).concat(I);if("_comment"===H){q+="".concat(W,"\x3c!-- ").concat(X," --\x3e");break}var z="undefined"===Y||""===J,V=t._selfCloseTag,K=a(V)===l.BOOLEAN?z&&V:z&&(void 0===k||k),Q=g(t._attrs,M,B,void 0!==L&&L),ee="<".concat(H).concat(Q).concat(K?"/":"",">"),et=!F||Z||G?"":"\n".concat(I),en=K?"":"".concat(J).concat(et,"</").concat(H,">");q+="".concat(W).concat(ee).concat(en);break;case l.OBJECT:var er=Object.keys(t);q=er.map(function(a,s){var u=n(n({},r),{},{_isFirstItem:0===s,_isLastItem:s+1===er.length,_isOutputStart:P}),p={_name:a};if(d(t[a])===l.OBJECT&&(c.forEach(function(e){var n=t[a][e];void 0!==n&&(p[e]=n,delete t[a][e])}),void 0!==t[a]._content&&Object.keys(t[a]).length>1)){var f,m=Object.assign({},t[a]);delete m._content,p._content=[].concat(function(e){if(Array.isArray(e))return i(e)}(f=A(m))||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(f)||o(f)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),[t[a]._content])}return void 0===p._content&&(p._content=t[a]),e(p,u)},r).join("");break;case l.FUNCTION:q=e(t(r),r);break;case l.ARRAY:q=t.map(function(o,i){return e(o,n(n({},r),{},{_isFirstItem:0===i,_isLastItem:i+1===t.length,_isOutputStart:P}))}).join("");break;default:q=f(t,D,E)}return"".concat(R).concat(q)};e.default={toXML:v}},"function"==typeof define&&define.amd?define(["exports"],n):n(t)},85:function(e){"use strict";var t=[];function n(e){for(var n=-1,r=0;r<t.length;r++)if(t[r].identifier===e){n=r;break}return n}function r(e,r){for(var o={},i=[],a=0;a<e.length;a++){var l=e[a],s=r.base?l[0]+r.base:l[0],c=o[s]||0,u="".concat(s," ").concat(c);o[s]=c+1;var d=n(u),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==d)t[d].references++,t[d].updater(p);else{var f=function(e,t){var n=t.domAPI(t);return n.update(e),function(t){t?(t.css!==e.css||t.media!==e.media||t.sourceMap!==e.sourceMap||t.supports!==e.supports||t.layer!==e.layer)&&n.update(e=t):n.remove()}}(p,r);r.byIndex=a,t.splice(a,0,{identifier:u,updater:f,references:1})}i.push(u)}return i}e.exports=function(e,o){var i=r(e=e||[],o=o||{});return function(e){e=e||[];for(var a=0;a<i.length;a++){var l=n(i[a]);t[l].references--}for(var s=r(e,o),c=0;c<i.length;c++){var u=n(i[c]);0===t[u].references&&(t[u].updater(),t.splice(u,1))}i=s}}},9931:function(e){"use strict";var t={};e.exports=function(e,n){var r=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!r)throw Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},6300:function(e){"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},7342:function(e,t,n){"use strict";e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},1417:function(e){"use strict";e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){var r,o,i;r="",n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {")),(o=void 0!==n.layer)&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,o&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}"),(i=n.sourceMap)&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),e.styleTagTransform(r,t,e.options)},remove:function(){!function(e){if(null!==e.parentNode)e.parentNode.removeChild(e)}(t)}}}},1514:function(e){"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={id:r,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.nc=void 0,n.rv=()=>"1.4.2",n.ruid="bundler=rspack@1.4.2",(()=>{"use strict";var e=n(149);let t=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["page","subcat","file"],n=new mw.Api,r=[];if(mw.config.get("wgUserGroups").some(e=>["bot","flood","patroller","sysop"].includes(e))){let o="";for(;void 0!==o;){let i=await n.post({action:"query",format:"json",utf8:!0,list:"categorymembers",cmlimit:"max",cmtitle:e,cmprop:"title",cmtype:t,cmcontinue:o});i.query.categorymembers[0]&&r.push(...i.query.categorymembers.map(e=>{let{title:t}=e;return t})),o=i.continue?.cmcontinue}}else{let n=async e=>{let o=$(await $.ajax(e)),i=t.map(e=>{switch(e){case"page":return"#mw-pages li a";case"subcat":return"#mw-subcategories li a";case"file":return"#mw-category-media li a.galleryfilename"}}).join(","),a=o.find(i).map((e,t)=>t.classList.contains("CategoryTreeLabel")?`Category:${$(t).text()}`:t.classList.contains("galleryfilename")?`File:${$(t).text()}`:$(t).text()).get();if(r.push(...a),t.includes("page")){let e=o.find('a[href*="&pagefrom="]');e.length&&await n(e.eq(0).attr("href"))}if(t.includes("subcat")){let e=o.find('a[href*="&subcatfrom="]');e.length&&await n(e.eq(0).attr("href"))}if(t.includes("file")){let e=o.find('a[href*="&filefrom="]');e.length&&await n(e.eq(0).attr("href"))}};await n(`/${e}?useskin=vector&safemode=1`)}return r},r=e=>e.split("\n").filter(e=>e&&e.trim()),o=e=>new Promise(t=>setTimeout(t,e)),i=e=>e.replace(/^ *(?:Category:|CAT:|分[类類]:)?(.*)$/i,"Category:$1"),a=e=>{let t=document.createElement("template");return t.innerHTML=e.trim(),t.content.children[0]};var l=n(85),s=n.n(l),c=n(1417),u=n.n(c),d=n(9931),p=n.n(d),f=n(7342),m=n.n(f),g=n(6300),A=n.n(g),h=n(1514),b=n.n(h),y=n(7018),v={};v.styleTagTransform=b(),v.setAttributes=m(),v.insert=p().bind(null,"head"),v.domAPI=u(),v.insertStyleElement=A(),s()(y.Z,v),y.Z&&y.Z.locals&&y.Z.locals;class w{_logTypes={success:{icon:"✓",color:"#333",text:"完成"},warn:{icon:"!",color:"#f28500",text:"警告"},error:{icon:"✕",color:"#eb3941",text:"出错"}};element;headline;body=a('<div class="loger-body"></div>');logerLines=a('<ul class="loger-lines"></ul>');logDetails=[];filterButtons={};constructor(e=[],t="",n="h3"){for(let t in e.length>0&&(this._logTypes=e.reduce((e,t)=>{let{name:n,icon:r,color:o,text:i}=t;return e[n]={icon:r,color:o,text:i},e},{})),this._logTypes)this._logTypes[t].show=!0;this.headline=a(`<${n} class="loger-headline"></${n}>`);let r=a('<a class="loger-clear">[清空]</a>');r.addEventListener("click",this.clear.bind(this));let o=a('<nav class="loger-filter"></nav>');for(let[e,{icon:t,color:n,text:r}]of Object.entries(this._logTypes)){let i=a(`<div class="loger-filter-selected loger-${e}" style="color:${n}"></div>`),l=a('<span class="loger-filter-icon"></span>');l.append(t);let s=a('<span class="loger-filter-count">0</span>');i.append(l,s,` ${r}`),i.addEventListener("click",()=>{this._logTypes[e].show?(i.classList.remove("loger-filter-selected"),this.logerLines.classList.add(`loger-${e}-hidden`),this.logDetails.filter(t=>t.type===e).forEach(e=>{e.element.style.display="none"}),this._logTypes[e].show=!1):(i.classList.add("loger-filter-selected"),this.logerLines.classList.remove(`loger-${e}-hidden`),this.logDetails.filter(t=>t.type===e).forEach(e=>{e.element.style.display=""}),this._logTypes[e].show=!0)}),this.filterButtons[e]={button:i,countElement:s},o.appendChild(i)}this.element=a(`<div class="bearbintools-loger" id="${t||""}"></div>`),this.headline.append("日志",r),this.body.append(o,this.logerLines),this.element.append(this.headline,this.body)}record(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"normal",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Date().toLocaleTimeString(),r=document.createElement("li");return r.classList.add("loger-record",`loger-${t}`),r.innerHTML=`${n} - ${e}`,r.style.color=this._logTypes[t]?.color||"#222",this._logTypes[t]?.show===!1&&(r.style.display="none"),this.logerLines.appendChild(r),this.logerLines.scrollTop=this.logerLines.scrollHeight,this.logDetails.push({element:r,type:t}),this.filterButtons[t]&&(this.filterButtons[t].countElement.innerText=String(+this.filterButtons[t].countElement.innerText+1)),r}clear(){for(let e in this.logDetails.length=0,this.logerLines.innerHTML="",this.filterButtons)this.filterButtons[e].countElement.innerText="0"}}let x=async()=>{let e=new mw.Api,{query:{general:{sitename:t,dbname:n,base:r,generator:o,case:i,lang:a},namespaces:l}}=await e.post({action:"query",meta:"siteinfo",siprop:["general","namespaces"]});return{_name:"mediawiki",_attrs:{xmlns:"http://www.mediawiki.org/xml/export-0.11/","xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","xsi:schemaLocation":"http://www.mediawiki.org/xml/export-0.11/ http://www.mediawiki.org/xml/export-0.11.xsd",version:"0.11","xml:lang":a},_content:[{siteinfo:{sitename:t,dbname:n||"medaiwiki",base:r,generator:o,case:i,namespaces:Object.entries(l).map(e=>{let[t,{case:n,"*":r}]=e;return{_name:"namespace",_attrs:{key:t,case:n},_content:r}})}}]}};var C=n(363),O={};O.styleTagTransform=b(),O.setAttributes=m(),O.insert=p().bind(null,"head"),O.domAPI=u(),O.insertStyleElement=A(),s()(C.Z,O),C.Z&&C.Z.locals&&C.Z.locals,$(()=>(async()=>{if(!["Special:ExportXML","Special:Export","Special:导出页面"].includes(mw.config.get("wgPageName"))){"ExportXML"in window&&(await mw.loader.using("mediawiki.util"),mw.util.addPortletLink("p-tb","/Special:ExportXML","导出页面","t-exportxml"));return}await mw.loader.using(["mediawiki.api","oojs-ui","moment"]);let n=new mw.Api,a=new w([{name:"success",icon:"✓",color:"#333",text:"成功"},{name:"error",icon:"✕",color:"#eb3941",text:"出错"}],"exportxml-log");mw.config.set("wgCanonicalSpecialPageName","ExportXML"),document.title="导出页面 - 萌娘百科_万物皆可萌的百科全书",$(document.body).addClass("bearbingadget-exportxml"),$(".mw-invalidspecialpage").removeClass("mw-invalidspecialpage"),$("#firstHeading").html('导出页面<div>By <a href="/User:BearBin">BearBin</a></div>'),$("#contentSub").remove();let l=new OO.ui.MultilineTextInputWidget({rows:5}),s=new OO.ui.MultilineTextInputWidget({rows:10}),c=new OO.ui.ButtonWidget({label:"导出",flags:["primary","progressive"],id:"exportxml-exportbutton"}),u=new OO.ui.CheckboxInputWidget({selected:!0});$("#mw-content-text").empty().append($("<p />").append("本页面用于",$('<a href="https://www.mediawiki.org/wiki/Help:Export/zh">导出</a>'),"特定页面的文本和编辑历史，导出的XML可用于在其他站点通过",$('<a href="/Special:Import">导入功能</a>'),"重新导入。"),$("<p />").append("由于萌娘百科未开放导出功能，本工具仅对其进行","<b>尽可能地</b>","复现，实际用时远高于MediaWiki提供的标准导出功能，且没有递归导出所使用模板的功能（理论上能做，但暂时不考虑）。"),"<p>为了避免WAF，部分导出步骤已被刻意放缓，每两个页面需要等待约5s，在导出时请耐心等待，并请尽量避免额外的访问（如边导出边浏览或编辑）</p>","<p>在下方的分类列表或页面列表输入，一行一个。对于每个分类，会获取其各自的分类和文件，不含子分类。</p>","<p>由机器人等持有“在API查询中使用更高的上限”<code>(apihighlimits)</code>权限的账号执行可以获得更快的导出速度。</p>","<h3>指定分类内的页面</h3>",l.$element,"<h3>手动输入页面</h3>",s.$element,new OO.ui.FieldLayout(u,{label:"仅包含当前修订，而不是完整历史",align:"inline"}).$element,c.$element,"<h3>日志</h3>",a.element);let d=async()=>{let e=r(s.getValue());for(let n of r(l.getValue())){let r=i(n),o=await t(r,["page","file"]);a.record(`\u{5206}\u{7C7B}\u{3010}<a href="/${r}">${n}</a>\u{3011}\u{4E0B}\u{83B7}\u{53D6}\u{5230}${o.length}\u{4E2A}\u{9875}\u{9762}\u{3002}`),e.push(...o)}return[...new Set(e)]},p=async(e,t)=>{let r,i={revisions:[]};do{let a={action:"query",prop:"revisions",titles:e,rvprop:["content","ids","flags","timestamp","user","userid","size","sha1","contentmodel","comment","tags"],rvlimit:t?1:"max",rvdir:t?"older":"newer"};r&&(a.rvcontinue=r,await o(4e3));let l=await n.get(a);r=l.continue?.rvcontinue;let[s]=Object.values(l.query.pages);i.id=s.pageid,i.ns=s.ns,i.title=s.title,s.revisions&&i.revisions.push(...s.revisions)}while(!t&&r);return i},f=(e,t)=>({revision:[{id:e.revid},{parentid:e.parentid},{timestamp:e.timestamp},{_name:"contributor",_attrs:"contributorhidden"in e?{deleted:"deleted"}:{},_content:"contributorhidden"in e?{}:{username:e.user,id:e.userid}},..."minor"in e?[{minor:e.minor}]:[],..."bot"in e?[{bot:e.bot}]:[],..."sha1hidden"in e?[{sha1hidden:e.sha1hidden}]:[],..."texthidden"in e?[{texthidden:e.texthidden}]:[],..."commenthidden"in e?[{commenthidden:e.commenthidden}]:[],{_name:"comment",_attrs:"commenthidden"in e?{deleted:"deleted"}:{},_content:e.comment},{origin:t},{model:e.contentmodel},{format:e.contentformat},{_name:"text",_attrs:"texthidden"in e?{bytes:e.size,sha1:e.sha1,deleted:"deleted"}:{bytes:e.size,sha1:e.sha1,"xml:space":"preserve"},_content:e["*"]?.replace(/&/g,"&amp;")}]});c.on("click",async()=>{let t;c.setDisabled(!0);let n=await d();if(!n.length)return void c.setDisabled(!1);let r=u.isSelected(),i=a.record("正在读取站点基本信息……");try{t=await x(),i.remove(),a.record(`\u{6B63}\u{5728}\u{8BFB}\u{53D6}\u{7AD9}\u{70B9}\u{57FA}\u{672C}\u{4FE1}\u{606F}\u{2026}\u{2026}\u{6210}\u{529F}\u{3002}`)}catch(e){i.remove(),a.record(`\u{8BFB}\u{53D6}\u{7AD9}\u{70B9}\u{57FA}\u{672C}\u{4FE1}\u{606F}\u{5931}\u{8D25}\u{FF1A}${e}`,"error"),c.setDisabled(!1);return}for(let e of n){await o(4e3);try{a.record(`\u{6B63}\u{5728}\u{8BFB}\u{53D6}\u{9875}\u{9762}<a href="/${e}">${e}</a>\u{5386}\u{53F2}\u{2026}\u{2026}`);let{title:n,ns:o,id:i,revisions:l}=await p(e,r);i?t._content.push({page:[{title:n},{ns:o},{id:i},...l.map(e=>f(e,i))]}):a.record(`\u{9875}\u{9762}${e}\u{4E0D}\u{5B58}\u{5728}\u{3002}`,"error")}catch(t){a.record(`\u{8BFB}\u{53D6}\u{9875}\u{9762}${e}\u{5386}\u{53F2}\u{5931}\u{8D25}\u{FF1A}${t}\u{FF0C}\u{5DF2}\u{8DF3}\u{8FC7}\u{3002}`,"error")}}a.record("数据获取完毕，正在保存。"),function(e,t){let n=new Blob([t],{type:"text/plain"}),r=URL.createObjectURL(n),o=document.createElement("a");o.href=r,o.download=e,o.style.display="none",document.body.appendChild(o),o.click(),URL.revokeObjectURL(r),document.body.removeChild(o)}(`${mw.config.get("wgSiteName")}-${moment().format("YYYYMMDDHHmmss")}.xml`,(0,e.toXML)(t,{indent:"  "})),c.setDisabled(!1)})})())})()})();
//# sourceMappingURL=ExportXML.min.js.map