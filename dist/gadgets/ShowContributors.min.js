(()=>{"use strict";var t={},e={};function o(i){var r=e[i];if(void 0!==r)return r.exports;var n=e[i]={exports:{}};return t[i](n,n.exports,o),n.exports}o.rv=()=>"1.4.2",o.ruid="bundler=rspack@1.4.2",$(()=>(async()=>{if(![0,2,4,10,12,14,828,274].includes(mw.config.get("wgNamespaceNumber"))||0===mw.config.get("wgArticleId")||!["view","history"].includes(mw.config.get("wgAction")))return;mw.loader.addStyleTag("#show-contributor-button{float:right;margin-left:.5em;margin-right:0}#show-contributor-header{text-align:center;background:#fff;border-bottom:1px solid #aaa;padding:.3em;font-weight:600;position:sticky;top:0}#show-contributor-headline{font-size:1.3em}#show-contributor-close{cursor:pointer;border-radius:50%;position:absolute;top:5px;right:5px}#show-contributor-close:hover{background-color:#eee}#show-contributor-table{width:100%;margin:0}#show-contributor-table .user-avatar{border-radius:50%;width:20px;height:20px}"),await mw.loader.using(["mediawiki.api","mediawiki.notification","oojs-ui","oojs-ui.styles.icons-interactions","jquery.tablesorter"]);class t extends OO.ui.Dialog{$table=$('<table id="show-contributor-table" class="wikitable" />');$tbody=$("<tbody />");$head;$body;got=!1;static static={...super.static,name:"ShowContributor",tagName:"div"};initialize(){return super.initialize(),this.$head.append("1"),this.$body.append($('<div id="show-contributor-header" />').append($('<div id="show-contributor-headline">本页贡献统计</div>'),new OO.ui.IconWidget({icon:"close",id:"show-contributor-close"}).$element.on("click",()=>this.close())),this.$table.append($("<thead><th>用户</th><th>编辑数</th><th>增加字节数</th><th>删减字节数</th></thead>"),this.$tbody)),this}getContributors=async()=>{let t=new mw.Api,e={},o="",i=0,r={action:"query",format:"json",prop:"revisions",titles:mw.config.get("wgPageName"),rvprop:"user|size",rvlimit:"max",rvdir:"newer"};do{o&&(r.rvcontinue=o);try{let n=await t.get(r);for(let{user:t,size:r}of(o=n.continue?.rvcontinue,Object.values(n.query.pages)[0].revisions))e[t]||=[],e[t].push(r-i),i=r}catch(t){mw.notify(`\u{83B7}\u{53D6}\u{7F16}\u{8F91}\u{8BB0}\u{5F55}\u{5931}\u{8D25}\u{FF1A}${t}`,{type:"error"})}}while(o);return e};addRow=(t,e)=>{let{user:o,count:i,add:r,remove:n}=e;t.append($("<tr />").append($("<td />").append($(`<a href="${mw.config.get("wgArticlePath").replace("$1",`User:${o}`)}" />`).append(`<img class="user-avatar" src="https://commons.moegirl.org.cn/extensions/Avatar/avatar.php?user=${o}" />`,o)),`<td>${i}</td>`,`<td>${r}</td>`,`<td>${n}</td>`))};showContributors=t=>{for(let e in this.$tbody.empty(),t)this.addRow(this.$tbody,{user:e,count:t[e].length,add:t[e].reduce((t,e)=>e>0?t+e:t,0),remove:t[e].reduce((t,e)=>e<0?t+e:t,0)});this.got=!0}}let e=new OO.ui.WindowManager({id:"show-contributor"});$(document.body).append(e.$element);let o=new t({size:"large"});e.addWindows([o]);let i=new OO.ui.ButtonWidget({label:"本页贡献者",icon:"search",flags:"progressive",id:"show-contributor-button"});"moeskin"===mw.config.get("skin")?$("#tagline").prepend(i.$element):$("#bodyContent").prepend(i.$element),i.on("click",async()=>{if(!o.got){i.setLabel("正在查询");let t=await o.getContributors();o.showContributors(t),o.$table.tablesorter(),i.setLabel("本页贡献者")}e.openWindow(o)})})())})();
//# sourceMappingURL=ShowContributors.min.js.map