(()=>{"use strict";var e={466:function(e,t,n){n.d(t,{Z:()=>s});var a=n(812),i=n.n(a),r=n(78),o=n.n(r)()(i());o.push([e.id,"#pagehistory li.before input[name=diff],#pagehistory li.between input[type=radio],#pagehistory li.after input[name=oldid]{visibility:unset}.bearbintool-historyviewer .userlink-avatar-small{max-width:1.5em;max-height:1.5em}","",{version:3,sources:["webpack://./src/gadgets/HistoryViewer/index.less"],names:[],mappings:"AADA,0HAAA,gBAAA,CAKA,kDAAA,eAAA,CAAA,gBAAA",sourcesContent:['#pagehistory li.before input[name="diff"],\n#pagehistory li.between input[type="radio"],\n#pagehistory li.after input[name="oldid"] {\n  visibility: unset;\n}\n.bearbintool-historyviewer .userlink-avatar-small {\n  max-width: 1.5em;\n  max-height: 1.5em;\n}\n'],sourceRoot:""}]);let s=o},78:function(e){e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n="",a=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),a&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),a&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n}).join("")},t.i=function(e,n,a,i,r){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(a)for(var s=0;s<this.length;s++){var c=this[s][0];null!=c&&(o[c]=!0)}for(var p=0;p<e.length;p++){var d=[].concat(e[p]);a&&o[d[0]]||(void 0!==r&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=r),n&&(d[2]&&(d[1]="@media ".concat(d[2]," {").concat(d[1],"}")),d[2]=n),i&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=i):d[4]="".concat(i)),t.push(d))}},t}},812:function(e){e.exports=function(e){var t=e[1],n=e[3];if(!n)return t;if("function"==typeof btoa){var a=btoa(unescape(encodeURIComponent(JSON.stringify(n))));return[t].concat(["/*# ".concat("sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(a)," */")]).join("\n")}return[t].join("\n")}},792:function(e){var t=[];function n(e){for(var n=-1,a=0;a<t.length;a++)if(t[a].identifier===e){n=a;break}return n}function a(e,a){for(var i={},r=[],o=0;o<e.length;o++){var s=e[o],c=a.base?s[0]+a.base:s[0],p=i[c]||0,d="".concat(c," ").concat(p);i[c]=p+1;var l=n(d),u={css:s[1],media:s[2],sourceMap:s[3],supports:s[4],layer:s[5]};if(-1!==l)t[l].references++,t[l].updater(u);else{var f=function(e,t){var n=t.domAPI(t);return n.update(e),function(t){t?(t.css!==e.css||t.media!==e.media||t.sourceMap!==e.sourceMap||t.supports!==e.supports||t.layer!==e.layer)&&n.update(e=t):n.remove()}}(u,a);a.byIndex=o,t.splice(o,0,{identifier:d,updater:f,references:1})}r.push(d)}return r}e.exports=function(e,i){var r=a(e=e||[],i=i||{});return function(e){e=e||[];for(var o=0;o<r.length;o++){var s=n(r[o]);t[s].references--}for(var c=a(e,i),p=0;p<r.length;p++){var d=n(r[p]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}r=c}}},430:function(e){var t={};e.exports=function(e,n){var a=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!a)throw Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(n)}},685:function(e){e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},937:function(e,t,n){e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},677:function(e){e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){var a,i,r;a="",n.supports&&(a+="@supports (".concat(n.supports,") {")),n.media&&(a+="@media ".concat(n.media," {")),(i=void 0!==n.layer)&&(a+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),a+=n.css,i&&(a+="}"),n.media&&(a+="}"),n.supports&&(a+="}"),(r=n.sourceMap)&&"undefined"!=typeof btoa&&(a+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),e.styleTagTransform(a,t,e.options)},remove:function(){!function(e){if(null!==e.parentNode)e.parentNode.removeChild(e)}(t)}}}},766:function(e){e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}},t={};function n(a){var i=t[a];if(void 0!==i)return i.exports;var r=t[a]={id:a,exports:{}};return e[a](r,r.exports,n),r.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.nc=void 0,n.rv=()=>"1.4.11",n.ruid="bundler=rspack@1.4.11",(()=>{let e=async(e,t)=>{let n=new mw.Api,[a]=Object.values((await n.post({action:"query",prop:"revisions",titles:e,rvprop:"content",...t})).query.pages);if("revisions"in a)return a.revisions?.[0]["*"];if("missing"in a)throw"missingtitle"};var t=n(792),a=n.n(t),i=n(677),r=n.n(i),o=n(430),s=n.n(o),c=n(937),p=n.n(c),d=n(685),l=n.n(d),u=n(766),f=n.n(u),m=n(466),v={};v.styleTagTransform=f(),v.setAttributes=p(),v.insert=s().bind(null,"head"),v.domAPI=r(),v.insertStyleElement=l(),a()(m.Z,v),m.Z&&m.Z.locals&&m.Z.locals,mw.loader.using("mediawiki.api").then(()=>{let t=new URLSearchParams(location.search),n=t.get("oldid"),a=t.get("diff"),i=$("#mw-content-text>.moderation-notice"),r=new mw.Api,o=mw.config.get("wgPageContentModel"),s=mw.config.get("wgPageName"),c={javascript:"js",json:"json",css:"css","sanitized-css":"css",Scribunto:"lua"},p=e=>{e.addClass(`prettyprint lang-${c[o]} linenums`),"function"==typeof window.prettyPrint?window.prettyPrint():(mw.loader.load("/index.php?title=MediaWiki:Gadget-code-prettify.js&action=raw&ctype=text/javascript"),mw.loader.load("/index.php?title=MediaWiki:Gadget-code-prettify.css&action=raw&ctype=text/css","text/css"))},d=async e=>(await r.post({action:"parse",...e})).parse.text["*"],l=(e,t)=>$(`<a href="/User:${e}" class="mw-userlink" />`).append($('<span class="userlink-avatar" />').append(`<img class="userlink-avatar-small" src="//storage.moegirl.org.cn/moegirl/avatars/${t}/latest.png!avatar" />`),`<bdi>${e}</bdi>`),u=e=>$('<span class="mw-usertoollinks" />').append("（",`<a href="/User_talk:${e}" class="mw-usertoollinks-talk">\u{8BA8}\u{8BBA}</a>`," | ",`<a href="/Special:\u{7528}\u{6237}\u{8D21}\u{732E}/${e}" class="mw-usertoollinks-contribs">\u{8D21}\u{732E}</a>`,"）");if(a&&n){if(!document.getElementById("mw-mod-error")||!$("#mw-returnto").text().includes("返回"))return;let e=$('<div class="bearbintool-historyviewer" />'),t=$("<a>加载当前差异</a>");t.on("click",async t=>{t.preventDefault(),mw.loader.load(`${mw.config.get("wgScriptPath")}/load.php?modules=mediawiki.diff.styles&only=styles`,"text/css"),e.text("加载中……");try{let t=await r.post({action:"compare",utf8:!0,fromrev:n,.../\d+/.test(a)?{torev:a}:{torelative:a},prop:["diff","user","parsedcomment","ids","title"]}),{fromtitle:i,fromrevid:o,fromparsedcomment:s,fromuser:c,fromuserid:p,totitle:d,torevid:f,toparsedcomment:m,touser:v,touserid:w}=t.compare,h=$(function(e,t=!1,n,a){let i=$(`<td colspan="${e?2:1}" class="diff-otitle" />`),r=$(`<td colspan="${e?2:1}" class="diff-ntitle" />`);Array.isArray(n)?i.append(...n):i.append(n||"旧版本"),Array.isArray(a)?r.append(...a):r.append(a||"新版本");let o=$('<tr class="diff-title" />').append(i,r);return $('<table class="diff diff-contentalign-left" data-mw="interface" />').append(e&&'<colgroup><col class="diff-marker"><col class="diff-content"><col class="diff-marker"><col class="diff-content"></colgroup>',$("<tbody />").append(t?o:"",e||'<tr><td colspan="2" class="diff-notice"><div class="mw-diff-empty">（没有差异）</div></td></tr>'))}(t.compare["*"],!0,[$('<div id="mw-diff-otitle1" />').append($("<strong />").append(`<a href="/index.php?title=${i}&oldid=${o}">\u{7248}\u{672C}${o}</a>`,`<span class="mw-diff-edit">\u{FF08}<a href="/index.php?title=${i}action=edit&oldid=${o}">\u{7F16}\u{8F91}</a>\u{FF09}</span>`)),$('<div id="mw-diff-otitle2" />').append(l(c,p),u(c)),$('<div id="mw-diff-otitle3" />').append(s?`<span class="comment">\u{FF08}${s}\u{FF09}</span>`:"")],[$('<div id="mw-diff-ntitle1" />').append($("<strong />").append(`<a href="/index.php?title=${d}&oldid=${f}">\u{7248}\u{672C}${f}</a>`,`<span class="mw-diff-edit">\u{FF08}<a href="/index.php?title=${d}&action=edit&oldid=${f}">\u{7F16}\u{8F91}</a>\u{FF09}</span>`,`<span class="mw-diff-undo">\u{FF08}<a href="/index.php?title=${d}&action=edit&undoafter=${o}&undo=${f}">\u{64A4}\u{9500}</a>\u{FF09}</span>`)),$('<div id="mw-diff-ntitle2" />').append(l(v,w),u(v)),$('<div id="mw-diff-ntitle3" />').append(m?`<span class="comment">\u{FF08}${m}\u{FF09}</span>`:"")]));e.text("加载成功！您现在可以查看版本差异。因compare api不支持，编辑时间戳和标记（如小编辑、机器人）不会显示。").append(h)}catch(t){e.empty().append(`\u{52A0}\u{8F7D}\u{5931}\u{8D25}\u{FF1A}${t}\u{3002}`)}if("prev"!==a)try{let e=await d({oldid:a});if($("#mw-content-text").append('<hr class="diff-hr" id="mw-oldid">',`<h2 class="diff-currentversion-title">\u{7248}\u{672C}${a}</h2>`),o in c){let t=$(e);$("#mw-content-text").append(t),mw.loader.moduleRegistry["ext.gadget.code-prettify"]&&p(t)}else $("#mw-content-text").append($('<div class="mw-parser-output" />').html(e))}catch(e){$("#mw-content-text").append(`\u{7248}\u{672C}${a}\u{89E3}\u{6790}\u{5931}\u{8D25}\u{FF1A}${e}\u{3002}`)}}),$("#mw-returnto").after(e.append("您也可以",t,"。"))}else if(n){if(!document.getElementById("mw-mod-error")||!$("#mw-returnto").text().includes("返回"))return;let e=$('<div class="bearbintool-historyviewer" />'),t=$("<a>加载当前版本</a>");t.on("click",async t=>{t.preventDefault(),e.text("加载中……");try{let t=await d({oldid:n});if(o in c){let e=$(t);$("#mw-content-text").append(e),mw.loader.moduleRegistry["ext.gadget.code-prettify"]&&p(e)}else $("#mw-content-text").append($('<div class="mw-parser-output" />').html(t));e.text("加载成功，您现在看到的是最新版本。部分依赖于js的功能（如折叠、tabs模板）可能无法正常工作。")}catch(t){e.empty().append(`\u{52A0}\u{8F7D}\u{5931}\u{8D25}\u{FF1A}${t}\u{3002}`)}}),$("#mw-returnto").after(e.append("您也可以",t,"。"))}else if(i.get(0)&&!i.children('a[href*="Special:Moderation"]').length){let e=$('<div class="history-revert-showcurrent" />'),t=$("<a>加载最新版本</a>");t.on("click",async t=>{t.preventDefault(),e.text("加载中……");try{let t=await d({page:s});if(o in c){let e=$("#mw-content-text>.mw-code"),n=$(t);e.length?e.replaceWith(n):i.after(n),mw.loader.moduleRegistry["ext.gadget.code-prettify"]&&p(n)}else{let e=$("#mw-content-text>.mw-parser-output");e.length||(e=$('<div class="mw-parser-output" />'),i.after(e)),e.html(t)}e.text("加载成功，您现在看到的是最新版本（部分依赖于js的功能可能无法正常工作）。")}catch(t){e.empty().append(`\u{52A0}\u{8F7D}\u{5931}\u{8D25}\u{FF1A}${t}\u{3002}`)}}),i.append(e.append("您也可以 ",t,"。"))}else if($("#mw-content-text").text().includes("的版本#0不存在。")){let t=$('<div class="history-revert-showcurrent" />'),n=$("<a>查看待审核内容</a>");n.on("click",async n=>{n.preventDefault(),t.text("加载中……");try{let n=await e(s),a=await d({text:n,title:s});if(o in c){let e=$(a);$("#mw-content-text").append(e),mw.loader.moduleRegistry["ext.gadget.code-prettify"]&&p(e)}else $("#mw-content-text").append($('<div class="mw-parser-output" />').html(a));t.text("加载成功，您现在看到的是最新版本（部分依赖于js的功能可能无法正常工作）。")}catch(e){t.empty().append(`\u{52A0}\u{8F7D}\u{5931}\u{8D25}\u{FF1A}${e}`)}}),$("#mw-content-text").append(t.append("也可能当前页面未通过审核，您可以尝试",n,"。"))}})})()})();
//# sourceMappingURL=HistoryViewer.min.js.map