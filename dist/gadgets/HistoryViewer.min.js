(()=>{"use strict";var e={371:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var r="",n=void 0!==t[5];return t[4]&&(r+="@supports (".concat(t[4],") {")),t[2]&&(r+="@media ".concat(t[2]," {")),n&&(r+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),r+=e(t),n&&(r+="}"),t[2]&&(r+="}"),t[4]&&(r+="}"),r})).join("")},t.i=function(e,r,n,a,o){"string"==typeof e&&(e=[[null,e,void 0]]);var i={};if(n)for(var s=0;s<this.length;s++){var c=this[s][0];null!=c&&(i[c]=!0)}for(var p=0;p<e.length;p++){var l=[].concat(e[p]);n&&i[l[0]]||(void 0!==o&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=o),r&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=r):l[2]=r),a&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=a):l[4]="".concat(a)),t.push(l))}},t}},474:e=>{e.exports=function(e){return e[1]}},245:e=>{var t="%[a-f0-9]{2}",r=new RegExp("("+t+")|([^%]+?)","gi"),n=new RegExp("("+t+")+","gi");function a(e,t){try{return[decodeURIComponent(e.join(""))]}catch(e){}if(1===e.length)return e;t=t||1;var r=e.slice(0,t),n=e.slice(t);return Array.prototype.concat.call([],a(r),a(n))}function o(e){try{return decodeURIComponent(e)}catch(o){for(var t=e.match(r)||[],n=1;n<t.length;n++)t=(e=a(t,n).join("")).match(r)||[];return e}}e.exports=function(e){if("string"!=typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){return function(e){for(var t={"%FE%FF":"��","%FF%FE":"��"},r=n.exec(e);r;){try{t[r[0]]=decodeURIComponent(r[0])}catch(e){var a=o(r[0]);a!==r[0]&&(t[r[0]]=a)}r=n.exec(e)}t["%C2"]="�";for(var i=Object.keys(t),s=0;s<i.length;s++){var c=i[s];e=e.replace(new RegExp(c,"g"),t[c])}return e}(e)}}},433:e=>{e.exports=function(e,t){for(var r={},n=Object.keys(e),a=Array.isArray(t),o=0;o<n.length;o++){var i=n[o],s=e[i];(a?-1!==t.indexOf(i):t(i,s,e))&&(r[i]=s)}return r}},194:(e,t,r)=>{const n=r(561),a=r(245),o=r(581),i=r(433),s=Symbol("encodeFragmentIdentifier");function c(e){if("string"!=typeof e||1!==e.length)throw new TypeError("arrayFormatSeparator must be single character string")}function p(e,t){return t.encode?t.strict?n(e):encodeURIComponent(e):e}function l(e,t){return t.decode?a(e):e}function d(e){return Array.isArray(e)?e.sort():"object"==typeof e?d(Object.keys(e)).sort(((e,t)=>Number(e)-Number(t))).map((t=>e[t])):e}function u(e){const t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),e}function f(e){const t=(e=u(e)).indexOf("?");return-1===t?"":e.slice(t+1)}function m(e,t){return t.parseNumbers&&!Number.isNaN(Number(e))&&"string"==typeof e&&""!==e.trim()?e=Number(e):!t.parseBooleans||null===e||"true"!==e.toLowerCase()&&"false"!==e.toLowerCase()||(e="true"===e.toLowerCase()),e}function y(e,t){c((t=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},t)).arrayFormatSeparator);const r=function(e){let t;switch(e.arrayFormat){case"index":return(e,r,n)=>{t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),t?(void 0===n[e]&&(n[e]={}),n[e][t[1]]=r):n[e]=r};case"bracket":return(e,r,n)=>{t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),t?void 0!==n[e]?n[e]=[].concat(n[e],r):n[e]=[r]:n[e]=r};case"colon-list-separator":return(e,r,n)=>{t=/(:list)$/.exec(e),e=e.replace(/:list$/,""),t?void 0!==n[e]?n[e]=[].concat(n[e],r):n[e]=[r]:n[e]=r};case"comma":case"separator":return(t,r,n)=>{const a="string"==typeof r&&r.includes(e.arrayFormatSeparator),o="string"==typeof r&&!a&&l(r,e).includes(e.arrayFormatSeparator);r=o?l(r,e):r;const i=a||o?r.split(e.arrayFormatSeparator).map((t=>l(t,e))):null===r?r:l(r,e);n[t]=i};case"bracket-separator":return(t,r,n)=>{const a=/(\[\])$/.test(t);if(t=t.replace(/\[\]$/,""),!a)return void(n[t]=r?l(r,e):r);const o=null===r?[]:r.split(e.arrayFormatSeparator).map((t=>l(t,e)));void 0!==n[t]?n[t]=[].concat(n[t],o):n[t]=o};default:return(e,t,r)=>{void 0!==r[e]?r[e]=[].concat(r[e],t):r[e]=t}}}(t),n=Object.create(null);if("string"!=typeof e)return n;if(!(e=e.trim().replace(/^[?#&]/,"")))return n;for(const a of e.split("&")){if(""===a)continue;let[e,i]=o(t.decode?a.replace(/\+/g," "):a,"=");i=void 0===i?null:["comma","separator","bracket-separator"].includes(t.arrayFormat)?i:l(i,t),r(l(e,t),i,n)}for(const e of Object.keys(n)){const r=n[e];if("object"==typeof r&&null!==r)for(const e of Object.keys(r))r[e]=m(r[e],t);else n[e]=m(r,t)}return!1===t.sort?n:(!0===t.sort?Object.keys(n).sort():Object.keys(n).sort(t.sort)).reduce(((e,t)=>{const r=n[t];return Boolean(r)&&"object"==typeof r&&!Array.isArray(r)?e[t]=d(r):e[t]=r,e}),Object.create(null))}t.extract=f,t.parse=y,t.stringify=(e,t)=>{if(!e)return"";c((t=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},t)).arrayFormatSeparator);const r=r=>t.skipNull&&null==e[r]||t.skipEmptyString&&""===e[r],n=function(e){switch(e.arrayFormat){case"index":return t=>(r,n)=>{const a=r.length;return void 0===n||e.skipNull&&null===n||e.skipEmptyString&&""===n?r:null===n?[...r,[p(t,e),"[",a,"]"].join("")]:[...r,[p(t,e),"[",p(a,e),"]=",p(n,e)].join("")]};case"bracket":return t=>(r,n)=>void 0===n||e.skipNull&&null===n||e.skipEmptyString&&""===n?r:null===n?[...r,[p(t,e),"[]"].join("")]:[...r,[p(t,e),"[]=",p(n,e)].join("")];case"colon-list-separator":return t=>(r,n)=>void 0===n||e.skipNull&&null===n||e.skipEmptyString&&""===n?r:null===n?[...r,[p(t,e),":list="].join("")]:[...r,[p(t,e),":list=",p(n,e)].join("")];case"comma":case"separator":case"bracket-separator":{const t="bracket-separator"===e.arrayFormat?"[]=":"=";return r=>(n,a)=>void 0===a||e.skipNull&&null===a||e.skipEmptyString&&""===a?n:(a=null===a?"":a,0===n.length?[[p(r,e),t,p(a,e)].join("")]:[[n,p(a,e)].join(e.arrayFormatSeparator)])}default:return t=>(r,n)=>void 0===n||e.skipNull&&null===n||e.skipEmptyString&&""===n?r:null===n?[...r,p(t,e)]:[...r,[p(t,e),"=",p(n,e)].join("")]}}(t),a={};for(const t of Object.keys(e))r(t)||(a[t]=e[t]);const o=Object.keys(a);return!1!==t.sort&&o.sort(t.sort),o.map((r=>{const a=e[r];return void 0===a?"":null===a?p(r,t):Array.isArray(a)?0===a.length&&"bracket-separator"===t.arrayFormat?p(r,t)+"[]":a.reduce(n(r),[]).join("&"):p(r,t)+"="+p(a,t)})).filter((e=>e.length>0)).join("&")},t.parseUrl=(e,t)=>{t=Object.assign({decode:!0},t);const[r,n]=o(e,"#");return Object.assign({url:r.split("?")[0]||"",query:y(f(e),t)},t&&t.parseFragmentIdentifier&&n?{fragmentIdentifier:l(n,t)}:{})},t.stringifyUrl=(e,r)=>{r=Object.assign({encode:!0,strict:!0,[s]:!0},r);const n=u(e.url).split("?")[0]||"",a=t.extract(e.url),o=t.parse(a,{sort:!1}),i=Object.assign(o,e.query);let c=t.stringify(i,r);c&&(c=`?${c}`);let l=function(e){let t="";const r=e.indexOf("#");return-1!==r&&(t=e.slice(r)),t}(e.url);return e.fragmentIdentifier&&(l=`#${r[s]?p(e.fragmentIdentifier,r):e.fragmentIdentifier}`),`${n}${c}${l}`},t.pick=(e,r,n)=>{n=Object.assign({parseFragmentIdentifier:!0,[s]:!1},n);const{url:a,query:o,fragmentIdentifier:c}=t.parseUrl(e,n);return t.stringifyUrl({url:a,query:i(o,r),fragmentIdentifier:c},n)},t.exclude=(e,r,n)=>{const a=Array.isArray(r)?e=>!r.includes(e):(e,t)=>!r(e,t);return t.pick(e,a,n)}},581:e=>{e.exports=(e,t)=>{if("string"!=typeof e||"string"!=typeof t)throw new TypeError("Expected the arguments to be of type `string`");if(""===t)return[e];const r=e.indexOf(t);return-1===r?[e]:[e.slice(0,r),e.slice(r+t.length)]}},561:e=>{e.exports=e=>encodeURIComponent(e).replace(/[!'()*]/g,(e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`))},396:(e,t,r)=>{r.d(t,{A:()=>s});var n=r(474),a=r.n(n),o=r(371),i=r.n(o)()(a());i.push([e.id,"#pagehistory li.after input[name=oldid],#pagehistory li.before input[name=diff],#pagehistory li.between input[type=radio]{visibility:unset}.bearbintool-historyviewer .userlink-avatar-small{max-height:1.5em;max-width:1.5em}",""]);const s=i},960:e=>{var t=[];function r(e){for(var r=-1,n=0;n<t.length;n++)if(t[n].identifier===e){r=n;break}return r}function n(e,n){for(var o={},i=[],s=0;s<e.length;s++){var c=e[s],p=n.base?c[0]+n.base:c[0],l=o[p]||0,d="".concat(p," ").concat(l);o[p]=l+1;var u=r(d),f={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==u)t[u].references++,t[u].updater(f);else{var m=a(f,n);n.byIndex=s,t.splice(s,0,{identifier:d,updater:m,references:1})}i.push(d)}return i}function a(e,t){var r=t.domAPI(t);r.update(e);return function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;r.update(e=t)}else r.remove()}}e.exports=function(e,a){var o=n(e=e||[],a=a||{});return function(e){e=e||[];for(var i=0;i<o.length;i++){var s=r(o[i]);t[s].references--}for(var c=n(e,a),p=0;p<o.length;p++){var l=r(o[p]);0===t[l].references&&(t[l].updater(),t.splice(l,1))}o=c}}},443:e=>{var t={};e.exports=function(e,r){var n=function(e){if(void 0===t[e]){var r=document.querySelector(e);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}t[e]=r}return t[e]}(e);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(r)}},628:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},120:(e,t,r)=>{e.exports=function(e){var t=r.nc;t&&e.setAttribute("nonce",t)}},81:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(r){!function(e,t,r){var n="";r.supports&&(n+="@supports (".concat(r.supports,") {")),r.media&&(n+="@media ".concat(r.media," {"));var a=void 0!==r.layer;a&&(n+="@layer".concat(r.layer.length>0?" ".concat(r.layer):""," {")),n+=r.css,a&&(n+="}"),r.media&&(n+="}"),r.supports&&(n+="}");var o=r.sourceMap;o&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(n,e,t.options)}(t,e,r)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},849:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}},t={};function r(n){var a=t[n];if(void 0!==a)return a.exports;var o=t[n]={id:n,exports:{}};return e[n](o,o.exports,r),o.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.nc=void 0,(()=>{var e=r(194);function t(e,t=!1,r,n){const a=$(`<td colspan="${e?2:1}" class="diff-otitle" />`),o=$(`<td colspan="${e?2:1}" class="diff-ntitle" />`);Array.isArray(r)?a.append(...r):a.append(r||"旧版本"),Array.isArray(n)?o.append(...n):o.append(n||"新版本");const i=$('<tr class="diff-title" />').append(a,o);return $('<table class="diff diff-contentalign-left" data-mw="interface" />').append(e&&'<colgroup><col class="diff-marker"><col class="diff-content"><col class="diff-marker"><col class="diff-content"></colgroup>',$("<tbody />").append(t?i:"",e||'<tr><td colspan="2" class="diff-notice"><div class="mw-diff-empty">（没有差异）</div></td></tr>'))}var n=r(960),a=r.n(n),o=r(81),i=r.n(o),s=r(443),c=r.n(s),p=r(120),l=r.n(p),d=r(628),u=r.n(d),f=r(849),m=r.n(f),y=r(396),v={};v.styleTagTransform=m(),v.setAttributes=l(),v.insert=c().bind(null,"head"),v.domAPI=i(),v.insertStyleElement=u();a()(y.A,v);y.A&&y.A.locals&&y.A.locals;$((()=>{const{oldid:r,diff:n}=(0,e.parse)(location.search),a=$("#mw-content-text>.moderation-notice"),o=new mw.Api,i=async e=>(await o.post({action:"parse",...e})).parse.text["*"],s=(e,t)=>$(`<a href="/User:${e}" class="mw-userlink" />`).append($('<span class="userlink-avatar" />').append(`<img class="userlink-avatar-small" src="https://img.moegirl.org.cn/common/avatars/${t}/128.png" />`),`<bdi>${e}</bdi>`),c=e=>$('<span class="mw-usertoollinks" />').append("（",`<a href="/User_talk:${e}" class="mw-usertoollinks-talk">讨论</a>`," | ",`<a href="/Special:用户贡献/${e}" class="mw-usertoollinks-contribs">贡献</a>`,"）");if(n&&r){if(!$(".permissions-errors a[href]").text().includes("↺"))return;const e=$('<div class="bearbintool-historyviewer" />'),a=$("<a>加载当前差异</a>");a.on("click",(async p=>{p.preventDefault(),e.text("加载中……");try{const a=await o.get({action:"compare",utf8:!0,fromrev:r,torev:n,prop:["diff","user","parsedcomment","ids","title"]}),{fromtitle:i,fromrevid:p,fromparsedcomment:l,fromuser:d,fromuserid:u,totitle:f,torevid:m,toparsedcomment:y,touser:v,touserid:g}=a.compare,h=$(t(a.compare["*"],!0,[$('<div id="mw-diff-otitle1" />').append($("<strong />").append(`<a href="/index.php?title=${i}&oldid=${p}">版本${p}</a>`,`<span class="mw-diff-edit">（<a href="/index.php?title=${i}action=edit&oldid=${p}">编辑</a>）</span>`)),$('<div id="mw-diff-otitle2" />').append(s(d,u),c(d)),$('<div id="mw-diff-otitle3" />').append(l?`<span class="comment">（${l}）</span>`:"")],[$('<div id="mw-diff-ntitle1" />').append($("<strong />").append(`<a href="/index.php?title=${f}&oldid=${m}">版本${m}</a>`,`<span class="mw-diff-edit">（<a href="/index.php?title=${f}&action=edit&oldid=${m}">编辑</a>）</span>`,`<span class="mw-diff-undo">（<a href="/index.php?title=${f}&action=edit&undoafter=${p}&undo=${m}">撤销</a>）</span>`)),$('<div id="mw-diff-ntitle2" />').append(s(v,g),c(v)),$('<div id="mw-diff-ntitle3" />').append(y?`<span class="comment">（${y}）</span>`:"")]));e.text("加载成功！您现在可以查看版本差异。因compare api不支持，编辑时间戳和标记（如小编辑、机器人）不会显示。").append(h)}catch(t){e.empty().append(`加载失败：${t}。您可以尝试重新`,a,"。")}try{const e=await i({oldid:r});$("#mw-content-text").append('<hr class="diff-hr" id="mw-oldid">',`<h2 class="diff-currentversion-title">版本${r}</h2>`,$('<div class="mw-parser-output" />').html(e))}catch(e){$("#mw-content-text").append(`版本${r}解析失败：${e}。`)}})),$("#mw-content-text").append(e.append("或 ",a,"。"))}else if(r){if(!$(".permissions-errors a[href]").text().includes("↺"))return;const e=$('<div class="bearbintool-historyviewer" />'),t=$("<a>加载当前版本</a>");t.on("click",(async n=>{n.preventDefault(),e.text("加载中……");try{const t=await i({oldid:r});$("#mw-content-text").append($('<div class="mw-parser-output" />').html(t)),e.text("加载成功，您现在看到的是最新版本。部分依赖于js的功能（如折叠、tabs模板）可能无法正常工作。")}catch(r){e.empty().append(`加载失败：${r}。您可以尝试重新`,t,"。")}})),$("#mw-content-text").append(e.append("或 ",t,"。"))}else if(a.get(0)&&!a.children('a[href*="Special:Moderation"]').length){const e=$('<div class="history-revert-showcurrent" />'),t=$("<a>加载最新版本</a>");t.on("click",(async r=>{r.preventDefault(),e.text("加载中……");try{const t=await i({page:mw.config.get("wgPageName")});$("#mw-content-text>.mw-parser-output").html(t),e.text("加载成功，您现在看到的是最新版本（部分依赖于js的功能可能无法正常工作）。")}catch(r){e.empty().append(`加载失败：${r}。您可以尝试重新`,t,"。")}})),a.append(e.append("您也可以 ",t,"。"))}}))})()})();