(()=>{"use strict";var e={18:function(e,t,i){i.d(t,{Z:()=>o});var r=i(317),n=i.n(r),a=i(632),l=i.n(a)()(n());l.push([e.id,".bearbintools-loger .loger-clear{margin-left:.3em;font-size:.9em;font-weight:400}.bearbintools-loger .loger-body{background:#ffffffb3;border:1px solid #ccc;padding:.3em;display:flow-root}.bearbintools-loger .loger-filter{float:right;padding:.4em}.bearbintools-loger .loger-filter>div{cursor:pointer;border-radius:.3em;margin-bottom:.2em;padding-right:.2em}.bearbintools-loger .loger-filter>div.loger-filter-selected{background-color:#7f7f7f12}.bearbintools-loger .loger-filter .loger-filter-icon{text-align:center;width:1.2em;height:1em;line-height:1em;display:inline-block}.bearbintools-loger .loger-lines{max-height:20em;font-family:monospace;list-style:inside;overflow-y:auto}.bearbintools-loger .loger-lines>li a{color:inherit;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}",""]);let o=l},244:function(e,t,i){i.d(t,{Z:()=>o});var r=i(317),n=i.n(r),a=i(632),l=i.n(a)()(n());l.push([e.id,".rootpage-Special_MassEdit #firstHeading{flex-wrap:wrap;justify-content:space-between;align-items:flex-end;display:flex}.rootpage-Special_MassEdit #firstHeading>div{font-size:.6em}.rootpage-Special_MassEdit #bodyContent{padding-right:0}.rootpage-Special_MassEdit #bodyContent #mw-content-text h5{margin-bottom:0}.rootpage-Special_MassEdit #bodyContent #mw-content-text textarea{line-height:1.3}.rootpage-Special_MassEdit #bodyContent #mw-content-text>ul{margin:0 0 0 .2em!important;list-style:inside!important}.me-textarea{box-sizing:border-box;width:100%}#me-regex{justify-content:space-between;align-items:center;margin-top:.3rem;display:flex}#me-regex-note li{margin-top:0;margin-bottom:0}#me-page-lists{gap:.3em;display:flex}#me-page-lists>div{flex-grow:1}#me-page-lists>div textarea{resize:none}#me-pages-note{margin-bottom:.6em}.me-panel{gap:.1rem;display:flex}.me-panel+.me-panel{margin-top:.4em}#me-edit-panel #me-interval{flex:0 0 5.5em}#me-edit-panel #me-summary,#me-preview-panel .oo-ui-textInputWidget{max-width:initial}#me-retry{margin-top:.3em}#me-retry #me-use-retry{display:inline}#me-retry #me-use-retry .oo-ui-fieldLayout-body{max-width:unset;display:inline}#me-retry #me-use-retry .oo-ui-fieldLayout-body>span{display:inline}#me-retry #me-use-retry .oo-ui-checkboxInputWidget-checkIcon{top:0}#me-retry #me-use-retry:after{content:unset}#me-retry #me-retry-times{width:3em;display:inline-block}#me-regex-help-list{-webkit-user-select:none;user-select:none;list-style:inside}#me-regex-help-list li{margin-bottom:1px;line-height:1.6}#me-regex-help-list code{-webkit-user-select:all;user-select:all;cursor:text;border:1px solid #ddd;padding:1px 3px}",""]);let o=l},632:function(e){e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var i="",r=void 0!==t[5];return t[4]&&(i+="@supports (".concat(t[4],") {")),t[2]&&(i+="@media ".concat(t[2]," {")),r&&(i+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),i+=e(t),r&&(i+="}"),t[2]&&(i+="}"),t[4]&&(i+="}"),i}).join("")},t.i=function(e,i,r,n,a){"string"==typeof e&&(e=[[null,e,void 0]]);var l={};if(r)for(var o=0;o<this.length;o++){var s=this[o][0];null!=s&&(l[s]=!0)}for(var u=0;u<e.length;u++){var c=[].concat(e[u]);r&&l[c[0]]||(void 0!==a&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=a),i&&(c[2]&&(c[1]="@media ".concat(c[2]," {").concat(c[1],"}")),c[2]=i),n&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=n):c[4]="".concat(n)),t.push(c))}},t}},317:function(e){e.exports=function(e){return e[1]}},85:function(e){var t=[];function i(e){for(var i=-1,r=0;r<t.length;r++)if(t[r].identifier===e){i=r;break}return i}function r(e,r){for(var n={},a=[],l=0;l<e.length;l++){var o=e[l],s=r.base?o[0]+r.base:o[0],u=n[s]||0,c="".concat(s," ").concat(u);n[s]=u+1;var d=i(c),p={css:o[1],media:o[2],sourceMap:o[3],supports:o[4],layer:o[5]};if(-1!==d)t[d].references++,t[d].updater(p);else{var m=function(e,t){var i=t.domAPI(t);return i.update(e),function(t){t?(t.css!==e.css||t.media!==e.media||t.sourceMap!==e.sourceMap||t.supports!==e.supports||t.layer!==e.layer)&&i.update(e=t):i.remove()}}(p,r);r.byIndex=l,t.splice(l,0,{identifier:c,updater:m,references:1})}a.push(c)}return a}e.exports=function(e,n){var a=r(e=e||[],n=n||{});return function(e){e=e||[];for(var l=0;l<a.length;l++){var o=i(a[l]);t[o].references--}for(var s=r(e,n),u=0;u<a.length;u++){var c=i(a[u]);0===t[c].references&&(t[c].updater(),t.splice(c,1))}a=s}}},931:function(e){var t={};e.exports=function(e,i){var r=function(e){if(void 0===t[e]){var i=document.querySelector(e);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}t[e]=i}return t[e]}(e);if(!r)throw Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(i)}},300:function(e){e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},342:function(e,t,i){e.exports=function(e){var t=i.nc;t&&e.setAttribute("nonce",t)}},417:function(e){e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(i){var r,n,a;r="",i.supports&&(r+="@supports (".concat(i.supports,") {")),i.media&&(r+="@media ".concat(i.media," {")),(n=void 0!==i.layer)&&(r+="@layer".concat(i.layer.length>0?" ".concat(i.layer):""," {")),r+=i.css,n&&(r+="}"),i.media&&(r+="}"),i.supports&&(r+="}"),(a=i.sourceMap)&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),e.styleTagTransform(r,t,e.options)},remove:function(){!function(e){if(null!==e.parentNode)e.parentNode.removeChild(e)}(t)}}}},514:function(e){e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}},t={};function i(r){var n=t[r];if(void 0!==n)return n.exports;var a=t[r]={id:r,exports:{}};return e[r](a,a.exports,i),a.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.nc=void 0,i.rv=()=>"1.4.2",i.ruid="bundler=rspack@1.4.2",(()=>{let e=e=>{let t=document.createElement("template");return t.innerHTML=e.trim(),t.content.children[0]};var t=i(85),r=i.n(t),n=i(417),a=i.n(n),l=i(931),o=i.n(l),s=i(342),u=i.n(s),c=i(300),d=i.n(c),p=i(514),m=i.n(p),g=i(18),f={};f.styleTagTransform=m(),f.setAttributes=u(),f.insert=o().bind(null,"head"),f.domAPI=a(),f.insertStyleElement=d(),r()(g.Z,f),g.Z&&g.Z.locals&&g.Z.locals;class h{_logTypes={success:{icon:"✓",color:"#333",text:"完成"},warn:{icon:"!",color:"#f28500",text:"警告"},error:{icon:"✕",color:"#eb3941",text:"出错"}};element;headline;body=e('<div class="loger-body"></div>');logerLines=e('<ul class="loger-lines"></ul>');logDetails=[];filterButtons={};constructor(t=[],i="",r="h3"){for(let e in t.length>0&&(this._logTypes=t.reduce((e,t)=>{let{name:i,icon:r,color:n,text:a}=t;return e[i]={icon:r,color:n,text:a},e},{})),this._logTypes)this._logTypes[e].show=!0;this.headline=e(`<${r} class="loger-headline"></${r}>`);let n=e('<a class="loger-clear">[清空]</a>');n.addEventListener("click",this.clear.bind(this));let a=e('<nav class="loger-filter"></nav>');for(let[t,{icon:i,color:r,text:n}]of Object.entries(this._logTypes)){let l=e(`<div class="loger-filter-selected loger-${t}" style="color:${r}"></div>`),o=e('<span class="loger-filter-icon"></span>');o.append(i);let s=e('<span class="loger-filter-count">0</span>');l.append(o,s,` ${n}`),l.addEventListener("click",()=>{this._logTypes[t].show?(l.classList.remove("loger-filter-selected"),this.logerLines.classList.add(`loger-${t}-hidden`),this.logDetails.filter(e=>e.type===t).forEach(e=>{e.element.style.display="none"}),this._logTypes[t].show=!1):(l.classList.add("loger-filter-selected"),this.logerLines.classList.remove(`loger-${t}-hidden`),this.logDetails.filter(e=>e.type===t).forEach(e=>{e.element.style.display=""}),this._logTypes[t].show=!0)}),this.filterButtons[t]={button:l,countElement:s},a.appendChild(l)}this.element=e(`<div class="bearbintools-loger" id="${i||""}"></div>`),this.headline.append("日志",n),this.body.append(a,this.logerLines),this.element.append(this.headline,this.body)}record(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"normal",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Date().toLocaleTimeString(),r=document.createElement("li");return r.classList.add("loger-record",`loger-${t}`),r.innerHTML=`${i} - ${e}`,r.style.color=this._logTypes[t]?.color||"#222",this._logTypes[t]?.show===!1&&(r.style.display="none"),this.logerLines.appendChild(r),this.logerLines.scrollTop=this.logerLines.scrollHeight,this.logDetails.push({element:r,type:t}),this.filterButtons[t]&&(this.filterButtons[t].countElement.innerText=String(+this.filterButtons[t].countElement.innerText+1)),r}clear(){for(let e in this.logDetails.length=0,this.logerLines.innerHTML="",this.filterButtons)this.filterButtons[e].countElement.innerText="0"}}let y=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["page","subcat","file"],i=new mw.Api,r=[];if(mw.config.get("wgUserGroups").some(e=>["bot","flood","patroller","sysop"].includes(e))){let n="";for(;void 0!==n;){let a=await i.post({action:"query",format:"json",utf8:!0,list:"categorymembers",cmlimit:"max",cmtitle:e,cmprop:"title",cmtype:t,cmcontinue:n});a.query.categorymembers[0]&&r.push(...a.query.categorymembers.map(e=>{let{title:t}=e;return t})),n=a.continue?.cmcontinue}}else{let i=async e=>{let n=$(await $.ajax(e)),a=t.map(e=>{switch(e){case"page":return"#mw-pages li a";case"subcat":return"#mw-subcategories li a";case"file":return"#mw-category-media li a.galleryfilename"}}).join(","),l=n.find(a).map((e,t)=>t.classList.contains("CategoryTreeLabel")?`Category:${$(t).text()}`:t.classList.contains("galleryfilename")?`File:${$(t).text()}`:$(t).text()).get();if(r.push(...l),t.includes("page")){let e=n.find('a[href*="&pagefrom="]');e.length&&await i(e.eq(0).attr("href"))}if(t.includes("subcat")){let e=n.find('a[href*="&subcatfrom="]');e.length&&await i(e.eq(0).attr("href"))}if(t.includes("file")){let e=n.find('a[href*="&filefrom="]');e.length&&await i(e.eq(0).attr("href"))}};await i(`/${e}?useskin=vector&safemode=1`)}return r},b=async(e,t)=>{let i=new mw.Api,[r]=Object.values((await i.post({action:"query",prop:"revisions",titles:e,rvprop:"content",...t})).query.pages);if("revisions"in r)return r.revisions?.[0]["*"];if("missing"in r)throw"missingtitle"},w=async function(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=new mw.Api;return function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,n=$(`<td colspan="${e?2:1}" class="diff-otitle" />`),a=$(`<td colspan="${e?2:1}" class="diff-ntitle" />`);Array.isArray(i)?n.append(...i):n.append(i||"旧版本"),Array.isArray(r)?a.append(...r):a.append(r||"新版本");let l=$('<tr class="diff-title" />').append(n,a);return $('<table class="diff diff-contentalign-left" data-mw="interface" />').append(e&&'<colgroup><col class="diff-marker"><col class="diff-content"><col class="diff-marker"><col class="diff-content"></colgroup>',$("<tbody />").append(t?l:"",e||'<tr><td colspan="2" class="diff-notice"><div class="mw-diff-empty">（没有差异）</div></td></tr>'))}((await r.post({action:"compare",fromtext:e,totext:t,topst:!0,fromtitle:"PAGENAME"})).compare["*"],i)},v=e=>e.split("\n").filter(e=>e&&e.trim());var x=i(244),F={};F.styleTagTransform=m(),F.setAttributes=u(),F.insert=o().bind(null,"head"),F.domAPI=a(),F.insertStyleElement=d(),r()(x.Z,F),x.Z&&x.Z.locals&&x.Z.locals,$(()=>(async()=>{let e;if("Special:MassEdit"!==mw.config.get("wgPageName")){await mw.loader.using("mediawiki.util"),mw.util.addPortletLink("p-tb","/Special:MassEdit","批量编辑","t-massedit");return}await mw.loader.using(["mediawiki.api","oojs-ui"]);let t=new mw.Api,i="waiting",r=!1,n=new h([{name:"success",icon:"✓",color:"#333",text:"已完成"},{name:"nochange",icon:"○",color:"#888",text:"无变化"},{name:"warn",icon:"!",color:"#f28500",text:"警告"},{name:"error",icon:"✕",color:"#eb3941",text:"出错"}],"massedit-log","h5");mw.loader.load("/index.php?title=User:Nzh21/js/QuickDiff.js&action=raw&ctype=text/javascript"),mw.loader.load(`${mw.config.get("wgLoadScript")}?debug=false&modules=mediawiki.diff.styles&only=styles`,"text/css"),mw.config.set("wgCanonicalSpecialPageName","MassEdit"),document.title="批量编辑 - 萌娘百科_万物皆可萌的百科全书",$(".mw-invalidspecialpage").removeClass("mw-invalidspecialpage"),$("#firstHeading").html('批量编辑页面<div>By <a href="/User:BearBin">BearBin</a></div>'),$("#contentSub").remove();let a=$('<textarea class="me-textarea" name="me-edit-from" rows="4"/>'),l=$('<textarea class="me-textarea" name="me-change-to" rows="4"/>'),o=$('<textarea class="me-textarea" name="me-page-list" rows="12"/>'),s=$('<textarea class="me-textarea" name="me-category-list" rows="12"/>'),u=new OO.ui.CheckboxInputWidget({id:"me-regex-box"}),c=new OO.ui.FieldLayout(u,{label:"使用正则表达式",align:"inline"}),d=new OO.ui.ButtonWidget({label:"常用正则",icon:"help"}),p=new OO.ui.ButtonWidget({label:"提交",flags:["primary","progressive"],icon:"check"}),m=new OO.ui.ButtonWidget({label:"终止",flags:["primary","destructive"],icon:"close"}),g=new OO.ui.TextInputWidget({type:"number",placeholder:"编辑间隔",id:"me-interval"}),f=new OO.ui.TextInputWidget({placeholder:"附加摘要",id:"me-summary"}),x=new OO.ui.ButtonWidget({label:"预览",icon:"search",disabled:!0}),F=new OO.ui.TextInputWidget({placeholder:"要应用本编辑的页面"}).on("change",e=>{e?.length?x.setDisabled(!1):x.setDisabled(!0)}),E=new OO.ui.TextInputWidget({type:"number",placeholder:"0",id:"me-retry-times",disabled:!0}),B=new OO.ui.CheckboxInputWidget,k=new OO.ui.FieldLayout(B.on("change",()=>{E.setDisabled(!B.isSelected())}),{label:"因网络问题出错时，重试至多",align:"inline",id:"me-use-retry"});$("#mw-content-text").empty().append("<h5>原文字：</h5>",a,"<h5>替换为：</h5>",l,$('<div id="me-regex"/>').append(c.$element,d.$element),$("<ul/>").append("<li>正则表达式须使用斜线包裹（如<code>/regex/g</code>），且<code>g</code>为必须，否则无法被js解析。</li>","<li>替换后文本若有换行请直接敲回车，不要用<code>\\n</code>。</li>"),$('<div id="me-page-lists"/>').append($("<div/>").append("<h5>页面</h5>",o),$("<div/>").append("<h5>分类</h5>",s)),$('<div id="me-pages-note"/>').append("输入要编辑的页面或分类，","<u>每行一个</u>","；分类栏请带上 分类/Category/Cat 等能被系统识别的分类名字空间前缀。"),$('<div id="me-edit-panel" class="me-panel"/>').append(p.$element,m.$element.hide(),g.$element,f.$element),$('<div id="me-preview-panel" class="me-panel"/>').append(x.$element,F.$element),$('<div id="me-retry"/>').append(k.$element,E.$element,"次"),$("<ul/>").append("<li>编辑间隔单位为秒（s），不填默认为20s。不包含本身编辑页面所用的时间。</li>",$("<li/>").append('<b>请注意<a target="_blank" href="/萌娘百科:机器用户">机器用户方针</a>所规定速率</b>',"和",'<a target="_blank" href="/api.php?action=query&meta=userinfo&uiprop=ratelimits">ratelimit限制</a>',"并自行设置间隔，或申请机器用户权限。")),n.element,$("<ul/>").append("<li>报错“http”不一定是编辑失败，可能实际已提交但等待成功信息过久而判定超时。</li>"));let A=t=>new Promise(i=>e=setTimeout(i,t)),C=()=>{i="waiting",clearTimeout(e),m.setDisabled(!0).$element.hide(),p.setDisabled(!1).$element.show(),$("#mw-content-text input, #mw-content-text textarea").prop("disabled",!1),window.onbeforeunload=()=>null},T=async e=>{let t=[],i=e.map(async e=>{try{let i=await y(e);i.length>0?(n.record(`\u{83B7}\u{53D6}\u{5230}\u{3010}<a href="/${e}" target="_blank">${e}</a>\u{3011}\u{5185}\u{7684}\u{9875}\u{9762}${i.length}\u{4E2A}\u{3002}`,"normal"),t.push(...i)):n.record(`\u{3010}${e}\u{3011}\u{5185}\u{6CA1}\u{6709}\u{9875}\u{9762}\u{3002}`,"warn")}catch(i){let t="";t="http"===i?"网络连接出错":i,n.record(`\u{83B7}\u{53D6}\u{3010}${e}\u{3011}\u{5185}\u{7684}\u{9875}\u{9762}\u{51FA}\u{9519}\u{FF1A}${t}\u{3002}`,"error")}});return await Promise.all(i),t},O=async()=>[...new Set([...v(o.val()||""),...await T(v(s.val()||""))])],D=(e,t)=>{let i=e;if(t)try{let t=e.match(/^\/(.*)\/([gimsuy]*)$/);if(!t)return n.record("正则表达式格式有误。","warn"),"";let[r,a,l]=t;if(!l.includes("g"))return n.record("正则表达式必须包含全局匹配(g)修饰符。","warn"),"";i=new RegExp(a,l)}catch(e){n.record(`\u{6B63}\u{5219}\u{8868}\u{8FBE}\u{5F0F}\u{89E3}\u{6790}\u{5931}\u{8D25}\u{FF1A}${e}`,"error");return}return i},S=async(e,t,i)=>{x.setDisabled(!0),n.record("正在获取预览……");try{let r=await b(e);if(!r)return void n.record(`\u{83B7}\u{53D6}${e}\u{5F53}\u{524D}\u{5185}\u{5BB9}\u{51FA}\u{9519}\u{3002}`,"error");let a=r.replaceAll(t,i),l=await w(r,a,!0);OO.ui.alert($(l),{title:$(`<span>\u{9884}\u{89C8}<b>\u{3010}${e}\u{3011}</b>\u{7684}\u{66F4}\u{6539}</span>`),size:"larger"})}catch(e){n.record(`\u{9884}\u{89C8}\u{51FA}\u{9519}\u{FF1A}${e}\u{3002}`,"error")}x.setDisabled(!1)},L=async(e,a,l,o)=>{let s=B.isSelected(),u=0,c=+E.getValue(),d=`<a href="/${e}" target="_blank">${e}</a>`;do try{i="getting";let s=await b(e),u=s.replaceAll(l,o);if(s===u)return n.record(`\u{3010}${d}\u{3011}\u{7F16}\u{8F91}\u{524D}\u{540E}\u{65E0}\u{53D8}\u{5316}\u{3002}`,"nochange"),"nochange";if(r)return"failed";i="editing";let c=await t.postWithToken("csrf",{format:"json",action:"edit",watchlist:"nochange",tags:"Bot",bot:!0,minor:!0,nocreate:!0,title:e,text:u,summary:`[[U:BearBin/js#MassEdit|MassEdit]]\u{FF1A}\u{3010}${l.toString().replace(/\n/g,"↵")}\u{3011}\u{2192}\u{3010}${o.replace(/\n/g,"↵")}\u{3011}${a&&`\u{FF1A}${a}`}`});if(i="waiting",c?.edit?.result==="Success")return n.record(`\u{3010}<a href="/_?diff=${c.edit.newrevid}" target="_blank">${e}</a>\u{3011}\u{7F16}\u{8F91}\u{5B8C}\u{6210}\u{3002}`,"success"),"success";if(c?.edit?.abusefilter)return n.record(`\u{3010}${d}\u{3011}\u{7F16}\u{8F91}\u{5931}\u{8D25}\u{FF1A}\u{88AB}\u{6EE5}\u{7528}\u{8FC7}\u{6EE4}\u{5668}${c.edit.abusefilter.id}\u{963B}\u{6B62}\u{3002}\u{8FC7}\u{6EE4}\u{5668}\u{63CF}\u{8FF0}\u{FF1A}${c.edit.abusefilter.description}\u{3002}`,"error"),"failed";n.record(`\u{3010}${d}\u{3011}\u{7F16}\u{8F91}\u{5931}\u{8D25}\u{FF0C}\u{8BF7}\u{5C06}\u{4EE5}\u{4E0B}\u{5185}\u{5BB9}\u{544A}\u{77E5}<a href="/User_talk:BearBin" target="_blank">BearBin</a>\u{FF1A}${JSON.stringify(c)}`,"error");break}catch(i){let t="";switch(i){case"missingtitle":t="页面不存在";break;case"http":u++,t=s&&u<=c?`\u{7F51}\u{7EDC}\u{8FDE}\u{63A5}\u{51FA}\u{9519}\u{FF0C}\u{6B63}\u{5728}\u{91CD}\u{8BD5}\u{FF08}${u}/${c}\u{FF09}`:"网络连接出错";break;case"protectedpage":t="页面被保护";break;default:t=i}if(n.record(`\u{7F16}\u{8F91}\u{3010}<a href="/${e}?action=history" target="_blank">${e}</a>\u{3011}\u{65F6}\u{51FA}\u{73B0}\u{9519}\u{8BEF}\u{FF1A}${t}\u{3002}`,"error"),!s||"http"!==i)break}while(u<=c);return"failed"};p.on("click",async()=>{if(!a.val())return void n.record("请输入要替换的原文字。","warn");if(!o.val()&&!s.val())return void n.record("请输入要编辑的页面或分类。","warn");let e=$("<p>请确认您的编辑内容。若因输入不当而产生错误，请自行<ruby>承担后果<rp>(</rp><rt>料理后事</rt><rp>)</rp></ruby>。</p>");if(await OO.ui.confirm(e,{title:"提醒",size:"small"})){let e=f.getValue(),t=(""===g.getValue()?20:g.getValue())*1e3,i=D(a.val(),u.isSelected()),o=l.val();if(!i)return;p.setDisabled(!0).$element.hide(),m.setDisabled(!1).$element.show(),$("#mw-content-text input, #mw-content-text textarea").prop("disabled",!0),window.onbeforeunload=()=>!0,await O().then(async a=>{let l=0,{length:s}=a;for(let u of(n.record(`\u{5171}${s}\u{4E2A}\u{9875}\u{9762}\u{FF0C}\u{5373}\u{5C06}\u{5F00}\u{59CB}\u{7F16}\u{8F91}\u{2026}\u{2026}`,"normal"),a)){let n=await L(u,e,i,o);if(l++,r)break;"success"===n&&0!==t&&l<s&&await A(t)}r?(r=!1,n.record("编辑终止。","normal")):n.record("编辑完毕。","normal"),C()}),C()}}),m.on("click",()=>{switch(m.setDisabled(!0),i){case"waiting":r=!1,C(),n.record("编辑终止。","normal");break;case"getting":r=!0,C();break;case"editing":r=!0}}),x.on("click",()=>{let e=a.val();if(!e)return void n.record("请输入要替换的原文字。","warn");let t=D(e,u.isSelected());t&&S(F.getValue(),t,l.val())});let _=$('<ul id="me-regex-help-list"/>').append(`<li><code>${/\[\[(?:Category|Cat|分[类類]):分类名(\|[^[]*)?\]\]/gi.toString()}</code>\u{FF1A}\u{5339}\u{914D}\u{5206}\u{7C7B}</li>`,`<li><code>${/\{\{(?:Template:|T:|[模样樣]板:)?模板名/gi.toString()}</code>\u{FF1A}\u{5339}\u{914D}\u{6A21}\u{677F}\u{FF08}\u{4E0D}\u{542B}\u{5185}\u{5BB9}\u{FF09}</li>`,`<li><code>${/^.*$/gs.toString()}</code>\u{FF1A}\u{5339}\u{914D}\u{5168}\u{6587}\u{FF08}\u{611F}\u{8C22}\u{9B3C}\u{5F71}\u{FF09}</li>`);d.on("click",()=>{OO.ui.alert(_,{title:"常用正则表达式",size:"medium"})})})())})()})();