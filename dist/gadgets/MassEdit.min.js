(()=>{"use strict";var e={354:function(e,t,n){n.d(t,{Z:()=>l});var i=n(812),r=n.n(i),a=n(78),o=n.n(a)()(r());o.push([e.id,".bearbintools-loger .loger-clear{margin-left:.3em;font-size:.9em;font-weight:400}.bearbintools-loger .loger-body{background:#ffffffb3;border:1px solid #ccc;padding:.3em;display:flow-root}.bearbintools-loger .loger-filter{float:right;padding:.4em}.bearbintools-loger .loger-filter>div{cursor:pointer;border-radius:.3em;margin-bottom:.2em;padding-right:.2em}.bearbintools-loger .loger-filter>div.loger-filter-selected{background-color:#7f7f7f12}.bearbintools-loger .loger-filter .loger-filter-icon{text-align:center;width:1.2em;height:1em;line-height:1em;display:inline-block}.bearbintools-loger .loger-lines{max-height:20em;font-family:monospace;list-style:inside;overflow-y:auto}.bearbintools-loger .loger-lines>li a{color:inherit;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}","",{version:3,sources:["webpack://./src/components/Loger/index.less"],names:[],mappings:"AADA,iCAAA,gBAAA,CAAA,cAAA,CAAA,eAAA,CAKA,gCAAA,oBAAA,CAAA,qBAAA,CAAA,YAAA,CAAA,iBAAA,CAMA,kCAAA,WAAA,CAAA,YAAA,CAIA,sCAAA,cAAA,CAAA,kBAAA,CAAA,kBAAA,CAAA,kBAAA,CAMA,4DAAA,0BAAA,CAGA,qDAAA,iBAAA,CAAA,WAAA,CAAA,UAAA,CAAA,eAAA,CAAA,oBAAA,CAOA,iCAAA,eAAA,CAAA,qBAAA,CAAA,iBAAA,CAAA,eAAA,CAMA,sCAAA,aAAA,CAAA,wCAAA,CAAA,gCAAA",sourcesContent:[".bearbintools-loger .loger-clear {\n  margin-left: 0.3em;\n  font-size: 0.9em;\n  font-weight: normal;\n}\n.bearbintools-loger .loger-body {\n  display: flow-root;\n  padding: 0.3em;\n  border: 1px solid #ccc;\n  background: rgba(255, 255, 255, 0.7);\n}\n.bearbintools-loger .loger-filter {\n  float: right;\n  padding: 0.4em;\n}\n.bearbintools-loger .loger-filter > div {\n  border-radius: 0.3em;\n  margin-bottom: 0.2em;\n  padding-right: 0.2em;\n  cursor: pointer;\n}\n.bearbintools-loger .loger-filter > div.loger-filter-selected {\n  background-color: rgba(127, 127, 127, 0.07);\n}\n.bearbintools-loger .loger-filter .loger-filter-icon {\n  display: inline-block;\n  width: 1.2em;\n  height: 1em;\n  line-height: 1em;\n  text-align: center;\n}\n.bearbintools-loger .loger-lines {\n  max-height: 20em;\n  overflow-y: auto;\n  list-style: inside;\n  font-family: monospace;\n}\n.bearbintools-loger .loger-lines > li a {\n  color: inherit;\n  text-decoration: underline dotted;\n}\n"],sourceRoot:""}]);let l=o},544:function(e,t,n){n.d(t,{Z:()=>l});var i=n(812),r=n.n(i),a=n(78),o=n.n(a)()(r());o.push([e.id,".rootpage-Special_MassEdit #firstHeading{flex-wrap:wrap;justify-content:space-between;align-items:flex-end;display:flex}.rootpage-Special_MassEdit #firstHeading>div{font-size:.6em}.rootpage-Special_MassEdit #bodyContent{padding-right:0!important}.rootpage-Special_MassEdit #bodyContent #mw-content-text h5{margin-bottom:0}.rootpage-Special_MassEdit #bodyContent #mw-content-text textarea{line-height:1.3}.rootpage-Special_MassEdit #bodyContent #mw-content-text>ul{margin:0 0 0 .2em!important;list-style:inside!important}.me-textarea{box-sizing:border-box;width:100%}#me-regex{justify-content:space-between;align-items:center;margin-top:.3rem;display:flex}#me-regex-note li{margin-top:0;margin-bottom:0}#me-page-lists{gap:.3em;display:flex}#me-page-lists>div{flex-grow:1}#me-page-lists>div textarea{resize:none}#me-pages-note{margin-bottom:.6em}.me-panel{gap:.1rem;display:flex}.me-panel+.me-panel{margin-top:.4em}#me-edit-panel #me-interval{flex:0 0 5.5em}#me-edit-panel #me-summary,#me-preview-panel .oo-ui-textInputWidget{max-width:initial}#me-retry{margin-top:.3em}#me-retry #me-use-retry{display:inline}#me-retry #me-use-retry .oo-ui-fieldLayout-body{max-width:unset;display:inline}#me-retry #me-use-retry .oo-ui-fieldLayout-body>span{display:inline}#me-retry #me-use-retry .oo-ui-checkboxInputWidget-checkIcon{top:0}#me-retry #me-use-retry:after{content:unset}#me-retry #me-retry-times{width:3em;display:inline-block}#me-regex-help-list{-webkit-user-select:none;user-select:none;list-style:inside}#me-regex-help-list li{margin-bottom:1px;line-height:1.6}#me-regex-help-list code{-webkit-user-select:all;user-select:all;cursor:text;border:1px solid #ddd;padding:1px 3px}","",{version:3,sources:["webpack://./src/gadgets/MassEdit/index.less"],names:[],mappings:"AAEA,yCAAA,cAAA,CAAA,6BAAA,CAAA,oBAAA,CAAA,YAAA,CAMA,6CAAA,cAAA,CAGA,wCAAA,yBAAA,CAGA,4DAAA,eAAA,CAGA,kEAAA,eAAA,CAGA,4DAAA,2BAAA,CAAA,2BAAA,CAIA,aAAA,qBAAA,CAAA,UAAA,CAIA,UAAA,6BAAA,CAAA,kBAAA,CAAA,gBAAA,CAAA,YAAA,CAMA,kBAAA,YAAA,CAAA,eAAA,CAIA,eAAA,QAAA,CAAA,YAAA,CAIA,mBAAA,WAAA,CAGA,4BAAA,WAAA,CAGA,eAAA,kBAAA,CAGA,UAAA,SAAA,CAAA,YAAA,CAIA,oBAAA,eAAA,CAGA,4BAAA,cAAA,CAGA,oEAAA,iBAAA,CAMA,UAAA,eAAA,CAGA,wBAAA,cAAA,CAGA,gDAAA,eAAA,CAAA,cAAA,CAIA,qDAAA,cAAA,CAGA,6DAAA,KAAA,CAGA,8BAAA,aAAA,CAGA,0BAAA,SAAA,CAAA,oBAAA,CAIA,oBAAA,wBAAA,CAAA,gBAAA,CAAA,iBAAA,CAIA,uBAAA,iBAAA,CAAA,eAAA,CAIA,yBAAA,uBAAA,CAAA,eAAA,CAAA,WAAA,CAAA,qBAAA,CAAA,eAAA",sourcesContent:["/** flex基础，默认全居中 */\n/** 覆盖渲染页面的样式 */\n/** 文本溢出显示省略号 */\n.rootpage-Special_MassEdit #firstHeading {\n  display: flex;\n  flex-wrap: wrap;\n  justify-content: space-between;\n  align-items: flex-end;\n}\n.rootpage-Special_MassEdit #firstHeading > div {\n  font-size: 0.6em;\n}\n.rootpage-Special_MassEdit #bodyContent {\n  padding-right: 0 !important;\n}\n.rootpage-Special_MassEdit #bodyContent #mw-content-text h5 {\n  margin-bottom: 0;\n}\n.rootpage-Special_MassEdit #bodyContent #mw-content-text textarea {\n  line-height: 1.3;\n}\n.rootpage-Special_MassEdit #bodyContent #mw-content-text > ul {\n  list-style: inside !important;\n  margin: 0 0 0 0.2em !important;\n}\n.me-textarea {\n  box-sizing: border-box;\n  width: 100%;\n}\n#me-regex {\n  margin-top: 0.3rem;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n#me-regex-note li {\n  margin-top: 0;\n  margin-bottom: 0;\n}\n#me-page-lists {\n  display: flex;\n  gap: 0.3em;\n}\n#me-page-lists > div {\n  flex-grow: 1;\n}\n#me-page-lists > div textarea {\n  resize: none;\n}\n#me-pages-note {\n  margin-bottom: 0.6em;\n}\n.me-panel {\n  display: flex;\n  gap: 0.1rem;\n}\n.me-panel + .me-panel {\n  margin-top: 0.4em;\n}\n#me-edit-panel #me-interval {\n  flex: 0 0 5.5em;\n}\n#me-edit-panel #me-summary {\n  max-width: initial;\n}\n#me-preview-panel .oo-ui-textInputWidget {\n  max-width: initial;\n}\n#me-retry {\n  margin-top: 0.3em;\n}\n#me-retry #me-use-retry {\n  display: inline;\n}\n#me-retry #me-use-retry .oo-ui-fieldLayout-body {\n  display: inline;\n  max-width: unset;\n}\n#me-retry #me-use-retry .oo-ui-fieldLayout-body > span {\n  display: inline;\n}\n#me-retry #me-use-retry .oo-ui-checkboxInputWidget-checkIcon {\n  top: 0;\n}\n#me-retry #me-use-retry::after {\n  content: unset;\n}\n#me-retry #me-retry-times {\n  display: inline-block;\n  width: 3em;\n}\n#me-regex-help-list {\n  list-style: inside;\n  user-select: none;\n}\n#me-regex-help-list li {\n  line-height: 1.6;\n  margin-bottom: 1px;\n}\n#me-regex-help-list code {\n  border: 1px solid #ddd;\n  padding: 1px 3px;\n  user-select: all;\n  cursor: text;\n}\n"],sourceRoot:""}]);let l=o},78:function(e){e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n="",i=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),i&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),i&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n}).join("")},t.i=function(e,n,i,r,a){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(i)for(var l=0;l<this.length;l++){var s=this[l][0];null!=s&&(o[s]=!0)}for(var A=0;A<e.length;A++){var u=[].concat(e[A]);i&&o[u[0]]||(void 0!==a&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=a),n&&(u[2]&&(u[1]="@media ".concat(u[2]," {").concat(u[1],"}")),u[2]=n),r&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=r):u[4]="".concat(r)),t.push(u))}},t}},812:function(e){e.exports=function(e){var t=e[1],n=e[3];if(!n)return t;if("function"==typeof btoa){var i=btoa(unescape(encodeURIComponent(JSON.stringify(n))));return[t].concat(["/*# ".concat("sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(i)," */")]).join("\n")}return[t].join("\n")}},792:function(e){var t=[];function n(e){for(var n=-1,i=0;i<t.length;i++)if(t[i].identifier===e){n=i;break}return n}function i(e,i){for(var r={},a=[],o=0;o<e.length;o++){var l=e[o],s=i.base?l[0]+i.base:l[0],A=r[s]||0,u="".concat(s," ").concat(A);r[s]=A+1;var c=n(u),d={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==c)t[c].references++,t[c].updater(d);else{var p=function(e,t){var n=t.domAPI(t);return n.update(e),function(t){t?(t.css!==e.css||t.media!==e.media||t.sourceMap!==e.sourceMap||t.supports!==e.supports||t.layer!==e.layer)&&n.update(e=t):n.remove()}}(d,i);i.byIndex=o,t.splice(o,0,{identifier:u,updater:p,references:1})}a.push(u)}return a}e.exports=function(e,r){var a=i(e=e||[],r=r||{});return function(e){e=e||[];for(var o=0;o<a.length;o++){var l=n(a[o]);t[l].references--}for(var s=i(e,r),A=0;A<a.length;A++){var u=n(a[A]);0===t[u].references&&(t[u].updater(),t.splice(u,1))}a=s}}},430:function(e){var t={};e.exports=function(e,n){var i=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!i)throw Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},685:function(e){e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},937:function(e,t,n){e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},677:function(e){e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){var i,r,a;i="",n.supports&&(i+="@supports (".concat(n.supports,") {")),n.media&&(i+="@media ".concat(n.media," {")),(r=void 0!==n.layer)&&(i+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),i+=n.css,r&&(i+="}"),n.media&&(i+="}"),n.supports&&(i+="}"),(a=n.sourceMap)&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),e.styleTagTransform(i,t,e.options)},remove:function(){!function(e){if(null!==e.parentNode)e.parentNode.removeChild(e)}(t)}}}},766:function(e){e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var a=t[i]={id:i,exports:{}};return e[i](a,a.exports,n),a.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.nc=void 0,n.rv=()=>"1.4.11",n.ruid="bundler=rspack@1.4.11",(()=>{let e=e=>{let t=document.createElement("template");return t.innerHTML=e.trim(),t.content.children[0]};var t=n(792),i=n.n(t),r=n(677),a=n.n(r),o=n(430),l=n.n(o),s=n(937),A=n.n(s),u=n(685),c=n.n(u),d=n(766),p=n.n(d),m=n(354),g={};g.styleTagTransform=p(),g.setAttributes=A(),g.insert=l().bind(null,"head"),g.domAPI=a(),g.insertStyleElement=c(),i()(m.Z,g),m.Z&&m.Z.locals&&m.Z.locals;class f{_logTypes={success:{icon:"✓",color:"#333",text:"完成"},warn:{icon:"!",color:"#f28500",text:"警告"},error:{icon:"✕",color:"#eb3941",text:"出错"}};element;headline;body=e('<div class="loger-body"></div>');logerLines=e('<ul class="loger-lines"></ul>');logDetails=[];filterButtons={};constructor(t=[],n="",i="h3"){for(let e in t.length>0&&(this._logTypes=t.reduce((e,{name:t,icon:n,color:i,text:r})=>(e[t]={icon:n,color:i,text:r},e),{})),this._logTypes)this._logTypes[e].show=!0;this.headline=e(`<${i} class="loger-headline"></${i}>`);let r=e('<a class="loger-clear">[清空]</a>');r.addEventListener("click",this.clear.bind(this));let a=e('<nav class="loger-filter"></nav>');for(let[t,{icon:n,color:i,text:r}]of Object.entries(this._logTypes)){let o=e(`<div class="loger-filter-selected loger-${t}" style="color:${i}"></div>`),l=e('<span class="loger-filter-icon"></span>');l.append(n);let s=e('<span class="loger-filter-count">0</span>');o.append(l,s,` ${r}`),o.addEventListener("click",()=>{this._logTypes[t].show?(o.classList.remove("loger-filter-selected"),this.logerLines.classList.add(`loger-${t}-hidden`),this.logDetails.filter(e=>e.type===t).forEach(e=>{e.element.style.display="none"}),this._logTypes[t].show=!1):(o.classList.add("loger-filter-selected"),this.logerLines.classList.remove(`loger-${t}-hidden`),this.logDetails.filter(e=>e.type===t).forEach(e=>{e.element.style.display=""}),this._logTypes[t].show=!0)}),this.filterButtons[t]={button:o,countElement:s},a.appendChild(o)}this.element=e(`<div class="bearbintools-loger" id="${n||""}"></div>`),this.headline.append("日志",r),this.body.append(a,this.logerLines),this.element.append(this.headline,this.body)}record(e,t="normal",n=new Date().toLocaleTimeString()){let i=document.createElement("li");return i.classList.add("loger-record",`loger-${t}`),i.innerHTML=`${n} - ${e}`,i.style.color=this._logTypes[t]?.color||"#222",this._logTypes[t]?.show===!1&&(i.style.display="none"),this.logerLines.appendChild(i),this.logerLines.scrollTop=this.logerLines.scrollHeight,this.logDetails.push({element:i,type:t}),this.filterButtons[t]&&(this.filterButtons[t].countElement.innerText=String(+this.filterButtons[t].countElement.innerText+1)),i}clear(){for(let e in this.logDetails.length=0,this.logerLines.innerHTML="",this.filterButtons)this.filterButtons[e].countElement.innerText="0"}}let h=async(e,t=["page","subcat","file"])=>{let n=new mw.Api,i=[];if(mw.config.get("wgUserGroups").some(e=>["bot","flood","patroller","sysop"].includes(e))){let r="";for(;void 0!==r;){let a=await n.post({action:"query",format:"json",utf8:!0,list:"categorymembers",cmlimit:"max",cmtitle:e,cmprop:"title",cmtype:t,cmcontinue:r});a.query.categorymembers[0]&&i.push(...a.query.categorymembers.map(({title:e})=>e)),r=a.continue?.cmcontinue}}else{let n=async e=>{let r=$(await $.ajax(e)),a=t.map(e=>{switch(e){case"page":return"#mw-pages li a";case"subcat":return"#mw-subcategories li a";case"file":return"#mw-category-media li a.galleryfilename"}}).join(","),o=r.find(a).map((e,t)=>t.classList.contains("CategoryTreeLabel")?`Category:${$(t).text()}`:t.classList.contains("galleryfilename")?`File:${$(t).text()}`:$(t).text()).get();if(i.push(...o),t.includes("page")){let e=r.find('a[href*="&pagefrom="]');e.length&&await n(e.eq(0).attr("href"))}if(t.includes("subcat")){let e=r.find('a[href*="&subcatfrom="]');e.length&&await n(e.eq(0).attr("href"))}if(t.includes("file")){let e=r.find('a[href*="&filefrom="]');e.length&&await n(e.eq(0).attr("href"))}};await n(`/${e}?useskin=vector&safemode=1`)}return i},y=async(e,t)=>{let n=new mw.Api,[i]=Object.values((await n.post({action:"query",prop:"revisions",titles:e,rvprop:"content",...t})).query.pages);if("revisions"in i)return i.revisions?.[0]["*"];if("missing"in i)throw"missingtitle"},b=async(e,t,n=!1)=>{let i=new mw.Api;return function(e,t=!1,n,i){let r=$(`<td colspan="${e?2:1}" class="diff-otitle" />`),a=$(`<td colspan="${e?2:1}" class="diff-ntitle" />`);Array.isArray(void 0)?r.append(...void 0):r.append(n||"旧版本"),Array.isArray(void 0)?a.append(...void 0):a.append(i||"新版本");let o=$('<tr class="diff-title" />').append(r,a);return $('<table class="diff diff-contentalign-left" data-mw="interface" />').append(e&&'<colgroup><col class="diff-marker"><col class="diff-content"><col class="diff-marker"><col class="diff-content"></colgroup>',$("<tbody />").append(t?o:"",e||'<tr><td colspan="2" class="diff-notice"><div class="mw-diff-empty">（没有差异）</div></td></tr>'))}((await i.post({action:"compare",fromtext:e,totext:t,topst:!0,fromtitle:"PAGENAME"})).compare["*"],n)},w=e=>e.split("\n").filter(e=>e&&e.trim());var x=n(544),C={};C.styleTagTransform=p(),C.setAttributes=A(),C.insert=l().bind(null,"head"),C.domAPI=a(),C.insertStyleElement=c(),i()(x.Z,C),x.Z&&x.Z.locals&&x.Z.locals,$(()=>(async()=>{let e;if("Special:MassEdit"!==mw.config.get("wgPageName")){await mw.loader.using("mediawiki.util"),mw.util.addPortletLink("p-tb","/Special:MassEdit","批量编辑","t-massedit");return}await mw.loader.using(["mediawiki.api","oojs-ui"]);let t=new mw.Api,n="waiting",i=!1,r=new f([{name:"success",icon:"✓",color:"#333",text:"已完成"},{name:"nochange",icon:"○",color:"#888",text:"无变化"},{name:"warn",icon:"!",color:"#f28500",text:"警告"},{name:"error",icon:"✕",color:"#eb3941",text:"出错"}],"massedit-log","h5");mw.loader.load("/index.php?title=User:Nzh21/js/QuickDiff.js&action=raw&ctype=text/javascript"),mw.loader.load("/load.php?debug=false&modules=mediawiki.diff.styles&only=styles","text/css"),mw.config.set("wgCanonicalSpecialPageName","MassEdit"),document.title="批量编辑 - 萌娘百科_万物皆可萌的百科全书",$(".mw-invalidspecialpage").removeClass("mw-invalidspecialpage"),$("#firstHeading").html('批量编辑页面<div>By <a href="/User:BearBin">BearBin</a></div>'),$("#contentSub").remove();let a=$('<textarea class="me-textarea" name="me-edit-from" rows="4"/>'),o=$('<textarea class="me-textarea" name="me-change-to" rows="4"/>'),l=$('<textarea class="me-textarea" name="me-page-list" rows="12"/>'),s=$('<textarea class="me-textarea" name="me-category-list" rows="12"/>'),A=new OO.ui.CheckboxInputWidget({id:"me-regex-box"}),u=new OO.ui.FieldLayout(A,{label:"使用正则表达式",align:"inline"}),c=new OO.ui.ButtonWidget({label:"常用正则",icon:"help"}),d=new OO.ui.ButtonWidget({label:"提交",flags:["primary","progressive"],icon:"check"}),p=new OO.ui.ButtonWidget({label:"终止",flags:["primary","destructive"],icon:"close"}),m=new OO.ui.TextInputWidget({type:"number",placeholder:"编辑间隔",id:"me-interval"}),g=new OO.ui.TextInputWidget({placeholder:"附加摘要",id:"me-summary"}),x=new OO.ui.ButtonWidget({label:"预览",icon:"search",disabled:!0}),C=new OO.ui.TextInputWidget({placeholder:"要应用本编辑的页面"}).on("change",e=>{e?.length?x.setDisabled(!1):x.setDisabled(!0)}),v=new OO.ui.TextInputWidget({type:"number",placeholder:"0",id:"me-retry-times",disabled:!0}),B=new OO.ui.CheckboxInputWidget,F=new OO.ui.FieldLayout(B.on("change",()=>{v.setDisabled(!B.isSelected())}),{label:"因网络问题出错时，重试至多",align:"inline",id:"me-use-retry"});$("#mw-content-text").empty().append("<h5>原文字：</h5>",a,"<h5>替换为：</h5>",o,$('<div id="me-regex"/>').append(u.$element,c.$element),$("<ul/>").append("<li>正则表达式须使用斜线包裹（如<code>/regex/g</code>），且<code>g</code>为必须，否则无法被js解析。</li>","<li>替换后文本若有换行请直接敲回车，不要用<code>\\n</code>。</li>"),$('<div id="me-page-lists"/>').append($("<div/>").append("<h5>页面</h5>",l),$("<div/>").append("<h5>分类</h5>",s)),$('<div id="me-pages-note"/>').append("输入要编辑的页面或分类，","<u>每行一个</u>","；分类栏请带上 分类/Category/Cat 等能被系统识别的分类名字空间前缀。"),$('<div id="me-edit-panel" class="me-panel"/>').append(d.$element,p.$element.hide(),m.$element,g.$element),$('<div id="me-preview-panel" class="me-panel"/>').append(x.$element,C.$element),$('<div id="me-retry"/>').append(F.$element,v.$element,"次"),$("<ul/>").append("<li>编辑间隔单位为秒（s），不填默认为20s。不包含本身编辑页面所用的时间。</li>",$("<li/>").append('<b>请注意<a target="_blank" href="/萌娘百科:机器用户">机器用户方针</a>所规定速率</b>',"和",'<a target="_blank" href="/api.php?action=query&meta=userinfo&uiprop=ratelimits">ratelimit限制</a>',"并自行设置间隔，或申请机器用户权限。")),r.element,$("<ul/>").append("<li>报错“http”不一定是编辑失败，可能实际已提交但等待成功信息过久而判定超时。</li>"));let k=t=>new Promise(n=>e=setTimeout(n,t)),E=()=>{n="waiting",clearTimeout(e),p.setDisabled(!0).$element.hide(),d.setDisabled(!1).$element.show(),$("#mw-content-text input, #mw-content-text textarea").prop("disabled",!1),window.onbeforeunload=()=>null},D=async e=>{let t=[],n=e.map(async e=>{try{let n=await h(e);n.length>0?(r.record(`\u{83B7}\u{53D6}\u{5230}\u{3010}<a href="/${e}" target="_blank">${e}</a>\u{3011}\u{5185}\u{7684}\u{9875}\u{9762}${n.length}\u{4E2A}\u{3002}`,"normal"),t.push(...n)):r.record(`\u{3010}${e}\u{3011}\u{5185}\u{6CA1}\u{6709}\u{9875}\u{9762}\u{3002}`,"warn")}catch(n){let t="";t="http"===n?"网络连接出错":n,r.record(`\u{83B7}\u{53D6}\u{3010}${e}\u{3011}\u{5185}\u{7684}\u{9875}\u{9762}\u{51FA}\u{9519}\u{FF1A}${t}\u{3002}`,"error")}});return await Promise.all(n),t},S=async()=>[...new Set([...w(l.val()||""),...await D(w(s.val()||""))])],O=(e,t)=>{let n=e;if(t)try{let t=e.match(/^\/(.*)\/([gimsuy]*)$/);if(!t)return r.record("正则表达式格式有误。","warn"),"";let[i,a,o]=t;if(!o.includes("g"))return r.record("正则表达式必须包含全局匹配(g)修饰符。","warn"),"";n=new RegExp(a,o)}catch(e){r.record(`\u{6B63}\u{5219}\u{8868}\u{8FBE}\u{5F0F}\u{89E3}\u{6790}\u{5931}\u{8D25}\u{FF1A}${e}`,"error");return}return n},T=async(e,t,n)=>{x.setDisabled(!0),r.record("正在获取预览……");try{let i=await y(e);if(!i)return void r.record(`\u{83B7}\u{53D6}${e}\u{5F53}\u{524D}\u{5185}\u{5BB9}\u{51FA}\u{9519}\u{3002}`,"error");let a=i.replaceAll(t,n),o=await b(i,a,!0);OO.ui.alert($(o),{title:$(`<span>\u{9884}\u{89C8}<b>\u{3010}${e}\u{3011}</b>\u{7684}\u{66F4}\u{6539}</span>`),size:"larger"})}catch(e){r.record(`\u{9884}\u{89C8}\u{51FA}\u{9519}\u{FF1A}${e}\u{3002}`,"error")}x.setDisabled(!1)},M=async(e,a,o,l)=>{let s=B.isSelected(),A=0,u=+v.getValue(),c=`<a href="/${e}" target="_blank">${e}</a>`;do try{n="getting";let s=await y(e),A=s.replaceAll(o,l);if(s===A)return r.record(`\u{3010}${c}\u{3011}\u{7F16}\u{8F91}\u{524D}\u{540E}\u{65E0}\u{53D8}\u{5316}\u{3002}`,"nochange"),"nochange";if(i)return"failed";n="editing";let u=await t.postWithToken("csrf",{format:"json",action:"edit",watchlist:"nochange",tags:"Bot",bot:!0,minor:!0,nocreate:!0,title:e,text:A,summary:`[[U:BearBin/js#MassEdit|MassEdit]]\u{FF1A}\u{3010}${o.toString().replace(/\n/g,"↵")}\u{3011}\u{2192}\u{3010}${l.replace(/\n/g,"↵")}\u{3011}${a&&`\u{FF1A}${a}`}`});if(n="waiting",u?.edit?.result==="Success")return r.record(`\u{3010}<a href="/_?diff=${u.edit.newrevid}" target="_blank">${e}</a>\u{3011}\u{7F16}\u{8F91}\u{5B8C}\u{6210}\u{3002}`,"success"),"success";if(u?.edit?.abusefilter)return r.record(`\u{3010}${c}\u{3011}\u{7F16}\u{8F91}\u{5931}\u{8D25}\u{FF1A}\u{88AB}\u{6EE5}\u{7528}\u{8FC7}\u{6EE4}\u{5668}${u.edit.abusefilter.id}\u{963B}\u{6B62}\u{3002}\u{8FC7}\u{6EE4}\u{5668}\u{63CF}\u{8FF0}\u{FF1A}${u.edit.abusefilter.description}\u{3002}`,"error"),"failed";r.record(`\u{3010}${c}\u{3011}\u{7F16}\u{8F91}\u{5931}\u{8D25}\u{FF0C}\u{8BF7}\u{5C06}\u{4EE5}\u{4E0B}\u{5185}\u{5BB9}\u{544A}\u{77E5}<a href="/User_talk:BearBin" target="_blank">BearBin</a>\u{FF1A}${JSON.stringify(u)}`,"error");break}catch(n){let t="";switch(n){case"missingtitle":t="页面不存在";break;case"http":A++,t=s&&A<=u?`\u{7F51}\u{7EDC}\u{8FDE}\u{63A5}\u{51FA}\u{9519}\u{FF0C}\u{6B63}\u{5728}\u{91CD}\u{8BD5}\u{FF08}${A}/${u}\u{FF09}`:"网络连接出错";break;case"protectedpage":t="页面被保护";break;default:t=n}if(r.record(`\u{7F16}\u{8F91}\u{3010}<a href="/${e}?action=history" target="_blank">${e}</a>\u{3011}\u{65F6}\u{51FA}\u{73B0}\u{9519}\u{8BEF}\u{FF1A}${t}\u{3002}`,"error"),!s||"http"!==n)break}while(A<=u);return"failed"};d.on("click",async()=>{if(!a.val())return void r.record("请输入要替换的原文字。","warn");if(!l.val()&&!s.val())return void r.record("请输入要编辑的页面或分类。","warn");let e=$("<p>请确认您的编辑内容。若因输入不当而产生错误，请自行<ruby>承担后果<rp>(</rp><rt>料理后事</rt><rp>)</rp></ruby>。</p>");if(await OO.ui.confirm(e,{title:"提醒",size:"small"})){let e=g.getValue(),t=(""===m.getValue()?20:m.getValue())*1e3,n=O(a.val(),A.isSelected()),l=o.val();if(!n)return;d.setDisabled(!0).$element.hide(),p.setDisabled(!1).$element.show(),$("#mw-content-text input, #mw-content-text textarea").prop("disabled",!0),window.onbeforeunload=()=>!0,await S().then(async a=>{let o=0,{length:s}=a;for(let A of(r.record(`\u{5171}${s}\u{4E2A}\u{9875}\u{9762}\u{FF0C}\u{5373}\u{5C06}\u{5F00}\u{59CB}\u{7F16}\u{8F91}\u{2026}\u{2026}`,"normal"),a)){let r=await M(A,e,n,l);if(o++,i)break;"success"===r&&0!==t&&o<s&&await k(t)}i?(i=!1,r.record("编辑终止。","normal")):r.record("编辑完毕。","normal"),E()}),E()}}),p.on("click",()=>{switch(p.setDisabled(!0),n){case"waiting":i=!1,E(),r.record("编辑终止。","normal");break;case"getting":i=!0,E();break;case"editing":i=!0}}),x.on("click",()=>{let e=a.val();if(!e)return void r.record("请输入要替换的原文字。","warn");let t=O(e,A.isSelected());t&&T(C.getValue(),t,o.val())});let L=$('<ul id="me-regex-help-list"/>').append(`<li><code>${/\[\[(?:Category|Cat|分[类類]):分类名(\|[^[]*)?\]\]/gi.toString()}</code>\u{FF1A}\u{5339}\u{914D}\u{5206}\u{7C7B}</li>`,`<li><code>${/\{\{(?:Template:|T:|[模样樣]板:)?模板名/gi.toString()}</code>\u{FF1A}\u{5339}\u{914D}\u{6A21}\u{677F}\u{FF08}\u{4E0D}\u{542B}\u{5185}\u{5BB9}\u{FF09}</li>`,`<li><code>${/^.*$/gs.toString()}</code>\u{FF1A}\u{5339}\u{914D}\u{5168}\u{6587}\u{FF08}\u{611F}\u{8C22}\u{9B3C}\u{5F71}\u{FF09}</li>`);c.on("click",()=>{OO.ui.alert(L,{title:"常用正则表达式",size:"medium"})})})())})()})();
//# sourceMappingURL=MassEdit.min.js.map