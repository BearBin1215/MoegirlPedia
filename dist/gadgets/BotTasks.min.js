(()=>{"use strict";var e={},t={};function i(a){var o=t[a];if(void 0!==o)return o.exports;var n=t[a]={exports:{}};return e[a](n,n.exports,i),n.exports}i.rv=()=>"1.4.2",i.ruid="bundler=rspack@1.4.2";let a=e=>new Promise(t=>setTimeout(t,e)),o=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["page","subcat","file"],i=new mw.Api,a=[];if(mw.config.get("wgUserGroups").some(e=>["bot","flood","patroller","sysop"].includes(e))){let o="";for(;void 0!==o;){let n=await i.post({action:"query",format:"json",utf8:!0,list:"categorymembers",cmlimit:"max",cmtitle:e,cmprop:"title",cmtype:t,cmcontinue:o});n.query.categorymembers[0]&&a.push(...n.query.categorymembers.map(e=>{let{title:t}=e;return t})),o=n.continue?.cmcontinue}}else{let i=async e=>{let o=$(await $.ajax(e)),n=t.map(e=>{switch(e){case"page":return"#mw-pages li a";case"subcat":return"#mw-subcategories li a";case"file":return"#mw-category-media li a.galleryfilename"}}).join(","),r=o.find(n).map((e,t)=>t.classList.contains("CategoryTreeLabel")?`Category:${$(t).text()}`:t.classList.contains("galleryfilename")?`File:${$(t).text()}`:$(t).text()).get();if(a.push(...r),t.includes("page")){let e=o.find('a[href*="&pagefrom="]');e.length&&await i(e.eq(0).attr("href"))}if(t.includes("subcat")){let e=o.find('a[href*="&subcatfrom="]');e.length&&await i(e.eq(0).attr("href"))}if(t.includes("file")){let e=o.find('a[href*="&filefrom="]');e.length&&await i(e.eq(0).attr("href"))}};await i(`/${e}?useskin=vector&safemode=1`)}return a};$(()=>(async()=>{let e;await mw.loader.using(["mediawiki.api"]);let t=new class{data;constructor(e){this.data=e}addPageToList(e,t){let i=[{obj:this.data,path:[]}];for(;i.length>0;){let{obj:a,path:o}=i.shift();for(let[n,r]of Object.entries(a)){if(n===e){if(Array.isArray(r))return void r.push(t);return}"object"==typeof r&&null!==r&&i.push({obj:r,path:[...o,n]})}}this.data[e]=[t]}get wikitext(){let e=1,t=["本页面由机器人自动更新，因此通常不建议直接编辑本页面。","","最后更新时间：<u>~~~~~</u>，约15分钟误差。","","大多数内容建议手动排查，以免误判。","","一些常见误判诸如在非页顶使用{{tl|dablink}}等情况。若出现其他误判，请[[User_talk:BearBin|联系阿熊]]。","{{目录右置}}"],i=a=>{for(let[o,n]of(e++,Object.entries(a)))if(t.push("",`${"=".repeat(e)} ${o} ${"=".repeat(e)}`),Array.isArray(n))n.length>0?t.push("{{hide|1=点击展开列表|2=",...n.map(e=>"string"==typeof e?`*[[${e}]]`:`*-{[[${e[0]}]]}-\u{FF1A}${e[1]}`),"}}"):t.push("暂无");else if("object"==typeof n&&null!==n)i(n);else throw Error(`${o}\u{5BF9}\u{5E94}\u{503C}\u{7C7B}\u{578B}\u{6709}\u{8BEF}: ${typeof n}`);e--};return i(this.data),t.join("\n")}}({消歧义页使用管道符:{后缀:[],前缀:[]},疑似繁体页面名:[],不礼貌排版习惯:{连续换行:[],"big地狱（5个以上）":[],疑似大家族前单独用二级标题:[],疑似喊话:[]},弃用标签:{center:[],strike:[],tt:[],font:[]},能用内链非要外链:[],不符合模板规范:{重复TOP:[],页顶用图超过99px:{条目:[],模板:[]},顶部模板排序:[],注释和外部链接后的大家族模板:[]},大家族name参数有误:[],模板多余换行:{两个或以上:[],一个:[]},"“•”左右少空格":{左侧缺少:[],右侧缺少:[]},"管道符前后一致（无明显影响，通常不用专门处理）":{"<nowiki>[[ABC|ABC]]</nowiki>":[],"<nowiki>|ABC{{!}}ABC</nowiki>":[]},旧声优分类格式:[],"http(s)少冒号或斜杠":[]}),i={prefix:"\\{\\{(?:template:|[模样樣]板:|T:)?",navbar:["小[导導]航[条條]","小[导導]航[条條]\\/承前[启啟][后後]"],disambigTop:["about","not","distinguish","dablink","redirectHere","otheruseslist"],top:["[欢歡]迎[编編][辑輯]","不完整","急需改[进進]","[^{|\\[\\]]+top"],disambig:["消歧[义義]"],note:["[现現][实實]人物"],amuse:["阿卡林","被巡回","黑幕可能无法划开","暂时保留","一本正经地胡说八道","坑"],quote:["cquote","先一起喊"],bottom:["reflist","notelist","NoteFoot","notes","cite","到萌娘文[库庫]","到[维維]基百科","ToWikipedia","到FANDOM","到纳木维基","到VNDB","To BWIKI","To 52poke Wiki","To Megami Tensei Wiki","到灰[机機]wiki","到泰拉瑞[亚亞]Wiki","到泰拉瑞亚MODWiki","到MC百科","到Minecraft Wiki","到魔禁[维維]基","到THBWiki","到BlitzHanger","到女神[转轉]生[维維]基","To Megami Tensei Wiki","到MLP中文[维維]基","到PvZ Wiki","微博","PAGENAME","DEFAULTSORT","#if","#switch","lj\\|","color\\|","ruby\\|","hide\\|","[剧劇]透","黑幕","胡话","jk\\|","main\\|","ja\\}","en\\}","zh\\}","zh-hans","zh-hant","lang\\|","cquote","Ps\\|","catn","ColonSort","bilibiliVideo","BV","YoukuVideo","music163","背景[图圖]片","替[换換][侧側][边邊][栏欄]底[图圖]","外部[图圖]片注[释釋]","[标標][题題]替[换換]","PicHover","Outer[ _]image","pic\\|","disambig","Playlist","消歧义页","NoSubpage","noReferer","用梗适度","一本正经地胡说八道","color[ _]block","RoundTop","see also"]},n=function(e){let t;for(var a=arguments.length,o=Array(a>1?a-1:0),n=1;n<a;n++)o[n-1]=arguments[n];var r=RegExp(`${i.prefix}(${o.join("|")})[}\\|\\n]`,"gi");let l=[];for(;null!==(t=r.exec(e));)l.push(t.index);return l},r=(e,i,a)=>{if(i.includes("Category:消歧义页")){let i=e.match(/\[\[(.+)\(.+\)\|\1\]\].*—/),o=e.match(/\[\[[^:\n].*:(.+)\|\1\]\].*—/);i?t.addPageToList("后缀",[a,`<code><nowiki>${i[0].replaceAll("—","")}</nowiki></code>`]):o&&t.addPageToList("前缀",[a,`<code><nowiki>${o[0].replaceAll("—","")}</nowiki></code>`])}},l=(e,i,a)=>{!i.some(e=>e.includes("音乐作品"))&&(/(<br *\/ *>\s*){4,}/i.test(e)||/(\n|<br *\/? *>){8}/i.test(e))&&t.addPageToList("连续换行",a)},s=(e,i,a)=>{/(<big>){5}/i.test(e)&&t.addPageToList("big地狱（5个以上）",a)},u=(e,a,o)=>{RegExp(`${i.prefix}(\u{80CC}\u{666F}[\u{56FE}\u{5716}]\u{7247}|\u{66FF}[\u{6362}\u{63DB}][\u{4FA7}\u{5074}][\u{8FB9}\u{908A}][\u{680F}\u{6B04}]\u{5E95}[\u{56FE}\u{5716}])[^}]+img\\.moegirl\\.org\\.cn`,"si").test(e)&&"Deltarune/黑暗世界"!==o&&t.addPageToList("能用内链非要外链",o)},c=(e,a,o)=>{RegExp(`== *(\u{76F8}\u{5173}|\u{66F4}\u{591A}|\u{5176}\u{4ED6}|\u{5176}\u{5B83})(\u{6761}\u{76EE}|\u{689D}\u{76EE}|\u{5185}\u{5BB9}|\u{94FE}\u{63A5})? *==
*${i.prefix}((?!${i.bottom.join("|")}).)*\\}`,"gi").test(e)&&t.addPageToList("疑似大家族前单独用二级标题",o)},d=(e,a,o)=>{RegExp(`== *(\u{811A}\u{6CE8}|[\u{6CE8}\u{8A3B}]\u{89E3}|\u{6CE8}\u{91CA}|\u{8A3B}\u{91CB}|\u{5916}\u{90E8}[\u{94FE}\u{93C8}]\u{63A5}|\u{5916}\u{90E8}\u{9023}\u{7D50}|\u{5916}\u{94FE}|[\u{53C2}\u{53C3}]\u{8003}).*==[\\s\\S]*
${i.prefix}((?!${i.bottom.join("|")}).)*\\}`,"gi").test(e)&&t.addPageToList("注释和外部链接后的大家族模板",o)},g=(e,i,a)=>{(/\{\{color\|red\|'''[^}|]{50,}'''\}\}/i.test(e)||/'''\{\{color\|red\|[^}|]{50,}\}\}'''/i.test(e))&&t.addPageToList("疑似喊话",a)},p=(a,o,n)=>{let r=RegExp(`${i.prefix}(${i.top.join("|")})[}\\|\\n]`,"gi"),l=a.match(r)||[],s=0;for(let t of l)e.includes(t.replace(r,"$1"))&&s++;s>1&&t.addPageToList("重复TOP",n)},f=(e,i,a)=>{(/leftimage *=[.\n]*\d{3}px/.test(e)||/\{\{(?:template:|[模样樣]板:|T:)?(欢迎编辑|歡迎編輯|不完整|customtop).*\d{3}px/i.test(e))&&t.addPageToList("条目",a)},m=(e,a,o)=>{let r={消歧义导航模板:n(e,...i.disambigTop),专题导航导航:n(e,"导航"),导航条:n(e,...i.navbar),"{{tl|消歧义}}":n(e,...i.disambig),欢迎编辑或专题TOP:n(e,...i.top),提示模板:n(e,...i.note),娱乐模板:n(e,...i.amuse),喊话模板:n(e,...i.quote)},l=(e=>{for(let t=0;t<e.length-1;t++){let i=Math.max(...e[t].filter(e=>e<=600));for(let a=t+1;a<e.length;a++)if(i>=Math.min(...e[a].filter(e=>e<=600)))return a}return 0})(Object.values(r));l>0&&t.addPageToList("顶部模板排序",[o,`<code>${Object.keys(r)[l]}</code>`])},h=(e,i,a)=>{i.includes("Category:页顶提示模板")&&(/leftimage *=.*\d{3}px/.test(e)||/(width|size) *= *\d{3}px/.test(e)||/\[\[(File|Image):[^\]]+\| *\d{3}px/i.test(e))&&t.addPageToList("模板",a)},w=(e,i,a)=>{!i.some(e=>["Category:模板文档","Category:条目格式模板","Category:权限申请模板"].includes(e))&&(/(\n{2,}<noinclude>|<\/noinclude>\n{2,}[^|]|<includeonly>\n{2,}|\n{2,}<\/includeonly>)/.test(e)?t.addPageToList("两个或以上",a):/(\n<noinclude>|<\/noinclude>\n|<includeonly>\n|\n<\/includeonly>)/.test(e)&&t.addPageToList("一个",a))},k=(e,i,a)=>{if(i.includes("Category:用户编辑组模板"))return;let o=e.match(/([^\]\n]+\]\]|[^}\n]+\}\})•/),n=e.match(/•(\[\[[^\]\n]+|\{\{[^}\n]+)/);o&&t.addPageToList("左侧缺少",[a,`<code><nowiki>${o[0]}</nowiki></code>`]),n&&t.addPageToList("右侧缺少",[a,`<code><nowiki>${n[0]}</nowiki></code>`])},y=(e,i,a)=>{let o=e.match(/\[\[ *([^\]]+) *\| *\1 *\]\]/),n=e.match(/\| *([^\]{}}]+) *\{\{!\}\} *\1 *(\||\})/);o&&t.addPageToList("<nowiki>[[ABC|ABC]]</nowiki>",[a,`<code><nowiki>${o[0]}</nowiki></code>`]),n&&t.addPageToList("<nowiki>|ABC{{!}}ABC</nowiki>",[a,`<code><nowiki>${n[0]}</nowiki></code>`])},b=(e,i,a)=>{let o=e.match(/\|多位(配音|声优) *= *\{\{cate\|[^{}|]+\|[^{}[\]\n]+[^色{}[\]\n](\}\}|\|)/gi);o&&t.addPageToList("旧声优分类格式",[a,`<code><nowiki>${o[0]}</nowiki></code>`])},T=(e,i,a)=>{let o=e.match(/\| *name *= *[^|\n]*/gi)||[];if(!(i.includes("Category:模板文档")||!e.match(/\{\{ *(?:#invoke:|Template:|T:|模板:|样板:)? *(大家族|Nav)/gi)||/:(沙盒|Sandbox|Navbox|大家族$)/.test(a))&&o){for(let e of o)if(e.replace(/\| *name *= *([^|\n]*)/g,"$1").replaceAll("_"," ").trim().toLowerCase()!==a.replace("Template:","").toLowerCase())return void t.addPageToList("大家族name参数有误",[a,`<code><nowiki>${e}</nowiki></code>`])}},x=(e,i,a)=>{let o=e.match(/[^/]https?(\/\/|:\/[a-zA-Z0-9])/gi);o&&t.addPageToList("http(s)少冒号或斜杠",[a,`<code><nowiki>${o[0]}</nowiki></code>`])},P=(e,i,a)=>{for(let{tag:i,regex:o}of[{tag:"center",regex:/<(center)(?:\s[^>]*)?>|<\/center>/gi},{tag:"tt",regex:/<(tt)(?:\s[^>]*)?>|<\/tt>/gi},{tag:"strike",regex:/<(strike)(?:\s[^>]*)?>|<\/strike>/gi},{tag:"font",regex:/<(font)(?:\s[^>]*)?>|<\/font>/gi}]){let n=e.match(o);n&&("font"===i?t.addPageToList(i,[a,`<code><nowiki>${n[0]}</nowiki></code>`]):t.addPageToList(i,a))}},v=new mw.Api,C=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,n=0,r={},l=!1,s=e=>{for(let{title:t,revisions:i,categories:a}of e)r[t]||={categories:[],text:i?.[0]?.["*"]?.replace(/<!--[\s\S]*?-->/g,"")||""},i?.length>0&&n++,a&&r[t].categories.push(...a.map(e=>e.title))},u={action:"query",generator:"allpages",gaplimit:o,cllimit:"max",gapnamespace:t,prop:"revisions|categories",rvprop:"content",utf8:!0},c=async(e,t)=>{l||(l=!0),u.gaplimit=Math.ceil(u.gaplimit/2),await a(3e3)};await a(7e3);do{let t;r={};let a=0;for(;a<i;)try{t=await v.post(u);break}catch(e){await c(e,++a)}l=!1,u.gaplimit=Math.min(2*u.gaplimit,o),s(Object.values(t.query.pages));let{gapcontinue:n,rvcontinue:d,clcontinue:g}=t.continue||{};for(;d||g;){let e;for(d&&(u.rvcontinue=d),g&&(u.clcontinue=g),a=0;a<i;)try{e=await v.post(u);break}catch(e){await c(e,++a)}if(l=!1,u.gaplimit=Math.min(2*u.gaplimit,o),s(Object.values(e.query.pages)),e.continue?.gapcontinue){({gapcontinue:n}=e.continue),Reflect.deleteProperty(u,"rvcontinue"),Reflect.deleteProperty(u,"clcontinue");break}let t=!1;if(e.continue?.rvcontinue&&({rvcontinue:d}=e.continue,t=!0),e.continue?.clcontinue&&({clcontinue:g}=e.continue,t=!0),!t)break}for(let[t,{text:i,categories:a}]of(u.gapcontinue=n,Object.entries(r)))for(let o of e)o(i,a,t)}while(void 0!==u.gapcontinue)},A=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i="",a=0;do{if(a>=10)throw Error("获取疑似繁体页面名尝试次数过多。");try{let a=await v.post({action:"query",format:"json",prop:"info",generator:"allpages",inprop:"varianttitles",gapfilterredir:"nonredirects",gaplimit:"max",gapnamespace:e,gapcontinue:i});for(let{title:e,varianttitles:{"zh-cn":o}}of(i=a.continue?.gapcontinue,Object.values(a.query.pages)))/[ぁ-んァ-ヶ]/.test(e)||e.replace(/^(?:Category|Template):/,"")===o.replace(/^(?:分类|模板):/,"")||t.addPageToList("疑似繁体页面名",[`:${e}`,`\u{2192}${o}`])}catch(e){a++}}while(i)},B=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,i="User:BearBin/杂物";for(;0<e;)try{await v.postWithToken("csrf",{action:"edit",title:i,summary:"自动更新列表",text:t.wikitext,bot:!0,tags:"Bot"});return}catch(e){await a(3e3)}throw Error(`\u{4FDD}\u{5B58}\u{5230}\x1b[4m${i}\x1b[0m\u{5931}\u{8D25}\u{3002}`)};(async()=>{e=(await o("Category:页顶提示模板")).map(e=>e.replace("Template:","")).filter(e=>!["架空历史"].includes(e)),await C([r,l,s,p,f,g,c,d,m,u,y,b,x,P],0,20),await C([h,w,k,y,T,P],10,10),await A(0),await A(10),await A(14),await B()})()})())})();
//# sourceMappingURL=BotTasks.min.js.map