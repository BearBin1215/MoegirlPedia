(()=>{var e={},t={};function i(u){var s=t[u];if(void 0!==s)return s.exports;var o=t[u]={exports:{}};return e[u](o,o.exports,i),o.exports}i.rv=()=>"1.4.2",i.ruid="bundler=rspack@1.4.2",$(()=>(async()=>{if(!document.getElementsByClassName("votebox")[0]||!(mw.config.get("wgTitle").startsWith("提案/讨论中提案/")||"讨论版/权限变更"===mw.config.get("wgTitle")))return;await mw.loader.using(["mediawiki.api","mediawiki.util","mediawiki.notification","oojs-ui","ext.gadget.site-lib"]);let e=new mw.Api,t=$(document.body),i=mw.config.get("wgPageName"),u=mw.config.get("wgTitle").startsWith("提案/讨论中提案/"),s=mw.config.get("wgUserGroups").includes("flood"),o=wgULS("一键发送投票提醒","一鍵發送投票提醒");class a extends OO.ui.ProcessDialog{failList=[];static static={...super.static,tagName:"div",name:"lr-reminder",title:o,actions:[{action:"cancel",label:"取消",flags:["safe","close","destructive"]},{action:"submit",label:wgULS("发送","發送"),flags:["primary","progressive"]}]};constructor(e){super(e)}initialize(){super.initialize(),this.panelLayout=new OO.ui.PanelLayout({scrollable:!1,expanded:!1,padded:!0}),this.proposalTitleBox=new OO.ui.TextInputWidget({value:i.substring(i.lastIndexOf("/")+1,i.length),validate:"non-empty"});let e=new OO.ui.FieldLayout(this.proposalTitleBox,{label:wgULS("提案标题","提案標題"),align:"top"});for(let e of(this.headlines=[],$(".votebox").parent(".discussionContainer").children("h2").children(".mw-headline")))this.headlines.push(e.id);this.sectionTitleDropdown=new OO.ui.DropdownInputWidget({options:[...this.headlines.map(e=>({data:e,label:e.replaceAll("_"," ")}))]});let t=new OO.ui.FieldLayout(this.sectionTitleDropdown,{label:wgULS("人事案标题","人事案標題"),align:top});this.Papp=new OO.ui.RadioOptionWidget({data:"p",label:"管理员、巡查姬",selected:!0}),this.Sapp=new OO.ui.RadioOptionWidget({data:"s",label:"管理员"}),this.groupsRadioSelect=new OO.ui.RadioSelectWidget({items:[this.Papp,this.Sapp]});let s=new OO.ui.FieldLayout(this.groupsRadioSelect,{label:wgULS("要提醒的用户组","要提醒的用戶組"),align:top});u?this.panelLayout.$element.append(e.$element):this.panelLayout.$element.append(t.$element,s.$element),this.$body.append(this.panelLayout.$element)}get proposalTitle(){return this.proposalTitleBox.getValue()}get sectionTitle(){return this.sectionTitleDropdown.getValue()}get groupSelected(){return this.groupsRadioSelect.findSelectedItem()?.getData?.()}async getUserGroup(){let t,i=JSON.parse(Object.values((await e.post({action:"query",titles:"Module:UserGroup/data",prop:"revisions",rvprop:"content",rvlimit:1})).query.pages)[0].revisions[0]["*"]);if(u)t=[...i.sysop,...i.patroller];else switch(this.groupSelected){case"p":t=[...i.sysop,...i.patroller];break;case"s":t=i.sysop}return t}get userVoted(){return(u?$('.votebox ~ ol a[href^="/User"], .votebox ~ ol a[href^="/index.php?title=User"]').map((e,t)=>{let{href:i}=t;return i}).get():$(`#${this.sectionTitle.replaceAll(":","\\:")}`).parents(".discussionContainer").find('.votebox ~ ol a[href^="/User"], .votebox ~ ol a[href^="/index.php?title=User"]').map((e,t)=>{let{href:i}=t;return i}).get()).map(e=>decodeURI(e.replace(/.*User(_talk)?:([^&]*).*/g,"$2")))}async getUserToRemind(){let t,i;await this.getUserGroup().then(e=>{t=e});let s=Object.values((await e.post({action:"query",titles:"User:BearBin/js/voteRemind.js/Noremind",prop:"revisions",rvprop:"content",rvlimit:1})).query.pages)[0].revisions[0]["*"].split(/\n\* */);u||(i=this.sectionTitle.replace(/.*User:(.*)/g,"$1").replaceAll("_"," "));let o=new Set([...this.userVoted,...s,i]);return t.filter(e=>!o.has(e))}get link(){return u?`[[\u{840C}\u{5A18}\u{767E}\u{79D1}_talk:\u{63D0}\u{6848}/\u{8BA8}\u{8BBA}\u{4E2D}\u{63D0}\u{6848}/${this.proposalTitle}|${this.proposalTitle.replaceAll("_"," ")}]]`:`[[\u{840C}\u{5A18}\u{767E}\u{79D1}_talk:\u{8BA8}\u{8BBA}\u{7248}/\u{6743}\u{9650}\u{53D8}\u{66F4}#${this.sectionTitle}|${this.sectionTitle.replaceAll("_"," ")}]]`}async remind(t){let i=await e.postWithToken("csrf",{format:"json",action:"edit",section:"new",watchlist:"nochange",tags:"Automation tool",bot:s,title:`User_talk:${t}`,sectiontitle:"投票提醒",text:`<i style="font-size:small">\u{672C}\u{901A}\u{77E5}\u{4F7F}\u{7528}\u{4E00}\u{952E}\u{63D0}\u{9192}\u{5C0F}\u{5DE5}\u{5177}\u{53D1}\u{51FA}\u{FF0C}\u{5982}\u{51FA}\u{73B0}\u{9519}\u{8BEF}\u{FF0C}\u{8BF7}\u{8054}\u{7CFB}[[User_talk:BearBin|BearBin]]\u{3002}\u{82E5}\u{4E0D}\u{5E0C}\u{671B}\u{63A5}\u{5230}\u{6B64}\u{63D0}\u{9192}\u{FF0C}\u{8BF7}\u{5728}[[User:BearBin/js/voteRemind.js/Noremind|\u{8FD9}\u{4E2A}\u{9875}\u{9762}]]\u{8BB0}\u{5F55}\u{60A8}\u{7684}\u{7528}\u{6237}\u{540D}\u{3002}</i><br/>\u{60A8}\u{597D}\u{FF0C}${u?"提案":"人事案"}\u{3010}${this.link}\u{3011}\u{5DF2}\u{7ECF}\u{5F00}\u{59CB}\u{6295}\u{7968}\u{3002}\u{60A8}\u{5C1A}\u{672A}\u{6295}\u{7968}\u{FF0C}\u{8BF7}\u{53CA}\u{65F6}\u{53C2}\u{4E0E}\u{55B5}\u{FF5E}\u{2014}\u{2014}~~~~`}).done(()=>{mw.notify(wgULS(`\u{5411}${t}\u{53D1}\u{9001}\u{6295}\u{7968}\u{63D0}\u{9192}\u{6210}\u{529F}\u{3002}`,`\u{5411}${t}\u{767C}\u{9001}\u{6295}\u{7968}\u{63D0}\u{9192}\u{6210}\u{529F}\u{3002}`))});i.error&&(this.failList.push(t),mw.notify(wgULS(`\u{5411}${t}\u{53D1}\u{9001}\u{6295}\u{7968}\u{63D0}\u{9192}\u{5931}\u{8D25}\u{FF1A}${i.error.code}\u{3002}`,`\u{5411}${t}\u{767C}\u{9001}\u{6295}\u{7968}\u{63D0}\u{9192}\u{5931}\u{6557}\u{FF1A}${i.error.code}\u{3002}`),{type:"error"}))}getActionProcess(e){return"cancel"===e?new OO.ui.Process(()=>{this.close({action:e})},this):"submit"===e?new OO.ui.Process($.when((async()=>{this.failList=[],await this.getUserToRemind().then(async e=>{for(let t of e)await this.remind(t)}),this.failList.length>0&&oouiDialog.alert(this.failList.join("、"),{title:wgULS("向以下用户发送提醒失败","向以下使用者發送提醒失敗"),size:"small"}),this.close({action:e})})()).promise(),this):super.getActionProcess(e)}}let l=new OO.ui.WindowManager;t.append(l.$element);let n=new a({size:"medium",id:"bearbin-vote-remind"});l.addWindows([n]),$(mw.util.addPortletLink("p-cactions","javascript:void(0)","投票提醒","ca-vote-remind",o,"r")).on("click",e=>{e.preventDefault(),l.openWindow(n),t.css("overflow","auto")})})())})();
//# sourceMappingURL=VoteRemind.min.js.map