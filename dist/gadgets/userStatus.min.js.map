{"version":3,"file":"userStatus.min.js","sources":["webpack://bearbin-moegirlpedia/webpack/runtime/rspack_version","webpack://bearbin-moegirlpedia/webpack/runtime/rspack_unique_id","webpack://bearbin-moegirlpedia/./src/gadgets/userStatus/index.js"],"sourcesContent":["__webpack_require__.rv = () => (\"1.4.2\")","__webpack_require__.ruid = \"bundler=rspack@1.4.2\";\n","// Edit from [[User:AnnAngela/js/userStatus.js]]\n\n$(() => (async () => {\n  await mw.loader.using(['ext.gadget.LocalObjectStorage']);\n  const localObjectStorage = new LocalObjectStorage('UserStatus');\n  try {\n    const builtinStatus = {\n      online: '<img class=\"pt-userstatus-img\" src=\"https://img.moegirl.org.cn/common/9/94/Symbol_support_vote.svg\"> <b style=\"color:green;\">在线</b>',\n      busy: '<img class=\"pt-userstatus-img\" src=\"https://img.moegirl.org.cn/common/c/c5/Symbol_support2_vote.svg\"> <b style=\"color:blue;\">忙碌</b>',\n      offline: '<img class=\"pt-userstatus-img\" src=\"https://img.moegirl.org.cn/common/7/7f/Symbol_oppose_vote.svg\"> <b style=\"color:red;\">离线</b>',\n      away: '<img class=\"pt-userstatus-img\" src=\"https://img.moegirl.org.cn/common/6/6c/Time2wait.svg\"> <b style=\"color:grey;\">已离开</b>',\n      sleeping: '<img class=\"pt-userstatus-img\" src=\"https://img.moegirl.org.cn/common/5/54/Symbol_wait.svg\"> <b style=\"color:purple;\">在睡觉</b>',\n      wikibreak: '<img class=\"pt-userstatus-img\" src=\"https://img.moegirl.org.cn/common/6/61/Symbol_abstain_vote.svg\"> <b style=\"color:brown;\">正在放萌百假期</b>',\n      holiday: '<img class=\"pt-userstatus-img\" src=\"https://img.moegirl.org.cn/common/3/30/Symbol_deferred.svg\"> <b style=\"color:#7B68EE;\">处于假期中</b>',\n      _unknown: '<img class=\"pt-userstatus-img\" src=\"https://img.moegirl.org.cn/common/8/89/Symbol_neutral_vote.svg\"> <i style=\"color:gray;\">状态不详</i>',\n    };\n    const originalBuiltinStatusIndex = Object.keys(builtinStatus);\n    mw.loader.addStyleTag('.skin-vector #pt-userstatus { margin-top: 0.75em !important; margin-bottom: 0px !important; } .pt-userstatus-img { width: 25px; } .skin-vector .pt-userstatus-img {  margin-top: -0.25em; } .skin-moeskin #pt-userpage-link { display: flex; align-items: center; gap: .1em; @media (max-width: 768px) { #pt-userstatus { display: none; } }');\n    builtinStatus.on = builtinStatus.online;\n    builtinStatus.off = builtinStatus.offline;\n    builtinStatus.break = builtinStatus.wikibreak;\n    builtinStatus.sleep = builtinStatus.sleeping;\n    const userName = mw.config.get('wgUserName');\n    if (userName === null) {\n      return;\n    }\n    const statusPage = `User:${userName}/Status`;\n    const now = new Date().getTime();\n    let rawStatus;\n    try {\n      const localStatus = await localObjectStorage.getItem('localStatus');\n      if (mw.config.get('wgPageName') !== statusPage\n        && typeof localStatus.timestamp === 'number' && localStatus.timestamp > now - 10 * 60 * 1000\n        && localStatus.status in builtinStatus) {\n        rawStatus = localStatus.status;\n      } else {\n        throw new Error();\n      }\n    } catch {\n      try {\n        rawStatus = (await $.ajax({\n          url: `${mw.config.get('wgServer')}${mw.config.get('wgScriptPath')}/index.php`,\n          type: 'GET',\n          data: {\n            title: statusPage,\n            action: 'raw',\n          },\n          cache: false,\n        })).trim();\n        if (rawStatus in builtinStatus) {\n          await localObjectStorage.setItem('localStatus', {\n            timestamp: now,\n            status: rawStatus,\n          });\n        }\n      } catch {\n        rawStatus = '_unknown';\n        await localObjectStorage.removeItem('localStatus');\n      }\n    }\n    const currentStatus = rawStatus in builtinStatus ? builtinStatus[rawStatus] : (() => {\n      const div = $('<div/>').html(rawStatus);\n      div.find('script, style, link, iframe, frame, object, param, audio, video, base, head, meta, title, body, h1, h2, h3, h4, h5, h6, blockquote, dd, dl, dir, dt, hr, li, ul, ol, pre, a, abbr, br, cite, code, data, em, rb, rp, rt, rtc, ruby, samp, time, tt, var, wbr, area, map, track, applet, embed, noembed, picture, source, canvas, noscript, caption, col, colgroup, table, tbody, thead, tfoot, td, th, tr, button, datalist, fieldset, form, input, label, legend, meter, optgroup, option, output, progress, select, textarea, details, dialog, menu, menuitem, summary, shadow, element, content, slot, template, bgsound, blink, center, command, frameset').remove();\n      div.find('img').attr('class', 'pt-userstatus-img');\n      return div.html();\n    })();\n    let pt;\n    switch (mw.config.get('skin')) {\n      case 'moeskin':\n        pt = $('<div id=\"pt-userstatus\" class=\"search-button-area\"><a id=\"pt-userpage-link\" href=\"javascript:void(0);\" dir=\"auto\" title=\"您的状态\"></a></div>');\n        $('#moe-global-header-inner .user-links').append(pt);\n        break;\n      case 'vector':\n      default:\n        pt = $('<li id=\"pt-userstatus\"><a id=\"pt-userpage-link\" href=\"javascript:void(0);\" dir=\"auto\" title=\"您的状态\"></a></li>');\n        $('#pt-userpage').after(pt);\n    }\n    pt.find('#pt-userpage-link').html(currentStatus).on('click', async () => {\n      await mw.loader.using(['oojs-ui', 'mediawiki.api']);\n      const messageDialog = new OO.ui.MessageDialog();\n      const windowManager = new OO.ui.WindowManager();\n      $(document.body).append(windowManager.$element);\n      windowManager.addWindows([messageDialog]);\n      messageDialog.title.$label.html('修改自己的状态');\n      const container = $('<div/>');\n      container.append(`<p>修改<a href=\"${mw.config.get('wgServer')}${mw.config.get('wgScriptPath')}/${statusPage}\">自己的状态</a>为：</p>`);\n      const builtinStatusList = originalBuiltinStatusIndex.map((data, i) => data === '_unknown' ? undefined : { data, label: `${i}`, html: builtinStatus[data] }).filter((n) => !!n);\n      const builtinStatusSelector = new OO.ui.RadioSelectInputWidget({\n        value: rawStatus,\n        options: builtinStatusList.map(({ data, label }) => ({ data, label })),\n      });\n      builtinStatusSelector.$element.find('.oo-ui-radioSelectWidget > .oo-ui-radioOptionWidget > .oo-ui-labelElement-label').each((_, labelEle) => {\n        $(labelEle).css('overflow', 'visible').html((builtinStatusList.filter(({ label }) => $(labelEle).text() === label)[0] || { html: $(labelEle).html() }).html);\n      });\n      container.append(builtinStatusSelector.$element);\n      container.append(`<p>本工具在获取状态信息后有10分钟的缓存，您可以通过直接打开<a href=\"${mw.config.get('wgServer')}${mw.config.get('wgScriptPath')}/${statusPage}\">自己的状态页</a>来强制获取最新状态信息。`);\n      messageDialog.message.$label.append(container);\n      const action = new OO.ui.ActionWidget({\n        action: 'confirm',\n        label: '提交',\n        flags: 'primary',\n      });\n      const cAction = new OO.ui.ActionWidget({\n        action: 'cancel',\n        label: '取消',\n        flags: 'primary',\n      });\n      cAction.$element[0].addEventListener('click', () => {\n        windowManager.closeWindow(messageDialog);\n      }, {\n        capture: true,\n      });\n      action.$element[0].addEventListener('click', async () => {\n        windowManager.closeWindow(messageDialog);\n        const fMessageDialog = new OO.ui.MessageDialog();\n        windowManager.addWindows([fMessageDialog]);\n        const cAction = new OO.ui.ActionWidget({\n          action: 'accept',\n          label: '我知道了',\n          flags: 'primary',\n        });\n        cAction.$element[0].addEventListener('click', () => {\n          windowManager.closeWindow(fMessageDialog);\n        }, {\n          capture: true,\n        });\n        try {\n          const status = builtinStatusSelector.getValue();\n          await new mw.Api().postWithToken('csrf', {\n            action: 'edit',\n            title: statusPage,\n            text: status,\n            summary: `修改状态为 - ${status}`,\n            tags: 'Automation tool',\n            minor: true,\n          });\n          await localObjectStorage.setItem('localStatus', {\n            timestamp: new Date().getTime(),\n            status,\n          });\n          pt.find('#pt-userpage-link').html(builtinStatus[status]);\n          rawStatus = status;\n          fMessageDialog.title.$label.html('状态修改完成！');\n          fMessageDialog.message.$label.html(`<p>你的状态已修改为：${builtinStatus[status]}</p>`);\n          const action = new OO.ui.ActionWidget({\n            action: 'confirm',\n            label: '确定',\n            flags: 'primary',\n          });\n          action.$element[0].addEventListener('click', () => {\n            windowManager.closeWindow(fMessageDialog);\n          }, {\n            capture: true,\n          });\n          windowManager.openWindow(fMessageDialog, {\n            actions: [action],\n          });\n        } catch (e) {\n          fMessageDialog.title.$label.html('状态修改发生错误……');\n          fMessageDialog.message.$label.html(`错误信息为：${e}`);\n          windowManager.openWindow(fMessageDialog, {\n            actions: [cAction],\n          });\n        }\n      }, {\n        capture: true,\n      });\n      windowManager.openWindow(messageDialog, {\n        actions: [action, cAction],\n      });\n      return false;\n    });\n    mw.loader.using(['oojs-ui', 'mediawiki.api']);\n  } catch (reason) {\n    console.error(reason);\n    const lastError = sessionStorage.getItem('AnnTools-userstatus-img-Error');\n    if (lastError !== reason.toString()) {\n      alert(`显示用户状态工具发生错误：\\n${reason}`);\n      sessionStorage.setItem('AnnTools-userstatus-img-Error', reason);\n    }\n  }\n})());\n"],"names":["$","mw","localObjectStorage","LocalObjectStorage","rawStatus","pt","builtinStatus","originalBuiltinStatusIndex","Object","userName","statusPage","now","Date","localStatus","Error","currentStatus","div","messageDialog","OO","windowManager","document","container","builtinStatusList","data","i","undefined","n","builtinStatusSelector","label","_","labelEle","action","cAction","fMessageDialog","status","e","reason","sessionStorage","alert"],"mappings":"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"}