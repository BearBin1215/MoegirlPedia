(()=>{"use strict";var e={},t={};function r(a){var o=t[a];if(void 0!==o)return o.exports;var n=t[a]={exports:{}};return e[a](n,n.exports,r),n.exports}r.rv=()=>"1.4.2",r.ruid="bundler=rspack@1.4.2";let a=e=>{let{text:t=""}=e;document.getElementById("bearbintool-headerbutton-style")||$(document.head).append('<style id="bearbintool-headerbutton-style">#firstHeading:has(.bearbintool-headerbutton-wrapper){flex-wrap:wrap;justify-content:space-between;align-items:center;display:flex}#firstHeading:has(.bearbintool-headerbutton-wrapper) .bearbintool-headerbutton-wrapper{gap:6px;display:flex}#firstHeading:has(.bearbintool-headerbutton-wrapper) .bearbintool-headerbutton-wrapper .bearbintool-headerbutton{cursor:pointer;background-color:#fff;border:1px solid #aaa;border-radius:0;padding:4px 8px;font-size:16px;transition:background-color .2s ease-out}#firstHeading:has(.bearbintool-headerbutton-wrapper) .bearbintool-headerbutton-wrapper .bearbintool-headerbutton:hover{background-color:#eee}</style>');let r=$(".bearbintool-headerbutton-wrapper");$(".bearbintool-headerbutton-wrapper").length<1&&(r=$('<div class="bearbintool-headerbutton-wrapper"></div>'),$("#firstHeading").append(r));let a=$(`<button class="bearbintool-headerbutton">${t}</button>`);return r.append(a),a},o=function(e,t,r){var a=-1,o=e.length;t<0&&(t=-t>o?0:o+t),(r=r>o?o:r)<0&&(r+=o),o=t>r?0:r-t>>>0,t>>>=0;for(var n=Array(o);++a<o;)n[a]=e[a+t];return n};var n="object"==typeof global&&global&&global.Object===Object&&global,i="object"==typeof self&&self&&self.Object===Object&&self,l=(n||i||Function("return this")()).Symbol,s=Object.prototype,u=s.hasOwnProperty,c=s.toString,f=l?l.toStringTag:void 0;let p=function(e){var t=u.call(e,f),r=e[f];try{e[f]=void 0;var a=!0}catch(e){}var o=c.call(e);return a&&(t?e[f]=r:delete e[f]),o};var m=Object.prototype.toString,b=l?l.toStringTag:void 0;let d=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":b&&b in Object(e)?p(e):m.call(e)},g=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},y=function(e){if(!g(e))return!1;var t=d(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},w=function(e){var t;return null!=e&&"number"==typeof(t=e.length)&&t>-1&&t%1==0&&t<=0x1fffffffffffff&&!y(e)};var h=/^(?:0|[1-9]\d*)$/;let v=function(e,t){var r=typeof e;return!!(t=null==t?0x1fffffffffffff:t)&&("number"==r||"symbol"!=r&&h.test(e))&&e>-1&&e%1==0&&e<t},x=function(e,t,r){if(!g(r))return!1;var a,o=typeof t;return("number"==o?!!(w(r)&&v(t,r.length)):"string"==o&&t in r)&&((a=r[t])===e||a!=a&&e!=e)};var j=/\s/;let B=function(e){for(var t=e.length;t--&&j.test(e.charAt(t)););return t};var N=/^\s+/;let T=function(e){return"symbol"==typeof e||null!=e&&"object"==typeof e&&"[object Symbol]"==d(e)};var F=0/0,k=/^[-+]0x[0-9a-f]+$/i,q=/^0b[01]+$/i,O=/^0o[0-7]+$/i,U=parseInt;let A=function(e){if("number"==typeof e)return e;if(T(e))return F;if(g(e)){var t,r="function"==typeof e.valueOf?e.valueOf():e;e=g(r)?r+"":r}if("string"!=typeof e)return 0===e?e:+e;e=(t=e)?t.slice(0,B(t)+1).replace(N,""):t;var a=q.test(e);return a||O.test(e)?U(e.slice(2),a?2:8):k.test(e)?F:+e};var D=1/0;let V=function(e){var t,r=(t=e)?(t=A(t))===D||t===-D?(t<0?-1:1)*17976931348623157e292:t==t?t:0:0===t?t:0,a=r%1;return r==r?a?r-a:r:0};var H=Math.ceil,S=Math.max;let C=function(e,t,r){t=(r?x(e,t,r):void 0===t)?1:S(V(t),0);var a=null==e?0:e.length;if(!a||t<1)return[];for(var n=0,i=0,l=Array(H(a/t));n<a;)l[i++]=o(e,n,n+=t);return l},E=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["page","subcat","file"],r=new mw.Api,a=[];if(mw.config.get("wgUserGroups").some(e=>["bot","flood","patroller","sysop"].includes(e))){let o="";for(;void 0!==o;){let n=await r.post({action:"query",format:"json",utf8:!0,list:"categorymembers",cmlimit:"max",cmtitle:e,cmprop:"title",cmtype:t,cmcontinue:o});n.query.categorymembers[0]&&a.push(...n.query.categorymembers.map(e=>{let{title:t}=e;return t})),o=n.continue?.cmcontinue}}else{let r=async e=>{let o=$(await $.ajax(e)),n=t.map(e=>{switch(e){case"page":return"#mw-pages li a";case"subcat":return"#mw-subcategories li a";case"file":return"#mw-category-media li a.galleryfilename"}}).join(","),i=o.find(n).map((e,t)=>t.classList.contains("CategoryTreeLabel")?`Category:${$(t).text()}`:t.classList.contains("galleryfilename")?`File:${$(t).text()}`:$(t).text()).get();if(a.push(...i),t.includes("page")){let e=o.find('a[href*="&pagefrom="]');e.length&&await r(e.eq(0).attr("href"))}if(t.includes("subcat")){let e=o.find('a[href*="&subcatfrom="]');e.length&&await r(e.eq(0).attr("href"))}if(t.includes("file")){let e=o.find('a[href*="&filefrom="]');e.length&&await r(e.eq(0).attr("href"))}};await r(`/${e}?useskin=vector&safemode=1`)}return a},M=async(e,t)=>{let r=new mw.Api,[a]=Object.values((await r.post({action:"query",prop:"revisions",titles:e,rvprop:"content",...t})).query.pages);if("revisions"in a)return a.revisions?.[0]["*"];if("missing"in a)throw"missingtitle"},P=new mw.Api,Y=mw.config.get("wgUserGroups").some(e=>["bot","flood","sysop"].includes(e))?500:50,G=async()=>{let e=C(await E("Category:R-18作品声优"),Y),t=[];for(let r of e){let e=await P.post({action:"query",format:"json",prop:"revisions",titles:r.join("|"),rvprop:"timestamp"});t.push(...Object.values(e.query.pages).map(e=>{let{title:t,revisions:[{timestamp:r}]}=e;return{title:t,timestamp:r}}))}let r=t.sort((e,t)=>new Date(e.timestamp)<new Date(t.timestamp)?-1:1).map(e=>{let{title:t,timestamp:r}=e;return`* [[${t}]]\u{FF1A}${moment(r).format("YYYY-MM-DD HH:mm:ss")}`}).join("\n");await P.postWithToken("csrf",{action:"edit",title:"User:BearBin/VNData/里界声优条目更新时间",text:["{{用户 允许他人编辑|[[Template:萌百视觉小说研究会|视研会]]成员}}","本页面统计[[:Category:R-18作品声优]]内页面的最后更新时间，提示可能需要更新的页面。\n","您可以使用[[User:BearBin/VNData#VNTools|VNTools]]更新本页面。\n",`\u{672C}\u{9875}\u{9762}\u{6700}\u{540E}\u{4E00}\u{6B21}\u{7531}{{User|${mw.config.get("wgUserName")}}}\u{66F4}\u{65B0}\u{4E8E}~~~~~\u{3002}
`,r].join("\n"),summary:"使用[[User:BearBin/VNData#VNTools|VNTools]]自动更新列表",bot:!0,tags:"Bot"}),mw.notify("更新成功！即将刷新页面……"),window.location.reload()},L=async()=>{let e=async e=>{let t={};for(let r of C(e,Y)){let{query:{users:e}}=await P.post({action:"query",list:"users",ususers:r.join("|"),usprop:"groups"});e.forEach(e=>{let{name:r,groups:a}=e;t[r]=a})}return t},t=e=>e.map(e=>{let{username:t,nickname:r,subscript:a}=e;return`{{User|${t}${r?`|${r}`:""}}}${a||""}`}).join(" • \x3c!--\n    --\x3e"),r=async e=>{await P.postWithToken("csrf",{action:"edit",title:"Template:萌百视觉小说研究会",summary:"使用[[User:BearBin/VNData#VNTools|VNTools]]自动更新用户组信息",text:e,bot:!0,tags:"Bot"})},a=await M("Template:萌百视觉小说研究会"),o=a.replace(/.*<!-- *列表起点 *-->(.*)<!-- *列表终点 *-->.*/gs,"$1").replace(/<!--[\s\S]*?-->/g,"").replace(/\* */g,"").trim().split("\n").map(e=>{let t=e.trim().match(/^([^<(]*)(\(([^)]*)\))?(<.*>)?$/);return{username:t[1],nickname:t[3],subscript:t[4]}}),n=await e(o.map(e=>{let{username:t}=e;return t})),i={maintainer:[],autopatrolled:[],autoconfirmed:[]};for(let e of o){let t=n[(e.username.charAt(0).toUpperCase()+e.username.slice(1)).replace("_"," ")];t.some(e=>["sysop","patroller"].includes(e))?i.maintainer.push(e):t.some(e=>["goodeditor","honoredmaintainer"].includes(e))?i.autopatrolled.push(e):i.autoconfirmed.push(e)}let l=a.replace(/(<!-- *维护人员 *-->).*(<!-- *维护人员 *-->)/gs,`$1${t(i.maintainer)}$2`).replace(/(<!-- *优编荣维 *-->).*(<!-- *优编荣维 *-->)/gs,`$1${t(i.autopatrolled)}$2`).replace(/(<!-- *自确 *-->).*(<!-- *自确 *-->)/gs,`$1${t(i.autoconfirmed)}$2`);l===a?mw.notify("用户组信息无变化",{type:"info"}):(await r(l),mw.notify("更新成功！即将刷新页面……"),window.location.reload())};$(()=>{if(mw.loader.using(["mediawiki.notification","mediawiki.api"]),"User:BearBin/VNData/里界声优条目更新时间"===mw.config.get("wgPageName")){mw.loader.using(["moment"]);let e=a({text:"更新"});e.on("click",async()=>{try{if("正在更新……"===e.text())return;e.text("正在更新……"),await G()}catch(t){mw.notify(`\u{66F4}\u{65B0}\u{5931}\u{8D25}\u{FF1A}${t}`,{type:"error"}),e.text("更新")}})}if("Template:萌百视觉小说研究会"===mw.config.get("wgPageName")){let e=a({text:"更新"});e.on("click",async()=>{try{if("正在更新……"===e.text())return;e.text("正在更新……"),await L()}catch(t){mw.notify(`\u{66F4}\u{65B0}\u{5931}\u{8D25}\u{FF1A}${t}`,{type:"error"}),e.text("更新")}})}})})();
//# sourceMappingURL=VNTools.min.js.map