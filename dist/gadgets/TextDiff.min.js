(()=>{var e={913:function(e,t,n){"use strict";n.d(t,{Z:()=>c});var r=n(812),o=n.n(r),i=n(78),a=n.n(i)()(o());a.push([e.id,".rootpage-Special_TextDiff #firstHeading{flex-wrap:wrap;justify-content:space-between;align-items:flex-end;display:flex}.rootpage-Special_TextDiff #firstHeading>div{font-size:.6em}.rootpage-Special_TextDiff #bodyContent{padding-right:0!important}.rootpage-Special_TextDiff #bodyContent #mw-content-text .oo-ui-textInputWidget{max-width:unset}.rootpage-Special_TextDiff #bodyContent #mw-content-text .get-source-from-page>.oo-ui-textInputWidget{max-width:25em;margin-right:0}.rootpage-Special_TextDiff .get-source-from-page{gap:.3em;margin-top:.4em;display:flex}.rootpage-Special_TextDiff #submit-button{margin-top:1em}.rootpage-Special_TextDiff #diff-result{padding:.2em}.rootpage-Special_TextDiff #result-action{margin-top:1em}","",{version:3,sources:["webpack://./src/gadgets/TextDiff/index.less"],names:[],mappings:"AAEA,yCAAA,cAAA,CAAA,6BAAA,CAAA,oBAAA,CAAA,YAAA,CAMA,6CAAA,cAAA,CAGA,wCAAA,yBAAA,CAGA,gFAAA,eAAA,CAGA,sGAAA,cAAA,CAAA,cAAA,CAIA,iDAAA,QAAA,CAAA,eAAA,CAAA,YAAA,CAKA,0CAAA,cAAA,CAGA,wCAAA,YAAA,CAGA,0CAAA,cAAA",sourcesContent:["/** flex基础，默认全居中 */\n/** 覆盖渲染页面的样式 */\n/** 文本溢出显示省略号 */\n.rootpage-Special_TextDiff #firstHeading {\n  display: flex;\n  flex-wrap: wrap;\n  justify-content: space-between;\n  align-items: flex-end;\n}\n.rootpage-Special_TextDiff #firstHeading > div {\n  font-size: 0.6em;\n}\n.rootpage-Special_TextDiff #bodyContent {\n  padding-right: 0 !important;\n}\n.rootpage-Special_TextDiff #bodyContent #mw-content-text .oo-ui-textInputWidget {\n  max-width: unset;\n}\n.rootpage-Special_TextDiff #bodyContent #mw-content-text .get-source-from-page > .oo-ui-textInputWidget {\n  margin-right: 0;\n  max-width: 25em;\n}\n.rootpage-Special_TextDiff .get-source-from-page {\n  margin-top: 0.4em;\n  display: flex;\n  gap: 0.3em;\n}\n.rootpage-Special_TextDiff #submit-button {\n  margin-top: 1em;\n}\n.rootpage-Special_TextDiff #diff-result {\n  padding: 0.2em;\n}\n.rootpage-Special_TextDiff #result-action {\n  margin-top: 1em;\n}\n"],sourceRoot:""}]);let c=a},78:function(e){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n="",r=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),r&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),r&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n}).join("")},t.i=function(e,n,r,o,i){"string"==typeof e&&(e=[[null,e,void 0]]);var a={};if(r)for(var c=0;c<this.length;c++){var u=this[c][0];null!=u&&(a[u]=!0)}for(var s=0;s<e.length;s++){var l=[].concat(e[s]);r&&a[l[0]]||(void 0!==i&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=i),n&&(l[2]&&(l[1]="@media ".concat(l[2]," {").concat(l[1],"}")),l[2]=n),o&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=o):l[4]="".concat(o)),t.push(l))}},t}},812:function(e){"use strict";e.exports=function(e){var t=e[1],n=e[3];if(!n)return t;if("function"==typeof btoa){var r=btoa(unescape(encodeURIComponent(JSON.stringify(n))));return[t].concat(["/*# ".concat("sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(r)," */")]).join("\n")}return[t].join("\n")}},177:function(e){!function(t){"use strict";var n=function(){var e;return{escape:function(e){return e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")},parseExtension:t,mimeType:function(e){return({woff:"application/font-woff",woff2:"application/font-woff",ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"})[t(e).toLowerCase()]||""},dataAsUrl:function(e,t){return"data:"+t+";base64,"+e},isDataUrl:function(e){return -1!==e.search(/^(data:)/)},canvasToBlob:function(e){return e.toBlob?new Promise(function(t){e.toBlob(t)}):new Promise(function(t){for(var n=window.atob(e.toDataURL().split(",")[1]),r=n.length,o=new Uint8Array(r),i=0;i<r;i++)o[i]=n.charCodeAt(i);t(new Blob([o],{type:"image/png"}))})},resolveUrl:function(e,t){var n=document.implementation.createHTMLDocument(),r=n.createElement("base");n.head.appendChild(r);var o=n.createElement("a");return n.body.appendChild(o),r.href=t,o.href=e,o.href},getAndEncode:function(e){return c.impl.options.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+new Date().getTime()),new Promise(function(t){var n,r=new XMLHttpRequest;if(r.onreadystatechange=function(){if(4===r.readyState){if(200!==r.status)return void(n?t(n):function(e){t("")}("cannot fetch resource: "+e+", status: "+r.status));var o=new FileReader;o.onloadend=function(){t(o.result.split(/,/)[1])},o.readAsDataURL(r.response)}},r.ontimeout=function(){n?t(n):function(e){t("")}("timeout of 30000ms occured while fetching resource: "+e)},r.responseType="blob",r.timeout=3e4,r.open("GET",e,!0),r.send(),c.impl.options.imagePlaceholder){var o=c.impl.options.imagePlaceholder.split(/,/);o&&o[1]&&(n=o[1])}})},uid:(e=0,function(){return"u"+("0000"+(1679616*Math.random()|0).toString(36)).slice(-4)+e++}),delay:function(e){return function(t){return new Promise(function(n){setTimeout(function(){n(t)},e)})}},asArray:function(e){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t},escapeXhtml:function(e){return e.replace(/#/g,"%23").replace(/\n/g,"%0A")},makeImage:function(e){return new Promise(function(t,n){var r=new Image;r.onload=function(){t(r)},r.onerror=n,r.src=e})},width:function(e){var t=n(e,"border-left-width"),r=n(e,"border-right-width");return e.scrollWidth+t+r},height:function(e){var t=n(e,"border-top-width"),r=n(e,"border-bottom-width");return e.scrollHeight+t+r}};function t(e){var t=/\.([^\.\/]*?)$/g.exec(e);return t?t[1]:""}function n(e,t){return parseFloat(window.getComputedStyle(e).getPropertyValue(t).replace("px",""))}}(),r=function(){var e=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:function(e,n,i){return t(e)?Promise.resolve(e).then(r).then(function(t){var r=Promise.resolve(e);return t.forEach(function(e){r=r.then(function(t){return o(t,e,n,i)})}),r}):Promise.resolve(e)},shouldProcess:t,impl:{readUrls:r,inline:o}};function t(t){return -1!==t.search(e)}function r(t){for(var r,o=[];null!==(r=e.exec(t));)o.push(r[1]);return o.filter(function(e){return!n.isDataUrl(e)})}function o(e,t,r,o){return Promise.resolve(t).then(function(e){return r?n.resolveUrl(e,r):e}).then(o||n.getAndEncode).then(function(e){return n.dataAsUrl(e,n.mimeType(t))}).then(function(r){var o;return e.replace((o=t,RegExp("(url\\(['\"]?)("+n.escape(o)+")(['\"]?\\))","g")),"$1"+r+"$3")})}}(),o=function(){return{resolveAll:function(){return e(document).then(function(e){return Promise.all(e.map(function(e){return e.resolve()}))}).then(function(e){return e.join("\n")})},impl:{readAll:e}};function e(){return Promise.resolve(n.asArray(document.styleSheets)).then(function(e){var t=[];return e.forEach(function(e){try{n.asArray(e.cssRules||[]).forEach(t.push.bind(t))}catch(e){}}),t}).then(function(e){return e.filter(function(e){return e.type===CSSRule.FONT_FACE_RULE}).filter(function(e){return r.shouldProcess(e.style.getPropertyValue("src"))})}).then(function(t){return t.map(e)});function e(e){return{resolve:function(){var t=(e.parentStyleSheet||{}).href;return r.inlineAll(e.cssText,t)},src:function(){return e.style.getPropertyValue("src")}}}}}(),i=function(){return{inlineAll:function t(o){var i,a;return o instanceof Element?((a=(i=o).style.getPropertyValue("background"))?r.inlineAll(a).then(function(e){i.style.setProperty("background",e,i.style.getPropertyPriority("background"))}).then(function(){return i}):Promise.resolve(i)).then(function(){return o instanceof HTMLImageElement?e(o).inline():Promise.all(n.asArray(o.childNodes).map(function(e){return t(e)}))}):Promise.resolve(o)},impl:{newImage:e}};function e(e){return{inline:function(t){return n.isDataUrl(e.src)?Promise.resolve():Promise.resolve(e.src).then(t||n.getAndEncode).then(function(t){return n.dataAsUrl(t,n.mimeType(e.src))}).then(function(t){return new Promise(function(n,r){e.onload=n,e.onerror=r,e.src=t})})}}}}(),a=void 0,c={toSvg:u,toPng:function(e,t){return s(e,t||{}).then(function(e){return e.toDataURL()})},toJpeg:function(e,t){return s(e,t=t||{}).then(function(e){return e.toDataURL("image/jpeg",t.quality||1)})},toBlob:function(e,t){return s(e,t||{}).then(n.canvasToBlob)},toPixelData:function(e,t){return s(e,t||{}).then(function(t){return t.getContext("2d").getImageData(0,0,n.width(e),n.height(e)).data})},impl:{fontFaces:o,images:i,util:n,inliner:r,options:{}}};function u(e,t){var r;return void 0===(r=t=t||{}).imagePlaceholder?c.impl.options.imagePlaceholder=a:c.impl.options.imagePlaceholder=r.imagePlaceholder,void 0===r.cacheBust?c.impl.options.cacheBust=!1:c.impl.options.cacheBust=r.cacheBust,Promise.resolve(e).then(function(e){return function e(t,r,o){return o||!r||r(t)?Promise.resolve(t).then(function(e){return e instanceof HTMLCanvasElement?n.makeImage(e.toDataURL()):e.cloneNode(!1)}).then(function(o){var i,a,c,u,s,l,f,p;return i=t,a=o,c=r,0===(u=i.childNodes).length?Promise.resolve(a):(s=a,l=n.asArray(u),f=c,p=Promise.resolve(),l.forEach(function(t){p=p.then(function(){return e(t,f)}).then(function(e){e&&s.appendChild(e)})}),p).then(function(){return a})}).then(function(e){var r,o;return r=t,(o=e)instanceof Element?Promise.resolve().then(function(){var e,t,i,a;e=window.getComputedStyle(r),t=o.style,e.cssText?t.cssText=e.cssText:(i=e,a=t,n.asArray(i).forEach(function(e){a.setProperty(e,i.getPropertyValue(e),i.getPropertyPriority(e))}))}).then(function(){[":before",":after"].forEach(function(e){!function(e){var t=window.getComputedStyle(r,e),i=t.getPropertyValue("content");if(""!==i&&"none"!==i){var a,c,u,s,l,f,p,d=n.uid();o.className=o.className+" "+d;var m=document.createElement("style");m.appendChild((a=d,c=e,p=(u=t).cssText?(l=(s=u).getPropertyValue("content"),s.cssText+" content: "+l+";"):(f=u,n.asArray(f).map(function(e){return e+": "+f.getPropertyValue(e)+(f.getPropertyPriority(e)?" !important":"")}).join("; ")+";"),document.createTextNode("."+a+":"+c+"{"+p+"}"))),o.appendChild(m)}}(e)})}).then(function(){r instanceof HTMLTextAreaElement&&(o.innerHTML=r.value),r instanceof HTMLInputElement&&o.setAttribute("value",r.value)}).then(function(){o instanceof SVGElement&&(o.setAttribute("xmlns","http://www.w3.org/2000/svg"),o instanceof SVGRectElement&&["width","height"].forEach(function(e){var t=o.getAttribute(e);t&&o.style.setProperty(e,t)}))}).then(function(){return o}):o}):Promise.resolve()}(e,t.filter,!0)}).then(l).then(f).then(function(e){return t.bgcolor&&(e.style.backgroundColor=t.bgcolor),t.width&&(e.style.width=t.width+"px"),t.height&&(e.style.height=t.height+"px"),t.style&&Object.keys(t.style).forEach(function(n){e.style[n]=t.style[n]}),e}).then(function(r){var o,i,a;return o=r,i=t.width||n.width(e),a=t.height||n.height(e),Promise.resolve(o).then(function(e){return e.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),new XMLSerializer().serializeToString(e)}).then(n.escapeXhtml).then(function(e){return'<foreignObject x="0" y="0" width="100%" height="100%">'+e+"</foreignObject>"}).then(function(e){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+i+'" height="'+a+'">'+e+"</svg>"}).then(function(e){return"data:image/svg+xml;charset=utf-8,"+e})})}function s(e,t){return u(e,t).then(n.makeImage).then(n.delay(100)).then(function(r){var o=function(e){var r=document.createElement("canvas");if(r.width=t.width||n.width(e),r.height=t.height||n.height(e),t.bgcolor){var o=r.getContext("2d");o.fillStyle=t.bgcolor,o.fillRect(0,0,r.width,r.height)}return r}(e);return o.getContext("2d").drawImage(r,0,0),o})}function l(e){return o.resolveAll().then(function(t){var n=document.createElement("style");return e.appendChild(n),n.appendChild(document.createTextNode(t)),e})}function f(e){return i.inlineAll(e).then(function(){return e})}e.exports=c}(0)},792:function(e){"use strict";var t=[];function n(e){for(var n=-1,r=0;r<t.length;r++)if(t[r].identifier===e){n=r;break}return n}function r(e,r){for(var o={},i=[],a=0;a<e.length;a++){var c=e[a],u=r.base?c[0]+r.base:c[0],s=o[u]||0,l="".concat(u," ").concat(s);o[u]=s+1;var f=n(l),p={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==f)t[f].references++,t[f].updater(p);else{var d=function(e,t){var n=t.domAPI(t);return n.update(e),function(t){t?(t.css!==e.css||t.media!==e.media||t.sourceMap!==e.sourceMap||t.supports!==e.supports||t.layer!==e.layer)&&n.update(e=t):n.remove()}}(p,r);r.byIndex=a,t.splice(a,0,{identifier:l,updater:d,references:1})}i.push(l)}return i}e.exports=function(e,o){var i=r(e=e||[],o=o||{});return function(e){e=e||[];for(var a=0;a<i.length;a++){var c=n(i[a]);t[c].references--}for(var u=r(e,o),s=0;s<i.length;s++){var l=n(i[s]);0===t[l].references&&(t[l].updater(),t.splice(l,1))}i=u}}},430:function(e){"use strict";var t={};e.exports=function(e,n){var r=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!r)throw Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},685:function(e){"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},937:function(e,t,n){"use strict";e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},677:function(e){"use strict";e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){var r,o,i;r="",n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {")),(o=void 0!==n.layer)&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,o&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}"),(i=n.sourceMap)&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),e.styleTagTransform(r,t,e.options)},remove:function(){!function(e){if(null!==e.parentNode)e.parentNode.removeChild(e)}(t)}}}},766:function(e){"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={id:r,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.nc=void 0,n.rv=()=>"1.4.11",n.ruid="bundler=rspack@1.4.11",(()=>{"use strict";var e=n(177),t=n.n(e);let r=async(e,t,n=!1)=>{let r=new mw.Api;return function(e,t=!1,n,r){let o=$(`<td colspan="${e?2:1}" class="diff-otitle" />`),i=$(`<td colspan="${e?2:1}" class="diff-ntitle" />`);Array.isArray(void 0)?o.append(...void 0):o.append(n||"旧版本"),Array.isArray(void 0)?i.append(...void 0):i.append(r||"新版本");let a=$('<tr class="diff-title" />').append(o,i);return $('<table class="diff diff-contentalign-left" data-mw="interface" />').append(e&&'<colgroup><col class="diff-marker"><col class="diff-content"><col class="diff-marker"><col class="diff-content"></colgroup>',$("<tbody />").append(t?a:"",e||'<tr><td colspan="2" class="diff-notice"><div class="mw-diff-empty">（没有差异）</div></td></tr>'))}((await r.post({action:"compare",fromtext:e,totext:t,topst:!0,fromtitle:"PAGENAME"})).compare["*"],n)},o=async(e,t)=>{let n=new mw.Api,[r]=Object.values((await n.post({action:"query",prop:"revisions",titles:e,rvprop:"content",...t})).query.pages);if("revisions"in r)return r.revisions?.[0]["*"];if("missing"in r)throw"missingtitle"};var i=n(792),a=n.n(i),c=n(677),u=n.n(c),s=n(430),l=n.n(s),f=n(937),p=n.n(f),d=n(685),m=n.n(d),g=n(766),h=n.n(g),v=n(913),A={};A.styleTagTransform=h(),A.setAttributes=p(),A.insert=l().bind(null,"head"),A.domAPI=u(),A.insertStyleElement=m(),a()(v.Z,A),v.Z&&v.Z.locals&&v.Z.locals,$(()=>(async()=>{if("Special:TextDiff"!==mw.config.get("wgPageName")){"TextDiff"in window&&(await mw.loader.using("mediawiki.util"),mw.util.addPortletLink("p-tb","/Special:TextDiff","文本差异比较","t-textdiff"));return}await mw.loader.using(["mediawiki.api","oojs-ui","mediawiki.notification"]);let e=async(e,t)=>{try{return await r(e,t)}catch(e){mw.notify(`\u{83B7}\u{53D6}\u{5DEE}\u{5F02}\u{5931}\u{8D25}\u{FF1A}${e}`,{type:"warn"})}},n=async e=>{try{return await o(e)}catch(e){mw.notify(`\u{83B7}\u{53D6}\u{6E90}\u{4EE3}\u{7801}\u{5931}\u{8D25}\u{FF1A}${e}`,{type:"warn"})}mw.notify("获取源代码完毕")};$("#mw-notification-area").appendTo("body"),mw.config.set("wgCanonicalSpecialPageName","TextDiff"),document.title="差异比较 - 萌娘百科_万物皆可萌的百科全书",mw.loader.load("/load.php?modules=mediawiki.diff.styles&only=styles","text/css"),$(".mw-invalidspecialpage").removeClass("mw-invalidspecialpage"),$("#firstHeading").html("差异比较<div>By BearBin</div>"),$("#contentSub").remove();let i=new OO.ui.MultilineTextInputWidget({rows:10,maxRows:10,autosize:!0}),a=new OO.ui.TextInputWidget({labelPosition:"before",label:"从页面"}),c=new OO.ui.ButtonWidget({label:"获取源代码",flags:["progressive"],id:"from-page-button"}),u=$('<div class="get-source-from-page"></div>').append(a.$element,c.$element),s=new OO.ui.TextInputWidget({labelPosition:"before",label:"从页面"}),l=new OO.ui.ButtonWidget({label:"获取源代码",flags:["progressive"],id:"from-page-button"}),f=$('<div class="get-source-from-page"></div>').append(s.$element,l.$element),p=new OO.ui.MultilineTextInputWidget({rows:10,maxRows:10,autosize:!0}),d=new OO.ui.ButtonWidget({label:"比较",flags:["primary","progressive"],icon:"check",id:"submit-button"}),m=new OO.ui.ButtonWidget({label:"保存图片",icon:"download",id:"save-button"}),g=new OO.ui.ButtonWidget({label:"复制到剪贴板",id:"copy-button"}),h=$('<div id="diff-result"></div>'),v=$('<div id="result-action"></div>').append(m.$element,g.$element).hide();$("#mw-content-text").empty().append("<h3>旧版本</h3>",i.$element,u,"<h3>新版本</h3>",p.$element,f,d.$element,"<h3>差异</h3>",h,v),c.on("click",async()=>{let e=await n(a.getValue());e&&i.setValue(e)}),l.on("click",async()=>{let e=await n(s.getValue());e&&p.setValue(e)}),d.on("click",async()=>{d.setDisabled(!0);try{let t=await e(i.getValue(),p.getValue());t&&(h.empty().append(t),v.show())}catch(e){mw.notify(`\u{6BD4}\u{8F83}\u{51FA}\u{9519}\u{FF1A}${e}`,{type:"warn"})}d.setDisabled(!1)}),m.on("click",()=>{t().toJpeg(h.get(0),{bgcolor:"#fff"}).then(e=>{let t=document.createElement("a");t.download="image.jpg",t.href=e,t.click()})}),g.on("click",()=>{t().toBlob(h.get(0),{bgcolor:"#fff"}).then(e=>{navigator.clipboard.write([new ClipboardItem({"image/png":e})]).then(()=>{mw.notify("复制成功")},e=>{mw.notify(`\u{590D}\u{5236}\u{5931}\u{8D25}\u{FF1A}${e}`,{type:"warn"})})})})})())})()})();
//# sourceMappingURL=TextDiff.min.js.map